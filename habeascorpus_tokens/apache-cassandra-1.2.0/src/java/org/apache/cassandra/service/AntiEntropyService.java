/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
service	TokenNameIdentifier	 service
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
InetAddress	TokenNameIdentifier	 Inet Address
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
security	TokenNameIdentifier	 security
.	TokenNameDOT	
MessageDigest	TokenNameIdentifier	 Message Digest
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
atomic	TokenNameIdentifier	 atomic
.	TokenNameDOT	
AtomicBoolean	TokenNameIdentifier	 Atomic Boolean
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
locks	TokenNameIdentifier	 locks
.	TokenNameDOT	
Condition	TokenNameIdentifier	 Condition
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
base	TokenNameIdentifier	 base
.	TokenNameDOT	
Objects	TokenNameIdentifier	 Objects
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
collect	TokenNameIdentifier	 collect
.	TokenNameDOT	
Sets	TokenNameIdentifier	 Sets
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
JMXConfigurableThreadPoolExecutor	TokenNameIdentifier	 JMX Configurable Thread Pool Executor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
NamedThreadFactory	TokenNameIdentifier	 Named Thread Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
Stage	TokenNameIdentifier	 Stage
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
StageManager	TokenNameIdentifier	 Stage Manager
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
compaction	TokenNameIdentifier	 compaction
.	TokenNameDOT	
AbstractCompactedRow	TokenNameIdentifier	 Abstract Compacted Row
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
compaction	TokenNameIdentifier	 compaction
.	TokenNameDOT	
CompactionManager	TokenNameIdentifier	 Compaction Manager
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
dht	TokenNameIdentifier	 dht
.	TokenNameDOT	
AbstractBounds	TokenNameIdentifier	 Abstract Bounds
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
dht	TokenNameIdentifier	 dht
.	TokenNameDOT	
RandomPartitioner	TokenNameIdentifier	 Random Partitioner
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
dht	TokenNameIdentifier	 dht
.	TokenNameDOT	
Range	TokenNameIdentifier	 Range
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
dht	TokenNameIdentifier	 dht
.	TokenNameDOT	
Token	TokenNameIdentifier	 Token
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
gms	TokenNameIdentifier	 gms
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
IVersionedSerializer	TokenNameIdentifier	 I Versioned Serializer
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
locator	TokenNameIdentifier	 locator
.	TokenNameDOT	
TokenMetadata	TokenNameIdentifier	 Token Metadata
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
streaming	TokenNameIdentifier	 streaming
.	TokenNameDOT	
StreamingRepairTask	TokenNameIdentifier	 Streaming Repair Task
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
/** * AntiEntropyService encapsulates "validating" (hashing) individual column families, * exchanging MerkleTrees with remote nodes via a TreeRequest/Response conversation, * and then triggering repairs for disagreeing ranges. * * Every Tree conversation has an 'initiator', where valid trees are sent after generation * and where the local and remote tree will rendezvous in rendezvous(cf, endpoint, tree). * Once the trees rendezvous, a Differencer is executed and the service can trigger repairs * for disagreeing ranges. * * Tree comparison and repair triggering occur in the single threaded Stage.ANTIENTROPY. * * The steps taken to enact a repair are as follows: * 1. A major compaction is triggered via nodeprobe: * * Nodeprobe sends TreeRequest messages to all neighbors of the target node: when a node * receives a TreeRequest, it will perform a readonly compaction to immediately validate * the column family. * 2. The compaction process validates the column family by: * * Calling Validator.prepare(), which samples the column family to determine key distribution, * * Calling Validator.add() in order for every row in the column family, * * Calling Validator.complete() to indicate that all rows have been added. * * Calling complete() indicates that a valid MerkleTree has been created for the column family. * * The valid tree is returned to the requesting node via a TreeResponse. * 3. When a node receives a TreeResponse, it passes the tree to rendezvous(), which checks for trees to * rendezvous with / compare to: * * If the tree is local, it is cached, and compared to any trees that were received from neighbors. * * If the tree is remote, it is immediately compared to a local tree if one is cached. Otherwise, * the remote tree is stored until a local tree can be generated. * * A Differencer object is enqueued for each comparison. * 4. Differencers are executed in Stage.ANTIENTROPY, to compare the two trees, and perform repair via the * streaming api. */	TokenNameCOMMENT_JAVADOC	 AntiEntropyService encapsulates "validating" (hashing) individual column families, exchanging MerkleTrees with remote nodes via a TreeRequest/Response conversation, and then triggering repairs for disagreeing ranges. * Every Tree conversation has an 'initiator', where valid trees are sent after generation and where the local and remote tree will rendezvous in rendezvous(cf, endpoint, tree). Once the trees rendezvous, a Differencer is executed and the service can trigger repairs for disagreeing ranges. * Tree comparison and repair triggering occur in the single threaded Stage.ANTIENTROPY. * The steps taken to enact a repair are as follows: 1. A major compaction is triggered via nodeprobe: * Nodeprobe sends TreeRequest messages to all neighbors of the target node: when a node receives a TreeRequest, it will perform a readonly compaction to immediately validate the column family. 2. The compaction process validates the column family by: * Calling Validator.prepare(), which samples the column family to determine key distribution, * Calling Validator.add() in order for every row in the column family, * Calling Validator.complete() to indicate that all rows have been added. * Calling complete() indicates that a valid MerkleTree has been created for the column family. * The valid tree is returned to the requesting node via a TreeResponse. 3. When a node receives a TreeResponse, it passes the tree to rendezvous(), which checks for trees to rendezvous with / compare to: * If the tree is local, it is cached, and compared to any trees that were received from neighbors. * If the tree is remote, it is immediately compared to a local tree if one is cached. Otherwise, the remote tree is stored until a local tree can be generated. * A Differencer object is enqueued for each comparison. 4. Differencers are executed in Stage.ANTIENTROPY, to compare the two trees, and perform repair via the streaming api. 
public	TokenNamepublic	
class	TokenNameclass	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
{	TokenNameLBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// singleton enforcement 	TokenNameCOMMENT_LINE	singleton enforcement 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
instance	TokenNameIdentifier	 instance
=	TokenNameEQUAL	
new	TokenNamenew	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
ThreadPoolExecutor	TokenNameIdentifier	 Thread Pool Executor
executor	TokenNameIdentifier	 executor
;	TokenNameSEMICOLON	
static	TokenNamestatic	
{	TokenNameLBRACE	
executor	TokenNameIdentifier	 executor
=	TokenNameEQUAL	
new	TokenNamenew	
JMXConfigurableThreadPoolExecutor	TokenNameIdentifier	 JMX Configurable Thread Pool Executor
(	TokenNameLPAREN	
4	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
60	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
TimeUnit	TokenNameIdentifier	 Time Unit
.	TokenNameDOT	
SECONDS	TokenNameIdentifier	 SECONDS
,	TokenNameCOMMA	
new	TokenNamenew	
LinkedBlockingQueue	TokenNameIdentifier	 Linked Blocking Queue
<	TokenNameLESS	
Runnable	TokenNameIdentifier	 Runnable
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
new	TokenNamenew	
NamedThreadFactory	TokenNameIdentifier	 Named Thread Factory
(	TokenNameLPAREN	
"AntiEntropySessions"	TokenNameStringLiteral	AntiEntropySessions
)	TokenNameRPAREN	
,	TokenNameCOMMA	
"internal"	TokenNameStringLiteral	internal
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * A map of active session. */	TokenNameCOMMENT_JAVADOC	 A map of active session. 
private	TokenNameprivate	
final	TokenNamefinal	
ConcurrentMap	TokenNameIdentifier	 Concurrent Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
RepairSession	TokenNameIdentifier	 Repair Session
>	TokenNameGREATER	
sessions	TokenNameIdentifier	 sessions
;	TokenNameSEMICOLON	
/** * Protected constructor. Use AntiEntropyService.instance. */	TokenNameCOMMENT_JAVADOC	 Protected constructor. Use AntiEntropyService.instance. 
protected	TokenNameprotected	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
sessions	TokenNameIdentifier	 sessions
=	TokenNameEQUAL	
new	TokenNamenew	
ConcurrentHashMap	TokenNameIdentifier	 Concurrent Hash Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
RepairSession	TokenNameIdentifier	 Repair Session
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Requests repairs for the given table and column families, and blocks until all repairs have been completed. * * @return Future for asynchronous call or null if there is no need to repair */	TokenNameCOMMENT_JAVADOC	 Requests repairs for the given table and column families, and blocks until all repairs have been completed. * @return Future for asynchronous call or null if there is no need to repair 
public	TokenNamepublic	
RepairFuture	TokenNameIdentifier	 Repair Future
submitRepairSession	TokenNameIdentifier	 submit Repair Session
(	TokenNameLPAREN	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isSequential	TokenNameIdentifier	 is Sequential
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isLocal	TokenNameIdentifier	 is Local
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
...	TokenNameELLIPSIS	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
RepairSession	TokenNameIdentifier	 Repair Session
session	TokenNameIdentifier	 session
=	TokenNameEQUAL	
new	TokenNamenew	
RepairSession	TokenNameIdentifier	 Repair Session
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
isSequential	TokenNameIdentifier	 is Sequential
,	TokenNameCOMMA	
isLocal	TokenNameIdentifier	 is Local
,	TokenNameCOMMA	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
endpoints	TokenNameIdentifier	 endpoints
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
null	TokenNamenull	
;	TokenNameSEMICOLON	
RepairFuture	TokenNameIdentifier	 Repair Future
futureTask	TokenNameIdentifier	 future Task
=	TokenNameEQUAL	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
getFuture	TokenNameIdentifier	 get Future
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
executor	TokenNameIdentifier	 executor
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
futureTask	TokenNameIdentifier	 future Task
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
futureTask	TokenNameIdentifier	 future Task
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
terminateSessions	TokenNameIdentifier	 terminate Sessions
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
RepairSession	TokenNameIdentifier	 Repair Session
session	TokenNameIdentifier	 session
:	TokenNameCOLON	
sessions	TokenNameIdentifier	 sessions
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
forceShutdown	TokenNameIdentifier	 force Shutdown
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// for testing only. Create a session corresponding to a fake request and 	TokenNameCOMMENT_LINE	for testing only. Create a session corresponding to a fake request and 
// add it to the sessions (avoid NPE in tests) 	TokenNameCOMMENT_LINE	add it to the sessions (avoid NPE in tests) 
RepairFuture	TokenNameIdentifier	 Repair Future
submitArtificialRepairSession	TokenNameIdentifier	 submit Artificial Repair Session
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
req	TokenNameIdentifier	 req
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
...	TokenNameELLIPSIS	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
RepairFuture	TokenNameIdentifier	 Repair Future
futureTask	TokenNameIdentifier	 future Task
=	TokenNameEQUAL	
new	TokenNamenew	
RepairSession	TokenNameIdentifier	 Repair Session
(	TokenNameLPAREN	
req	TokenNameIdentifier	 req
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
.	TokenNameDOT	
getFuture	TokenNameIdentifier	 get Future
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
executor	TokenNameIdentifier	 executor
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
futureTask	TokenNameIdentifier	 future Task
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
futureTask	TokenNameIdentifier	 future Task
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Return all of the neighbors with whom we share the provided range. * * @param table table to repair * @param toRepair token to repair * @param isLocal need to use only nodes from local datacenter * * @return neighbors with whom we share the provided range */	TokenNameCOMMENT_JAVADOC	 Return all of the neighbors with whom we share the provided range. * @param table table to repair @param toRepair token to repair @param isLocal need to use only nodes from local datacenter * @return neighbors with whom we share the provided range 
static	TokenNamestatic	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
getNeighbors	TokenNameIdentifier	 get Neighbors
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
table	TokenNameIdentifier	 table
,	TokenNameCOMMA	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
toRepair	TokenNameIdentifier	 to Repair
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isLocal	TokenNameIdentifier	 is Local
)	TokenNameRPAREN	
{	TokenNameLBRACE	
StorageService	TokenNameIdentifier	 Storage Service
ss	TokenNameIdentifier	 ss
=	TokenNameEQUAL	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
;	TokenNameSEMICOLON	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
,	TokenNameCOMMA	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>>	TokenNameRIGHT_SHIFT	
replicaSets	TokenNameIdentifier	 replica Sets
=	TokenNameEQUAL	
ss	TokenNameIdentifier	 ss
.	TokenNameDOT	
getRangeToAddressMap	TokenNameIdentifier	 get Range To Address Map
(	TokenNameLPAREN	
table	TokenNameIdentifier	 table
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
rangeSuperSet	TokenNameIdentifier	 range Super Set
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
:	TokenNameCOLON	
ss	TokenNameIdentifier	 ss
.	TokenNameDOT	
getLocalRanges	TokenNameIdentifier	 get Local Ranges
(	TokenNameLPAREN	
table	TokenNameIdentifier	 table
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
toRepair	TokenNameIdentifier	 to Repair
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
rangeSuperSet	TokenNameIdentifier	 range Super Set
=	TokenNameEQUAL	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
intersects	TokenNameIdentifier	 intersects
(	TokenNameLPAREN	
toRepair	TokenNameIdentifier	 to Repair
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
IllegalArgumentException	TokenNameIdentifier	 Illegal Argument Exception
(	TokenNameLPAREN	
"Requested range intersects a local range but is not fully contained in one; this would lead to imprecise repair"	TokenNameStringLiteral	Requested range intersects a local range but is not fully contained in one; this would lead to imprecise repair
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
rangeSuperSet	TokenNameIdentifier	 range Super Set
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
||	TokenNameOR_OR	
!	TokenNameNOT	
replicaSets	TokenNameIdentifier	 replica Sets
.	TokenNameDOT	
containsKey	TokenNameIdentifier	 contains Key
(	TokenNameLPAREN	
toRepair	TokenNameIdentifier	 to Repair
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
emptySet	TokenNameIdentifier	 empty Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
neighbors	TokenNameIdentifier	 neighbors
=	TokenNameEQUAL	
new	TokenNamenew	
HashSet	TokenNameIdentifier	 Hash Set
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
(	TokenNameLPAREN	
replicaSets	TokenNameIdentifier	 replica Sets
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
rangeSuperSet	TokenNameIdentifier	 range Super Set
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
neighbors	TokenNameIdentifier	 neighbors
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getBroadcastAddress	TokenNameIdentifier	 get Broadcast Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
isLocal	TokenNameIdentifier	 is Local
)	TokenNameRPAREN	
{	TokenNameLBRACE	
TokenMetadata	TokenNameIdentifier	 Token Metadata
.	TokenNameDOT	
Topology	TokenNameIdentifier	 Topology
topology	TokenNameIdentifier	 topology
=	TokenNameEQUAL	
ss	TokenNameIdentifier	 ss
.	TokenNameDOT	
getTokenMetadata	TokenNameIdentifier	 get Token Metadata
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
cloneOnlyTokenMap	TokenNameIdentifier	 clone Only Token Map
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getTopology	TokenNameIdentifier	 get Topology
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
localEndpoints	TokenNameIdentifier	 local Endpoints
=	TokenNameEQUAL	
Sets	TokenNameIdentifier	 Sets
.	TokenNameDOT	
newHashSet	TokenNameIdentifier	 new Hash Set
(	TokenNameLPAREN	
topology	TokenNameIdentifier	 topology
.	TokenNameDOT	
getDatacenterEndpoints	TokenNameIdentifier	 get Datacenter Endpoints
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getLocalDataCenter	TokenNameIdentifier	 get Local Data Center
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
Sets	TokenNameIdentifier	 Sets
.	TokenNameDOT	
intersection	TokenNameIdentifier	 intersection
(	TokenNameLPAREN	
neighbors	TokenNameIdentifier	 neighbors
,	TokenNameCOMMA	
localEndpoints	TokenNameIdentifier	 local Endpoints
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
return	TokenNamereturn	
neighbors	TokenNameIdentifier	 neighbors
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Register a tree for the given request to be compared to the appropriate trees in Stage.ANTIENTROPY when they become available. */	TokenNameCOMMENT_JAVADOC	 Register a tree for the given request to be compared to the appropriate trees in Stage.ANTIENTROPY when they become available. 
private	TokenNameprivate	
void	TokenNamevoid	
rendezvous	TokenNameIdentifier	 rendezvous
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
{	TokenNameLBRACE	
RepairSession	TokenNameIdentifier	 Repair Session
session	TokenNameIdentifier	 session
=	TokenNameEQUAL	
sessions	TokenNameIdentifier	 sessions
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
warn	TokenNameIdentifier	 warn
(	TokenNameLPAREN	
"Got a merkle tree response for unknown repair session {}: either this node has been restarted since the session was started, or the session has been interrupted for an unknown reason. "	TokenNameStringLiteral	Got a merkle tree response for unknown repair session {}: either this node has been restarted since the session was started, or the session has been interrupted for an unknown reason. 
,	TokenNameCOMMA	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
RepairSession	TokenNameIdentifier	 Repair Session
.	TokenNameDOT	
RepairJob	TokenNameIdentifier	 Repair Job
job	TokenNameIdentifier	 job
=	TokenNameEQUAL	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
job	TokenNameIdentifier	 job
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
terminated	TokenNameIdentifier	 terminated
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Received merkle tree for %s from %s"	TokenNameStringLiteral	[repair #%s] Received merkle tree for %s from %s
,	TokenNameCOMMA	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
,	TokenNameCOMMA	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
job	TokenNameIdentifier	 job
.	TokenNameDOT	
addTree	TokenNameIdentifier	 add Tree
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"All trees received for "	TokenNameStringLiteral	All trees received for 
+	TokenNamePLUS	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
"/"	TokenNameStringLiteral	/
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
job	TokenNameIdentifier	 job
.	TokenNameDOT	
submitDifferencers	TokenNameIdentifier	 submit Differencers
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// This job is complete, switching to next in line (note that only 	TokenNameCOMMENT_LINE	This job is complete, switching to next in line (note that only 
// one thread will can ever do this) 	TokenNameCOMMENT_LINE	one thread will can ever do this) 
session	TokenNameIdentifier	 session
.	TokenNameDOT	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
poll	TokenNameIdentifier	 poll
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
RepairSession	TokenNameIdentifier	 Repair Session
.	TokenNameDOT	
RepairJob	TokenNameIdentifier	 Repair Job
nextJob	TokenNameIdentifier	 next Job
=	TokenNameEQUAL	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
nextJob	TokenNameIdentifier	 next Job
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
// We are done with this repair session as far as differencing 	TokenNameCOMMENT_LINE	We are done with this repair session as far as differencing 
// is considern. Just inform the session 	TokenNameCOMMENT_LINE	is considern. Just inform the session 
session	TokenNameIdentifier	 session
.	TokenNameDOT	
differencingDone	TokenNameIdentifier	 differencing Done
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
else	TokenNameelse	
nextJob	TokenNameIdentifier	 next Job
.	TokenNameDOT	
sendTreeRequests	TokenNameIdentifier	 send Tree Requests
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Responds to the node that requested the given valid tree. * @param validator A locally generated validator * @param local localhost (parameterized for testing) */	TokenNameCOMMENT_JAVADOC	 Responds to the node that requested the given valid tree. @param validator A locally generated validator @param local localhost (parameterized for testing) 
void	TokenNamevoid	
respond	TokenNameIdentifier	 respond
(	TokenNameLPAREN	
Validator	TokenNameIdentifier	 Validator
validator	TokenNameIdentifier	 validator
,	TokenNameCOMMA	
InetAddress	TokenNameIdentifier	 Inet Address
local	TokenNameIdentifier	 local
)	TokenNameRPAREN	
{	TokenNameLBRACE	
MessagingService	TokenNameIdentifier	 Messaging Service
ms	TokenNameIdentifier	 ms
=	TokenNameEQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
.	TokenNameDOT	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getBroadcastAddress	TokenNameIdentifier	 get Broadcast Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Sending completed merkle tree to %s for %s"	TokenNameStringLiteral	[repair #%s] Sending completed merkle tree to %s for %s
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ms	TokenNameIdentifier	 ms
.	TokenNameDOT	
sendOneWay	TokenNameIdentifier	 send One Way
(	TokenNameLPAREN	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
createMessage	TokenNameIdentifier	 create Message
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
Exception	TokenNameIdentifier	 Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Error sending completed merkle tree to %s for %s "	TokenNameStringLiteral	[repair #%s] Error sending completed merkle tree to %s for %s 
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
,	TokenNameCOMMA	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * A Strategy to handle building and validating a merkle tree for a column family. * * Lifecycle: * 1. prepare() - Initialize tree with samples. * 2. add() - 0 or more times, to add hashes to the tree. * 3. complete() - Enqueues any operations that were blocked waiting for a valid tree. */	TokenNameCOMMENT_JAVADOC	 A Strategy to handle building and validating a merkle tree for a column family. * Lifecycle: 1. prepare() - Initialize tree with samples. 2. add() - 0 or more times, to add hashes to the tree. 3. complete() - Enqueues any operations that were blocked waiting for a valid tree. 
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
Validator	TokenNameIdentifier	 Validator
implements	TokenNameimplements	
Runnable	TokenNameIdentifier	 Runnable
{	TokenNameLBRACE	
public	TokenNamepublic	
final	TokenNamefinal	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
;	TokenNameSEMICOLON	
// null when all rows with the min token have been consumed 	TokenNameCOMMENT_LINE	null when all rows with the min token have been consumed 
private	TokenNameprivate	
transient	TokenNametransient	
long	TokenNamelong	
validated	TokenNameIdentifier	 validated
;	TokenNameSEMICOLON	
private	TokenNameprivate	
transient	TokenNametransient	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
TreeRange	TokenNameIdentifier	 Tree Range
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
private	TokenNameprivate	
transient	TokenNametransient	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
TreeRangeIterator	TokenNameIdentifier	 Tree Range Iterator
ranges	TokenNameIdentifier	 ranges
;	TokenNameSEMICOLON	
private	TokenNameprivate	
transient	TokenNametransient	
DecoratedKey	TokenNameIdentifier	 Decorated Key
lastKey	TokenNameIdentifier	 last Key
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
static	TokenNamestatic	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
RowHash	TokenNameIdentifier	 Row Hash
EMPTY_ROW	TokenNameIdentifier	 EMPTY  ROW
=	TokenNameEQUAL	
new	TokenNamenew	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
RowHash	TokenNameIdentifier	 Row Hash
(	TokenNameLPAREN	
null	TokenNamenull	
,	TokenNameCOMMA	
new	TokenNamenew	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
0	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
static	TokenNamestatic	
ValidatorSerializer	TokenNameIdentifier	 Validator Serializer
serializer	TokenNameIdentifier	 serializer
=	TokenNameEQUAL	
new	TokenNamenew	
ValidatorSerializer	TokenNameIdentifier	 Validator Serializer
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
Validator	TokenNameIdentifier	 Validator
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
// TODO: memory usage (maxsize) should either be tunable per 	TokenNameCOMMENT_LINE	TODO: memory usage (maxsize) should either be tunable per 
// CF, globally, or as shared for all CFs in a cluster 	TokenNameCOMMENT_LINE	CF, globally, or as shared for all CFs in a cluster 
new	TokenNamenew	
MerkleTree	TokenNameIdentifier	 Merkle Tree
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getPartitioner	TokenNameIdentifier	 get Partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
RECOMMENDED_DEPTH	TokenNameIdentifier	 RECOMMENDED  DEPTH
,	TokenNameCOMMA	
(	TokenNameLPAREN	
int	TokenNameint	
)	TokenNameRPAREN	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
pow	TokenNameIdentifier	 pow
(	TokenNameLPAREN	
2	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
15	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
Validator	TokenNameIdentifier	 Validator
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
request	TokenNameIdentifier	 request
=	TokenNameEQUAL	
request	TokenNameIdentifier	 request
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
=	TokenNameEQUAL	
tree	TokenNameIdentifier	 tree
;	TokenNameSEMICOLON	
// Reestablishing the range because we don't serialize it (for bad 	TokenNameCOMMENT_LINE	Reestablishing the range because we don't serialize it (for bad 
// reason - see MerkleTree for details) 	TokenNameCOMMENT_LINE	reason - see MerkleTree for details) 
this	TokenNamethis	
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
fullRange	TokenNameIdentifier	 full Range
=	TokenNameEQUAL	
this	TokenNamethis	
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
validated	TokenNameIdentifier	 validated
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
ranges	TokenNameIdentifier	 ranges
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
prepare	TokenNameIdentifier	 prepare
(	TokenNameLPAREN	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfs	TokenNameIdentifier	 cfs
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
partitioner	TokenNameIdentifier	 partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
instanceof	TokenNameinstanceof	
RandomPartitioner	TokenNameIdentifier	 Random Partitioner
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// You can't beat an even tree distribution for md5 	TokenNameCOMMENT_LINE	You can't beat an even tree distribution for md5 
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
init	TokenNameIdentifier	 init
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
>	TokenNameGREATER	
keys	TokenNameIdentifier	 keys
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
DecoratedKey	TokenNameIdentifier	 Decorated Key
sample	TokenNameIdentifier	 sample
:	TokenNameCOLON	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
keySamples	TokenNameIdentifier	 key Samples
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
sample	TokenNameIdentifier	 sample
.	TokenNameDOT	
token	TokenNameIdentifier	 token
)	TokenNameRPAREN	
:	TokenNameCOLON	
"Token "	TokenNameStringLiteral	Token 
+	TokenNamePLUS	
sample	TokenNameIdentifier	 sample
.	TokenNameDOT	
token	TokenNameIdentifier	 token
+	TokenNamePLUS	
" is not within range "	TokenNameStringLiteral	 is not within range 
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
keys	TokenNameIdentifier	 keys
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
sample	TokenNameIdentifier	 sample
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
keys	TokenNameIdentifier	 keys
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// use an even tree distribution 	TokenNameCOMMENT_LINE	use an even tree distribution 
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
init	TokenNameIdentifier	 init
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
int	TokenNameint	
numkeys	TokenNameIdentifier	 numkeys
=	TokenNameEQUAL	
keys	TokenNameIdentifier	 keys
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Random	TokenNameIdentifier	 Random
random	TokenNameIdentifier	 random
=	TokenNameEQUAL	
new	TokenNamenew	
Random	TokenNameIdentifier	 Random
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// sample the column family using random keys from the index 	TokenNameCOMMENT_LINE	sample the column family using random keys from the index 
while	TokenNamewhile	
(	TokenNameLPAREN	
true	TokenNametrue	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
DecoratedKey	TokenNameIdentifier	 Decorated Key
dk	TokenNameIdentifier	 dk
=	TokenNameEQUAL	
keys	TokenNameIdentifier	 keys
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
random	TokenNameIdentifier	 random
.	TokenNameDOT	
nextInt	TokenNameIdentifier	 next Int
(	TokenNameLPAREN	
numkeys	TokenNameIdentifier	 numkeys
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
split	TokenNameIdentifier	 split
(	TokenNameLPAREN	
dk	TokenNameIdentifier	 dk
.	TokenNameDOT	
token	TokenNameIdentifier	 token
)	TokenNameRPAREN	
)	TokenNameRPAREN	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Prepared AEService tree of size "	TokenNameStringLiteral	Prepared AEService tree of size 
+	TokenNamePLUS	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
" for "	TokenNameStringLiteral	 for 
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ranges	TokenNameIdentifier	 ranges
=	TokenNameEQUAL	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
invalids	TokenNameIdentifier	 invalids
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Called (in order) for every row present in the CF. * Hashes the row, and adds it to the tree being built. * * There are four possible cases: * 1. Token is greater than range.right (we haven't generated a range for it yet), * 2. Token is less than/equal to range.left (the range was valid), * 3. Token is contained in the range (the range is in progress), * 4. No more invalid ranges exist. * * TODO: Because we only validate completely empty trees at the moment, we * do not bother dealing with case 2 and case 4 should result in an error. * * Additionally, there is a special case for the minimum token, because * although it sorts first, it is contained in the last possible range. * * @param row The row. */	TokenNameCOMMENT_JAVADOC	 Called (in order) for every row present in the CF. Hashes the row, and adds it to the tree being built. * There are four possible cases: 1. Token is greater than range.right (we haven't generated a range for it yet), 2. Token is less than/equal to range.left (the range was valid), 3. Token is contained in the range (the range is in progress), 4. No more invalid ranges exist. * TODO: Because we only validate completely empty trees at the moment, we do not bother dealing with case 2 and case 4 should result in an error. * Additionally, there is a special case for the minimum token, because although it sorts first, it is contained in the last possible range. * @param row The row. 
public	TokenNamepublic	
void	TokenNamevoid	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
AbstractCompactedRow	TokenNameIdentifier	 Abstract Compacted Row
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
token	TokenNameIdentifier	 token
)	TokenNameRPAREN	
:	TokenNameCOLON	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
token	TokenNameIdentifier	 token
+	TokenNamePLUS	
" is not contained in "	TokenNameStringLiteral	 is not contained in 
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
assert	TokenNameassert	
lastKey	TokenNameIdentifier	 last Key
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
||	TokenNameOR_OR	
lastKey	TokenNameIdentifier	 last Key
.	TokenNameDOT	
compareTo	TokenNameIdentifier	 compare To
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
<	TokenNameLESS	
0	TokenNameIntegerLiteral	
:	TokenNameCOLON	
"row "	TokenNameStringLiteral	row 
+	TokenNamePLUS	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
+	TokenNamePLUS	
" received out of order wrt "	TokenNameStringLiteral	 received out of order wrt 
+	TokenNamePLUS	
lastKey	TokenNameIdentifier	 last Key
;	TokenNameSEMICOLON	
lastKey	TokenNameIdentifier	 last Key
=	TokenNameEQUAL	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
ranges	TokenNameIdentifier	 ranges
.	TokenNameDOT	
next	TokenNameIdentifier	 next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// generate new ranges as long as case 1 is true 	TokenNameCOMMENT_LINE	generate new ranges as long as case 1 is true 
while	TokenNamewhile	
(	TokenNameLPAREN	
!	TokenNameNOT	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
token	TokenNameIdentifier	 token
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// add the empty hash, and move to the next range 	TokenNameCOMMENT_LINE	add the empty hash, and move to the next range 
range	TokenNameIdentifier	 range
.	TokenNameDOT	
addHash	TokenNameIdentifier	 add Hash
(	TokenNameLPAREN	
EMPTY_ROW	TokenNameIdentifier	 EMPTY  ROW
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
ranges	TokenNameIdentifier	 ranges
.	TokenNameDOT	
next	TokenNameIdentifier	 next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// case 3 must be true: mix in the hashed row 	TokenNameCOMMENT_LINE	case 3 must be true: mix in the hashed row 
range	TokenNameIdentifier	 range
.	TokenNameDOT	
addHash	TokenNameIdentifier	 add Hash
(	TokenNameLPAREN	
rowHash	TokenNameIdentifier	 row Hash
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
RowHash	TokenNameIdentifier	 Row Hash
rowHash	TokenNameIdentifier	 row Hash
(	TokenNameLPAREN	
AbstractCompactedRow	TokenNameIdentifier	 Abstract Compacted Row
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
{	TokenNameLBRACE	
validated	TokenNameIdentifier	 validated
++	TokenNamePLUS_PLUS	
;	TokenNameSEMICOLON	
// MerkleTree uses XOR internally, so we want lots of output bits here 	TokenNameCOMMENT_LINE	MerkleTree uses XOR internally, so we want lots of output bits here 
MessageDigest	TokenNameIdentifier	 Message Digest
digest	TokenNameIdentifier	 digest
=	TokenNameEQUAL	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
newMessageDigest	TokenNameIdentifier	 new Message Digest
(	TokenNameLPAREN	
"SHA-256"	TokenNameStringLiteral	SHA-256
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
update	TokenNameIdentifier	 update
(	TokenNameLPAREN	
digest	TokenNameIdentifier	 digest
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
new	TokenNamenew	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
RowHash	TokenNameIdentifier	 Row Hash
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
token	TokenNameIdentifier	 token
,	TokenNameCOMMA	
digest	TokenNameIdentifier	 digest
.	TokenNameDOT	
digest	TokenNameIdentifier	 digest
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Registers the newly created tree for rendezvous in Stage.ANTIENTROPY. */	TokenNameCOMMENT_JAVADOC	 Registers the newly created tree for rendezvous in Stage.ANTIENTROPY. 
public	TokenNamepublic	
void	TokenNamevoid	
complete	TokenNameIdentifier	 complete
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
completeTree	TokenNameIdentifier	 complete Tree
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
StageManager	TokenNameIdentifier	 Stage Manager
.	TokenNameDOT	
getStage	TokenNameIdentifier	 get Stage
(	TokenNameLPAREN	
Stage	TokenNameIdentifier	 Stage
.	TokenNameDOT	
ANTI_ENTROPY	TokenNameIdentifier	 ANTI  ENTROPY
)	TokenNameRPAREN	
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Validated "	TokenNameStringLiteral	Validated 
+	TokenNamePLUS	
validated	TokenNameIdentifier	 validated
+	TokenNamePLUS	
" rows into AEService tree for "	TokenNameStringLiteral	 rows into AEService tree for 
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
void	TokenNamevoid	
completeTree	TokenNameIdentifier	 complete Tree
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
ranges	TokenNameIdentifier	 ranges
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
:	TokenNameCOLON	
"Validator was not prepared()"	TokenNameStringLiteral	Validator was not prepared()
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
addHash	TokenNameIdentifier	 add Hash
(	TokenNameLPAREN	
EMPTY_ROW	TokenNameIdentifier	 EMPTY  ROW
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
ranges	TokenNameIdentifier	 ranges
.	TokenNameDOT	
hasNext	TokenNameIdentifier	 has Next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
ranges	TokenNameIdentifier	 ranges
.	TokenNameDOT	
next	TokenNameIdentifier	 next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
range	TokenNameIdentifier	 range
.	TokenNameDOT	
addHash	TokenNameIdentifier	 add Hash
(	TokenNameLPAREN	
EMPTY_ROW	TokenNameIdentifier	 EMPTY  ROW
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Called after the validation lifecycle to respond with the now valid tree. Runs in Stage.ANTIENTROPY. */	TokenNameCOMMENT_JAVADOC	 Called after the validation lifecycle to respond with the now valid tree. Runs in Stage.ANTIENTROPY. 
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// respond to the request that triggered this validation 	TokenNameCOMMENT_LINE	respond to the request that triggered this validation 
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
respond	TokenNameIdentifier	 respond
(	TokenNameLPAREN	
this	TokenNamethis	
,	TokenNameCOMMA	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getBroadcastAddress	TokenNameIdentifier	 get Broadcast Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
MessageOut	TokenNameIdentifier	 Message Out
<	TokenNameLESS	
Validator	TokenNameIdentifier	 Validator
>	TokenNameGREATER	
createMessage	TokenNameIdentifier	 create Message
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
MessageOut	TokenNameIdentifier	 Message Out
<	TokenNameLESS	
Validator	TokenNameIdentifier	 Validator
>	TokenNameGREATER	
(	TokenNameLPAREN	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
Verb	TokenNameIdentifier	 Verb
.	TokenNameDOT	
TREE_RESPONSE	TokenNameIdentifier	 TREE  RESPONSE
,	TokenNameCOMMA	
this	TokenNamethis	
,	TokenNameCOMMA	
Validator	TokenNameIdentifier	 Validator
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
ValidatorSerializer	TokenNameIdentifier	 Validator Serializer
implements	TokenNameimplements	
IVersionedSerializer	TokenNameIdentifier	 I Versioned Serializer
<	TokenNameLESS	
Validator	TokenNameIdentifier	 Validator
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
Validator	TokenNameIdentifier	 Validator
validator	TokenNameIdentifier	 validator
,	TokenNameCOMMA	
DataOutput	TokenNameIdentifier	 Data Output
dos	TokenNameIdentifier	 dos
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
TreeRequest	TokenNameIdentifier	 Tree Request
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
dos	TokenNameIdentifier	 dos
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
,	TokenNameCOMMA	
dos	TokenNameIdentifier	 dos
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
Validator	TokenNameIdentifier	 Validator
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
DataInput	TokenNameIdentifier	 Data Input
dis	TokenNameIdentifier	 dis
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
final	TokenNamefinal	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
=	TokenNameEQUAL	
TreeRequest	TokenNameIdentifier	 Tree Request
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
dis	TokenNameIdentifier	 dis
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
Validator	TokenNameIdentifier	 Validator
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
dis	TokenNameIdentifier	 dis
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
Exception	TokenNameIdentifier	 Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
long	TokenNamelong	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
Validator	TokenNameIdentifier	 Validator
validator	TokenNameIdentifier	 validator
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
TreeRequest	TokenNameIdentifier	 Tree Request
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
+	TokenNamePLUS	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
validator	TokenNameIdentifier	 validator
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Handler for requests from remote nodes to generate a valid tree. * The payload is a CFPair representing the columnfamily to validate. */	TokenNameCOMMENT_JAVADOC	 Handler for requests from remote nodes to generate a valid tree. The payload is a CFPair representing the columnfamily to validate. 
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
TreeRequestVerbHandler	TokenNameIdentifier	 Tree Request Verb Handler
implements	TokenNameimplements	
IVerbHandler	TokenNameIdentifier	 I Verb Handler
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
{	TokenNameLBRACE	
/** * Trigger a validation compaction which will return the tree upon completion. */	TokenNameCOMMENT_JAVADOC	 Trigger a validation compaction which will return the tree upon completion. 
public	TokenNamepublic	
void	TokenNamevoid	
doVerb	TokenNameIdentifier	 do Verb
(	TokenNameLPAREN	
MessageIn	TokenNameIdentifier	 Message In
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
message	TokenNameIdentifier	 message
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
{	TokenNameLBRACE	
TreeRequest	TokenNameIdentifier	 Tree Request
remotereq	TokenNameIdentifier	 remotereq
=	TokenNameEQUAL	
message	TokenNameIdentifier	 message
.	TokenNameDOT	
payload	TokenNameIdentifier	 payload
;	TokenNameSEMICOLON	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
=	TokenNameEQUAL	
new	TokenNamenew	
TreeRequest	TokenNameIdentifier	 Tree Request
(	TokenNameLPAREN	
remotereq	TokenNameIdentifier	 remotereq
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
message	TokenNameIdentifier	 message
.	TokenNameDOT	
from	TokenNameIdentifier	 from
,	TokenNameCOMMA	
remotereq	TokenNameIdentifier	 remotereq
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
remotereq	TokenNameIdentifier	 remotereq
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// trigger read-only compaction 	TokenNameCOMMENT_LINE	trigger read-only compaction 
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
store	TokenNameIdentifier	 store
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
left	TokenNameIdentifier	 left
)	TokenNameRPAREN	
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Validator	TokenNameIdentifier	 Validator
validator	TokenNameIdentifier	 validator
=	TokenNameEQUAL	
new	TokenNamenew	
Validator	TokenNameIdentifier	 Validator
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Queueing validation compaction for "	TokenNameStringLiteral	Queueing validation compaction for 
+	TokenNamePLUS	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CompactionManager	TokenNameIdentifier	 Compaction Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
submitValidation	TokenNameIdentifier	 submit Validation
(	TokenNameLPAREN	
store	TokenNameIdentifier	 store
,	TokenNameCOMMA	
validator	TokenNameIdentifier	 validator
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Handler for responses from remote nodes which contain a valid tree. * The payload is a completed Validator object from the remote endpoint. */	TokenNameCOMMENT_JAVADOC	 Handler for responses from remote nodes which contain a valid tree. The payload is a completed Validator object from the remote endpoint. 
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
TreeResponseVerbHandler	TokenNameIdentifier	 Tree Response Verb Handler
implements	TokenNameimplements	
IVerbHandler	TokenNameIdentifier	 I Verb Handler
<	TokenNameLESS	
Validator	TokenNameIdentifier	 Validator
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
doVerb	TokenNameIdentifier	 do Verb
(	TokenNameLPAREN	
MessageIn	TokenNameIdentifier	 Message In
<	TokenNameLESS	
Validator	TokenNameIdentifier	 Validator
>	TokenNameGREATER	
message	TokenNameIdentifier	 message
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// deserialize the remote tree, and register it 	TokenNameCOMMENT_LINE	deserialize the remote tree, and register it 
Validator	TokenNameIdentifier	 Validator
response	TokenNameIdentifier	 response
=	TokenNameEQUAL	
message	TokenNameIdentifier	 message
.	TokenNameDOT	
payload	TokenNameIdentifier	 payload
;	TokenNameSEMICOLON	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
=	TokenNameEQUAL	
new	TokenNamenew	
TreeRequest	TokenNameIdentifier	 Tree Request
(	TokenNameLPAREN	
response	TokenNameIdentifier	 response
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
message	TokenNameIdentifier	 message
.	TokenNameDOT	
from	TokenNameIdentifier	 from
,	TokenNameCOMMA	
response	TokenNameIdentifier	 response
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
response	TokenNameIdentifier	 response
.	TokenNameDOT	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
rendezvous	TokenNameIdentifier	 rendezvous
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
response	TokenNameIdentifier	 response
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * A tuple of table and cf. */	TokenNameCOMMENT_JAVADOC	 A tuple of table and cf. 
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
CFPair	TokenNameIdentifier	 CF Pair
extends	TokenNameextends	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
CFPair	TokenNameIdentifier	 CF Pair
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
table	TokenNameIdentifier	 table
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
table	TokenNameIdentifier	 table
,	TokenNameCOMMA	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
table	TokenNameIdentifier	 table
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
&&	TokenNameAND_AND	
cf	TokenNameIdentifier	 cf
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * A tuple of table, cf, address and range that represents a location we have an outstanding TreeRequest for. */	TokenNameCOMMENT_JAVADOC	 A tuple of table, cf, address and range that represents a location we have an outstanding TreeRequest for. 
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
TreeRequest	TokenNameIdentifier	 Tree Request
{	TokenNameLBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
TreeRequestSerializer	TokenNameIdentifier	 Tree Request Serializer
serializer	TokenNameIdentifier	 serializer
=	TokenNameEQUAL	
new	TokenNamenew	
TreeRequestSerializer	TokenNameIdentifier	 Tree Request Serializer
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
sessionid	TokenNameIdentifier	 sessionid
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
CFPair	TokenNameIdentifier	 CF Pair
cf	TokenNameIdentifier	 cf
;	TokenNameSEMICOLON	
public	TokenNamepublic	
TreeRequest	TokenNameIdentifier	 Tree Request
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
CFPair	TokenNameIdentifier	 CF Pair
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
=	TokenNameEQUAL	
sessionid	TokenNameIdentifier	 sessionid
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
=	TokenNameEQUAL	
endpoint	TokenNameIdentifier	 endpoint
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
=	TokenNameEQUAL	
cf	TokenNameIdentifier	 cf
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
final	TokenNamefinal	
int	TokenNameint	
hashCode	TokenNameIdentifier	 hash Code
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
Objects	TokenNameIdentifier	 Objects
.	TokenNameDOT	
hashCode	TokenNameIdentifier	 hash Code
(	TokenNameLPAREN	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
cf	TokenNameIdentifier	 cf
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
final	TokenNamefinal	
boolean	TokenNameboolean	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
Object	TokenNameIdentifier	 Object
o	TokenNameIdentifier	 o
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
(	TokenNameLPAREN	
o	TokenNameIdentifier	 o
instanceof	TokenNameinstanceof	
TreeRequest	TokenNameIdentifier	 Tree Request
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
TreeRequest	TokenNameIdentifier	 Tree Request
that	TokenNameIdentifier	 that
=	TokenNameEQUAL	
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
)	TokenNameRPAREN	
o	TokenNameIdentifier	 o
;	TokenNameSEMICOLON	
// handles nulls properly 	TokenNameCOMMENT_LINE	handles nulls properly 
return	TokenNamereturn	
Objects	TokenNameIdentifier	 Objects
.	TokenNameDOT	
equal	TokenNameIdentifier	 equal
(	TokenNameLPAREN	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
that	TokenNameIdentifier	 that
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
Objects	TokenNameIdentifier	 Objects
.	TokenNameDOT	
equal	TokenNameIdentifier	 equal
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
that	TokenNameIdentifier	 that
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
Objects	TokenNameIdentifier	 Objects
.	TokenNameDOT	
equal	TokenNameIdentifier	 equal
(	TokenNameLPAREN	
cf	TokenNameIdentifier	 cf
,	TokenNameCOMMA	
that	TokenNameIdentifier	 that
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
Objects	TokenNameIdentifier	 Objects
.	TokenNameDOT	
equal	TokenNameIdentifier	 equal
(	TokenNameLPAREN	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
that	TokenNameIdentifier	 that
.	TokenNameDOT	
range	TokenNameIdentifier	 range
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
String	TokenNameIdentifier	 String
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
"#<TreeRequest "	TokenNameStringLiteral	#<TreeRequest 
+	TokenNamePLUS	
sessionid	TokenNameIdentifier	 sessionid
+	TokenNamePLUS	
", "	TokenNameStringLiteral	, 
+	TokenNamePLUS	
endpoint	TokenNameIdentifier	 endpoint
+	TokenNamePLUS	
", "	TokenNameStringLiteral	, 
+	TokenNamePLUS	
cf	TokenNameIdentifier	 cf
+	TokenNamePLUS	
", "	TokenNameStringLiteral	, 
+	TokenNamePLUS	
range	TokenNameIdentifier	 range
+	TokenNamePLUS	
">"	TokenNameStringLiteral	>
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
MessageOut	TokenNameIdentifier	 Message Out
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
createMessage	TokenNameIdentifier	 create Message
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
MessageOut	TokenNameIdentifier	 Message Out
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
(	TokenNameLPAREN	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
Verb	TokenNameIdentifier	 Verb
.	TokenNameDOT	
TREE_REQUEST	TokenNameIdentifier	 TREE  REQUEST
,	TokenNameCOMMA	
this	TokenNamethis	
,	TokenNameCOMMA	
TreeRequest	TokenNameIdentifier	 Tree Request
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
TreeRequestSerializer	TokenNameIdentifier	 Tree Request Serializer
implements	TokenNameimplements	
IVersionedSerializer	TokenNameIdentifier	 I Versioned Serializer
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
DataOutput	TokenNameIdentifier	 Data Output
dos	TokenNameIdentifier	 dos
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
dos	TokenNameIdentifier	 dos
.	TokenNameDOT	
writeUTF	TokenNameIdentifier	 write UTF
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CompactEndpointSerializationHelper	TokenNameIdentifier	 Compact Endpoint Serialization Helper
.	TokenNameDOT	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
dos	TokenNameIdentifier	 dos
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
dos	TokenNameIdentifier	 dos
.	TokenNameDOT	
writeUTF	TokenNameIdentifier	 write UTF
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
left	TokenNameIdentifier	 left
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
dos	TokenNameIdentifier	 dos
.	TokenNameDOT	
writeUTF	TokenNameIdentifier	 write UTF
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
AbstractBounds	TokenNameIdentifier	 Abstract Bounds
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serialize	TokenNameIdentifier	 serialize
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
dos	TokenNameIdentifier	 dos
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
TreeRequest	TokenNameIdentifier	 Tree Request
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
DataInput	TokenNameIdentifier	 Data Input
dis	TokenNameIdentifier	 dis
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
String	TokenNameIdentifier	 String
sessId	TokenNameIdentifier	 sess Id
=	TokenNameEQUAL	
dis	TokenNameIdentifier	 dis
.	TokenNameDOT	
readUTF	TokenNameIdentifier	 read UTF
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
=	TokenNameEQUAL	
CompactEndpointSerializationHelper	TokenNameIdentifier	 Compact Endpoint Serialization Helper
.	TokenNameDOT	
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
dis	TokenNameIdentifier	 dis
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CFPair	TokenNameIdentifier	 CF Pair
cfpair	TokenNameIdentifier	 cfpair
=	TokenNameEQUAL	
new	TokenNamenew	
CFPair	TokenNameIdentifier	 CF Pair
(	TokenNameLPAREN	
dis	TokenNameIdentifier	 dis
.	TokenNameDOT	
readUTF	TokenNameIdentifier	 read UTF
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
dis	TokenNameIdentifier	 dis
.	TokenNameDOT	
readUTF	TokenNameIdentifier	 read UTF
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
(	TokenNameLPAREN	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
)	TokenNameRPAREN	
AbstractBounds	TokenNameIdentifier	 Abstract Bounds
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
deserialize	TokenNameIdentifier	 deserialize
(	TokenNameLPAREN	
dis	TokenNameIdentifier	 dis
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
new	TokenNamenew	
TreeRequest	TokenNameIdentifier	 Tree Request
(	TokenNameLPAREN	
sessId	TokenNameIdentifier	 sess Id
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
cfpair	TokenNameIdentifier	 cfpair
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
long	TokenNamelong	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
int	TokenNameint	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
TypeSizes	TokenNameIdentifier	 Type Sizes
.	TokenNameDOT	
NATIVE	TokenNameIdentifier	 NATIVE
.	TokenNameDOT	
sizeof	TokenNameIdentifier	 sizeof
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
)	TokenNameRPAREN	
+	TokenNamePLUS	
CompactEndpointSerializationHelper	TokenNameIdentifier	 Compact Endpoint Serialization Helper
.	TokenNameDOT	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
+	TokenNamePLUS	
TypeSizes	TokenNameIdentifier	 Type Sizes
.	TokenNameDOT	
NATIVE	TokenNameIdentifier	 NATIVE
.	TokenNameDOT	
sizeof	TokenNameIdentifier	 sizeof
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
left	TokenNameIdentifier	 left
)	TokenNameRPAREN	
+	TokenNamePLUS	
TypeSizes	TokenNameIdentifier	 Type Sizes
.	TokenNameDOT	
NATIVE	TokenNameIdentifier	 NATIVE
.	TokenNameDOT	
sizeof	TokenNameIdentifier	 sizeof
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
)	TokenNameRPAREN	
+	TokenNamePLUS	
AbstractBounds	TokenNameIdentifier	 Abstract Bounds
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Triggers repairs with all neighbors for the given table, cfs and range. * Typical lifecycle is: start() then join(). Executed in client threads. */	TokenNameCOMMENT_JAVADOC	 Triggers repairs with all neighbors for the given table, cfs and range. Typical lifecycle is: start() then join(). Executed in client threads. 
static	TokenNamestatic	
class	TokenNameclass	
RepairSession	TokenNameIdentifier	 Repair Session
extends	TokenNameextends	
WrappedRunnable	TokenNameIdentifier	 Wrapped Runnable
implements	TokenNameimplements	
IEndpointStateChangeSubscriber	TokenNameIdentifier	 I Endpoint State Change Subscriber
,	TokenNameCOMMA	
IFailureDetectionEventListener	TokenNameIdentifier	 I Failure Detection Event Listener
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
sessionName	TokenNameIdentifier	 session Name
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
boolean	TokenNameboolean	
isSequential	TokenNameIdentifier	 is Sequential
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
cfnames	TokenNameIdentifier	 cfnames
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
private	TokenNameprivate	
volatile	TokenNamevolatile	
Exception	TokenNameIdentifier	 Exception
exception	TokenNameIdentifier	 exception
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
AtomicBoolean	TokenNameIdentifier	 Atomic Boolean
isFailed	TokenNameIdentifier	 is Failed
=	TokenNameEQUAL	
new	TokenNamenew	
AtomicBoolean	TokenNameIdentifier	 Atomic Boolean
(	TokenNameLPAREN	
false	TokenNamefalse	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
endpoints	TokenNameIdentifier	 endpoints
;	TokenNameSEMICOLON	
final	TokenNamefinal	
Queue	TokenNameIdentifier	 Queue
<	TokenNameLESS	
RepairJob	TokenNameIdentifier	 Repair Job
>	TokenNameGREATER	
jobs	TokenNameIdentifier	 jobs
=	TokenNameEQUAL	
new	TokenNamenew	
ConcurrentLinkedQueue	TokenNameIdentifier	 Concurrent Linked Queue
<	TokenNameLESS	
RepairJob	TokenNameIdentifier	 Repair Job
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
final	TokenNamefinal	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
RepairJob	TokenNameIdentifier	 Repair Job
>	TokenNameGREATER	
activeJobs	TokenNameIdentifier	 active Jobs
=	TokenNameEQUAL	
new	TokenNamenew	
ConcurrentHashMap	TokenNameIdentifier	 Concurrent Hash Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
RepairJob	TokenNameIdentifier	 Repair Job
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
SimpleCondition	TokenNameIdentifier	 Simple Condition
completed	TokenNameIdentifier	 completed
=	TokenNameEQUAL	
new	TokenNamenew	
SimpleCondition	TokenNameIdentifier	 Simple Condition
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
Condition	TokenNameIdentifier	 Condition
differencingDone	TokenNameIdentifier	 differencing Done
=	TokenNameEQUAL	
new	TokenNamenew	
SimpleCondition	TokenNameIdentifier	 Simple Condition
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
volatile	TokenNamevolatile	
boolean	TokenNameboolean	
terminated	TokenNameIdentifier	 terminated
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
RepairSession	TokenNameIdentifier	 Repair Session
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
req	TokenNameIdentifier	 req
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
...	TokenNameELLIPSIS	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
(	TokenNameLPAREN	
req	TokenNameIdentifier	 req
.	TokenNameDOT	
sessionid	TokenNameIdentifier	 sessionid
,	TokenNameCOMMA	
req	TokenNameIdentifier	 req
.	TokenNameDOT	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
false	TokenNamefalse	
,	TokenNameCOMMA	
false	TokenNamefalse	
,	TokenNameCOMMA	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
sessions	TokenNameIdentifier	 sessions
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
RepairSession	TokenNameIdentifier	 Repair Session
(	TokenNameLPAREN	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isSequential	TokenNameIdentifier	 is Sequential
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isLocal	TokenNameIdentifier	 is Local
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
...	TokenNameELLIPSIS	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
(	TokenNameLPAREN	
UUIDGen	TokenNameIdentifier	 UUID Gen
.	TokenNameDOT	
getTimeUUID	TokenNameIdentifier	 get Time UUID
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
isSequential	TokenNameIdentifier	 is Sequential
,	TokenNameCOMMA	
isLocal	TokenNameIdentifier	 is Local
,	TokenNameCOMMA	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
RepairSession	TokenNameIdentifier	 Repair Session
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
id	TokenNameIdentifier	 id
,	TokenNameCOMMA	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>	TokenNameGREATER	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isSequential	TokenNameIdentifier	 is Sequential
,	TokenNameCOMMA	
boolean	TokenNameboolean	
isLocal	TokenNameIdentifier	 is Local
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
sessionName	TokenNameIdentifier	 session Name
=	TokenNameEQUAL	
id	TokenNameIdentifier	 id
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
isSequential	TokenNameIdentifier	 is Sequential
=	TokenNameEQUAL	
isSequential	TokenNameIdentifier	 is Sequential
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
tablename	TokenNameIdentifier	 tablename
=	TokenNameEQUAL	
tablename	TokenNameIdentifier	 tablename
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
cfnames	TokenNameIdentifier	 cfnames
=	TokenNameEQUAL	
cfnames	TokenNameIdentifier	 cfnames
;	TokenNameSEMICOLON	
assert	TokenNameassert	
cfnames	TokenNameIdentifier	 cfnames
.	TokenNameDOT	
length	TokenNameIdentifier	 length
>	TokenNameGREATER	
0	TokenNameIntegerLiteral	
:	TokenNameCOLON	
"Repairing no column families seems pointless, doesn't it"	TokenNameStringLiteral	Repairing no column families seems pointless, doesn't it
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
range	TokenNameIdentifier	 range
=	TokenNameEQUAL	
range	TokenNameIdentifier	 range
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
endpoints	TokenNameIdentifier	 endpoints
=	TokenNameEQUAL	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
getNeighbors	TokenNameIdentifier	 get Neighbors
(	TokenNameLPAREN	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
isLocal	TokenNameIdentifier	 is Local
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
String	TokenNameIdentifier	 String
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
sessionName	TokenNameIdentifier	 session Name
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
RepairFuture	TokenNameIdentifier	 Repair Future
getFuture	TokenNameIdentifier	 get Future
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
RepairFuture	TokenNameIdentifier	 Repair Future
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
String	TokenNameIdentifier	 String
repairedNodes	TokenNameIdentifier	 repaired Nodes
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
StringBuilder	TokenNameIdentifier	 String Builder
sb	TokenNameIdentifier	 sb
=	TokenNameEQUAL	
new	TokenNamenew	
StringBuilder	TokenNameIdentifier	 String Builder
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
sb	TokenNameIdentifier	 sb
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getBroadcastAddress	TokenNameIdentifier	 get Broadcast Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
ep	TokenNameIdentifier	 ep
:	TokenNameCOLON	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
sb	TokenNameIdentifier	 sb
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
", "	TokenNameStringLiteral	, 
)	TokenNameRPAREN	
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
ep	TokenNameIdentifier	 ep
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
sb	TokenNameIdentifier	 sb
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// we don't care about the return value but care about it throwing exception 	TokenNameCOMMENT_LINE	we don't care about the return value but care about it throwing exception 
public	TokenNamepublic	
void	TokenNamevoid	
runMayThrow	TokenNameIdentifier	 run May Throw
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
Exception	TokenNameIdentifier	 Exception
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] new session: will sync %s on range %s for %s.%s"	TokenNameStringLiteral	[repair #%s] new session: will sync %s on range %s for %s.%s
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
repairedNodes	TokenNameIdentifier	 repaired Nodes
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
Arrays	TokenNameIdentifier	 Arrays
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
endpoints	TokenNameIdentifier	 endpoints
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
differencingDone	TokenNameIdentifier	 differencing Done
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] No neighbors to repair with on range %s: session completed"	TokenNameStringLiteral	[repair #%s] No neighbors to repair with on range %s: session completed
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// Checking all nodes are live 	TokenNameCOMMENT_LINE	Checking all nodes are live 
for	TokenNamefor	
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
:	TokenNameCOLON	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
FailureDetector	TokenNameIdentifier	 Failure Detector
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isAlive	TokenNameIdentifier	 is Alive
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
differencingDone	TokenNameIdentifier	 differencing Done
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Cannot proceed on repair because a neighbor (%s) is dead: session failed"	TokenNameStringLiteral	[repair #%s] Cannot proceed on repair because a neighbor (%s) is dead: session failed
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getVersion	TokenNameIdentifier	 get Version
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
<	TokenNameLESS	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
VERSION_11	TokenNameIdentifier	 VERSION 11
&&	TokenNameAND_AND	
isSequential	TokenNameIdentifier	 is Sequential
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Cannot repair using snapshots as node %s is pre-1.1"	TokenNameStringLiteral	[repair #%s] Cannot repair using snapshots as node %s is pre-1.1
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
sessions	TokenNameIdentifier	 sessions
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Gossiper	TokenNameIdentifier	 Gossiper
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
register	TokenNameIdentifier	 register
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
FailureDetector	TokenNameIdentifier	 Failure Detector
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
registerFailureDetectionEventListener	TokenNameIdentifier	 register Failure Detection Event Listener
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
// Create and queue a RepairJob for each column family 	TokenNameCOMMENT_LINE	Create and queue a RepairJob for each column family 
for	TokenNamefor	
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
cfname	TokenNameIdentifier	 cfname
:	TokenNameCOLON	
cfnames	TokenNameIdentifier	 cfnames
)	TokenNameRPAREN	
{	TokenNameLBRACE	
RepairJob	TokenNameIdentifier	 Repair Job
job	TokenNameIdentifier	 job
=	TokenNameEQUAL	
new	TokenNamenew	
RepairJob	TokenNameIdentifier	 Repair Job
(	TokenNameLPAREN	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
offer	TokenNameIdentifier	 offer
(	TokenNameLPAREN	
job	TokenNameIdentifier	 job
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
job	TokenNameIdentifier	 job
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
sendTreeRequests	TokenNameIdentifier	 send Tree Requests
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// block whatever thread started this session until all requests have been returned: 	TokenNameCOMMENT_LINE	block whatever thread started this session until all requests have been returned: 
// if this thread dies, the session will still complete in the background 	TokenNameCOMMENT_LINE	if this thread dies, the session will still complete in the background 
completed	TokenNameIdentifier	 completed
.	TokenNameDOT	
await	TokenNameIdentifier	 await
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
exception	TokenNameIdentifier	 exception
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] session completed successfully"	TokenNameStringLiteral	[repair #%s] session completed successfully
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] session completed with the following error"	TokenNameStringLiteral	[repair #%s] session completed with the following error
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
exception	TokenNameIdentifier	 exception
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throw	TokenNamethrow	
exception	TokenNameIdentifier	 exception
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
"Interrupted while waiting for repair."	TokenNameStringLiteral	Interrupted while waiting for repair.
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
finally	TokenNamefinally	
{	TokenNameLBRACE	
// mark this session as terminated 	TokenNameCOMMENT_LINE	mark this session as terminated 
terminate	TokenNameIdentifier	 terminate
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
FailureDetector	TokenNameIdentifier	 Failure Detector
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
unregisterFailureDetectionEventListener	TokenNameIdentifier	 unregister Failure Detection Event Listener
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Gossiper	TokenNameIdentifier	 Gossiper
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
unregister	TokenNameIdentifier	 unregister
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
AntiEntropyService	TokenNameIdentifier	 Anti Entropy Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
sessions	TokenNameIdentifier	 sessions
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * @return wheather this session is terminated */	TokenNameCOMMENT_JAVADOC	 @return wheather this session is terminated 
public	TokenNamepublic	
boolean	TokenNameboolean	
terminated	TokenNameIdentifier	 terminated
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
terminated	TokenNameIdentifier	 terminated
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
terminate	TokenNameIdentifier	 terminate
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
terminated	TokenNameIdentifier	 terminated
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
RepairJob	TokenNameIdentifier	 Repair Job
job	TokenNameIdentifier	 job
:	TokenNameCOLON	
jobs	TokenNameIdentifier	 jobs
)	TokenNameRPAREN	
job	TokenNameIdentifier	 job
.	TokenNameDOT	
terminate	TokenNameIdentifier	 terminate
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
jobs	TokenNameIdentifier	 jobs
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * clear all RepairJobs and terminate this session. */	TokenNameCOMMENT_JAVADOC	 clear all RepairJobs and terminate this session. 
public	TokenNamepublic	
void	TokenNamevoid	
forceShutdown	TokenNameIdentifier	 force Shutdown
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
differencingDone	TokenNameIdentifier	 differencing Done
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
completed	TokenNameIdentifier	 completed
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
void	TokenNamevoid	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
Differencer	TokenNameIdentifier	 Differencer
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Repair completed between %s and %s on %s"	TokenNameStringLiteral	[repair #%s] Repair completed between %s and %s on %s
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
RepairJob	TokenNameIdentifier	 Repair Job
job	TokenNameIdentifier	 job
=	TokenNameEQUAL	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
job	TokenNameIdentifier	 job
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
terminated	TokenNameIdentifier	 terminated
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
job	TokenNameIdentifier	 job
.	TokenNameDOT	
completedSynchronization	TokenNameIdentifier	 completed Synchronization
(	TokenNameLPAREN	
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
String	TokenNameIdentifier	 String
remaining	TokenNameIdentifier	 remaining
=	TokenNameEQUAL	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
0	TokenNameIntegerLiteral	
?	TokenNameQUESTION	
""	TokenNameStringLiteral	 
:	TokenNameCOLON	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
" (%d remaining column family to sync for this session)"	TokenNameStringLiteral	 (%d remaining column family to sync for this session)
,	TokenNameCOMMA	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] %s is fully synced%s"	TokenNameStringLiteral	[repair #%s] %s is fully synced%s
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
differencer	TokenNameIdentifier	 differencer
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
remaining	TokenNameIdentifier	 remaining
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
activeJobs	TokenNameIdentifier	 active Jobs
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
completed	TokenNameIdentifier	 completed
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
void	TokenNamevoid	
failedNode	TokenNameIdentifier	 failed Node
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
remote	TokenNameIdentifier	 remote
)	TokenNameRPAREN	
{	TokenNameLBRACE	
String	TokenNameIdentifier	 String
errorMsg	TokenNameIdentifier	 error Msg
=	TokenNameEQUAL	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"Endpoint %s died"	TokenNameStringLiteral	Endpoint %s died
,	TokenNameCOMMA	
remote	TokenNameIdentifier	 remote
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
exception	TokenNameIdentifier	 exception
=	TokenNameEQUAL	
new	TokenNamenew	
IOException	TokenNameIdentifier	 IO Exception
(	TokenNameLPAREN	
errorMsg	TokenNameIdentifier	 error Msg
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// If a node failed, we stop everything (though there could still be some activity in the background) 	TokenNameCOMMENT_LINE	If a node failed, we stop everything (though there could still be some activity in the background) 
forceShutdown	TokenNameIdentifier	 force Shutdown
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onJoin	TokenNameIdentifier	 on Join
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
EndpointState	TokenNameIdentifier	 Endpoint State
epState	TokenNameIdentifier	 ep State
)	TokenNameRPAREN	
{	TokenNameLBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onChange	TokenNameIdentifier	 on Change
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
ApplicationState	TokenNameIdentifier	 Application State
state	TokenNameIdentifier	 state
,	TokenNameCOMMA	
VersionedValue	TokenNameIdentifier	 Versioned Value
value	TokenNameIdentifier	 value
)	TokenNameRPAREN	
{	TokenNameLBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onAlive	TokenNameIdentifier	 on Alive
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
EndpointState	TokenNameIdentifier	 Endpoint State
state	TokenNameIdentifier	 state
)	TokenNameRPAREN	
{	TokenNameLBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onDead	TokenNameIdentifier	 on Dead
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
EndpointState	TokenNameIdentifier	 Endpoint State
state	TokenNameIdentifier	 state
)	TokenNameRPAREN	
{	TokenNameLBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onRemove	TokenNameIdentifier	 on Remove
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
{	TokenNameLBRACE	
convict	TokenNameIdentifier	 convict
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
Double	TokenNameIdentifier	 Double
.	TokenNameDOT	
MAX_VALUE	TokenNameIdentifier	 MAX  VALUE
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
onRestart	TokenNameIdentifier	 on Restart
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
EndpointState	TokenNameIdentifier	 Endpoint State
epState	TokenNameIdentifier	 ep State
)	TokenNameRPAREN	
{	TokenNameLBRACE	
convict	TokenNameIdentifier	 convict
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
Double	TokenNameIdentifier	 Double
.	TokenNameDOT	
MAX_VALUE	TokenNameIdentifier	 MAX  VALUE
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
convict	TokenNameIdentifier	 convict
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
double	TokenNamedouble	
phi	TokenNameIdentifier	 phi
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
endpoints	TokenNameIdentifier	 endpoints
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
// We want a higher confidence in the failure detection than usual because failing a repair wrongly has a high cost. 	TokenNameCOMMENT_LINE	We want a higher confidence in the failure detection than usual because failing a repair wrongly has a high cost. 
if	TokenNameif	
(	TokenNameLPAREN	
phi	TokenNameIdentifier	 phi
<	TokenNameLESS	
2	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getPhiConvictThreshold	TokenNameIdentifier	 get Phi Convict Threshold
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
// Though unlikely, it is possible to arrive here multiple time and we 	TokenNameCOMMENT_LINE	Though unlikely, it is possible to arrive here multiple time and we 
// want to avoid print an error message twice 	TokenNameCOMMENT_LINE	want to avoid print an error message twice 
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
isFailed	TokenNameIdentifier	 is Failed
.	TokenNameDOT	
compareAndSet	TokenNameIdentifier	 compare And Set
(	TokenNameLPAREN	
false	TokenNamefalse	
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
failedNode	TokenNameIdentifier	 failed Node
(	TokenNameLPAREN	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
class	TokenNameclass	
RepairJob	TokenNameIdentifier	 Repair Job
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
cfname	TokenNameIdentifier	 cfname
;	TokenNameSEMICOLON	
// first we send tree requests. this tracks the endpoints remaining to hear from 	TokenNameCOMMENT_LINE	first we send tree requests. this tracks the endpoints remaining to hear from 
private	TokenNameprivate	
final	TokenNamefinal	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
treeRequests	TokenNameIdentifier	 tree Requests
;	TokenNameSEMICOLON	
// tree responses are then tracked here 	TokenNameCOMMENT_LINE	tree responses are then tracked here 
private	TokenNameprivate	
final	TokenNamefinal	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
TreeResponse	TokenNameIdentifier	 Tree Response
>	TokenNameGREATER	
trees	TokenNameIdentifier	 trees
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
TreeResponse	TokenNameIdentifier	 Tree Response
>	TokenNameGREATER	
(	TokenNameLPAREN	
endpoints	TokenNameIdentifier	 endpoints
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// once all responses are received, each tree is compared with each other, and differencer tasks 	TokenNameCOMMENT_LINE	once all responses are received, each tree is compared with each other, and differencer tasks 
// are submitted. the job is done when all differencers are complete. 	TokenNameCOMMENT_LINE	are submitted. the job is done when all differencers are complete. 
private	TokenNameprivate	
final	TokenNamefinal	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
Differencer	TokenNameIdentifier	 Differencer
>	TokenNameGREATER	
differencers	TokenNameIdentifier	 differencers
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Condition	TokenNameIdentifier	 Condition
requestsSent	TokenNameIdentifier	 requests Sent
=	TokenNameEQUAL	
new	TokenNamenew	
SimpleCondition	TokenNameIdentifier	 Simple Condition
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
CountDownLatch	TokenNameIdentifier	 Count Down Latch
snapshotLatch	TokenNameIdentifier	 snapshot Latch
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
RepairJob	TokenNameIdentifier	 Repair Job
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
=	TokenNameEQUAL	
cfname	TokenNameIdentifier	 cfname
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
treeRequests	TokenNameIdentifier	 tree Requests
=	TokenNameEQUAL	
new	TokenNamenew	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
TreeRequest	TokenNameIdentifier	 Tree Request
>	TokenNameGREATER	
(	TokenNameLPAREN	
isSequential	TokenNameIdentifier	 is Sequential
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
r	TokenNameIdentifier	 r
)	TokenNameRPAREN	
{	TokenNameLBRACE	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
sendOneWay	TokenNameIdentifier	 send One Way
(	TokenNameLPAREN	
r	TokenNameIdentifier	 r
.	TokenNameDOT	
createMessage	TokenNameIdentifier	 create Message
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
r	TokenNameIdentifier	 r
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
differencers	TokenNameIdentifier	 differencers
=	TokenNameEQUAL	
new	TokenNamenew	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
Differencer	TokenNameIdentifier	 Differencer
>	TokenNameGREATER	
(	TokenNameLPAREN	
isSequential	TokenNameIdentifier	 is Sequential
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
Differencer	TokenNameIdentifier	 Differencer
d	TokenNameIdentifier	 d
)	TokenNameRPAREN	
{	TokenNameLBRACE	
StageManager	TokenNameIdentifier	 Stage Manager
.	TokenNameDOT	
getStage	TokenNameIdentifier	 get Stage
(	TokenNameLPAREN	
Stage	TokenNameIdentifier	 Stage
.	TokenNameDOT	
ANTI_ENTROPY	TokenNameIdentifier	 ANTI  ENTROPY
)	TokenNameRPAREN	
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
d	TokenNameIdentifier	 d
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Send merkle tree request to every involved neighbor. */	TokenNameCOMMENT_JAVADOC	 Send merkle tree request to every involved neighbor. 
public	TokenNamepublic	
void	TokenNamevoid	
sendTreeRequests	TokenNameIdentifier	 send Tree Requests
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// send requests to all nodes 	TokenNameCOMMENT_LINE	send requests to all nodes 
List	TokenNameIdentifier	 List
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
allEndpoints	TokenNameIdentifier	 all Endpoints
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
(	TokenNameLPAREN	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
allEndpoints	TokenNameIdentifier	 all Endpoints
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getBroadcastAddress	TokenNameIdentifier	 get Broadcast Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
isSequential	TokenNameIdentifier	 is Sequential
)	TokenNameRPAREN	
makeSnapshots	TokenNameIdentifier	 make Snapshots
(	TokenNameLPAREN	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
:	TokenNameCOLON	
allEndpoints	TokenNameIdentifier	 all Endpoints
)	TokenNameRPAREN	
treeRequests	TokenNameIdentifier	 tree Requests
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
TreeRequest	TokenNameIdentifier	 Tree Request
(	TokenNameLPAREN	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
range	TokenNameIdentifier	 range
,	TokenNameCOMMA	
new	TokenNamenew	
CFPair	TokenNameIdentifier	 CF Pair
(	TokenNameLPAREN	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] requesting merkle trees for %s (to %s)"	TokenNameStringLiteral	[repair #%s] requesting merkle trees for %s (to %s)
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
allEndpoints	TokenNameIdentifier	 all Endpoints
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
treeRequests	TokenNameIdentifier	 tree Requests
.	TokenNameDOT	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
requestsSent	TokenNameIdentifier	 requests Sent
.	TokenNameDOT	
signalAll	TokenNameIdentifier	 signal All
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
makeSnapshots	TokenNameIdentifier	 make Snapshots
(	TokenNameLPAREN	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
InetAddress	TokenNameIdentifier	 Inet Address
>	TokenNameGREATER	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
=	TokenNameEQUAL	
new	TokenNamenew	
CountDownLatch	TokenNameIdentifier	 Count Down Latch
(	TokenNameLPAREN	
endpoints	TokenNameIdentifier	 endpoints
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
IAsyncCallback	TokenNameIdentifier	 I Async Callback
callback	TokenNameIdentifier	 callback
=	TokenNameEQUAL	
new	TokenNamenew	
IAsyncCallback	TokenNameIdentifier	 I Async Callback
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
boolean	TokenNameboolean	
isLatencyForSnitch	TokenNameIdentifier	 is Latency For Snitch
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
response	TokenNameIdentifier	 response
(	TokenNameLPAREN	
MessageIn	TokenNameIdentifier	 Message In
msg	TokenNameIdentifier	 msg
)	TokenNameRPAREN	
{	TokenNameLBRACE	
RepairJob	TokenNameIdentifier	 Repair Job
.	TokenNameDOT	
this	TokenNamethis	
.	TokenNameDOT	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
.	TokenNameDOT	
countDown	TokenNameIdentifier	 count Down
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
:	TokenNameCOLON	
endpoints	TokenNameIdentifier	 endpoints
)	TokenNameRPAREN	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
sendRR	TokenNameIdentifier	 send RR
(	TokenNameLPAREN	
new	TokenNamenew	
SnapshotCommand	TokenNameIdentifier	 Snapshot Command
(	TokenNameLPAREN	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
sessionName	TokenNameIdentifier	 session Name
,	TokenNameCOMMA	
false	TokenNamefalse	
)	TokenNameRPAREN	
.	TokenNameDOT	
createMessage	TokenNameIdentifier	 create Message
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
callback	TokenNameIdentifier	 callback
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
.	TokenNameDOT	
await	TokenNameIdentifier	 await
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Add a new received tree and return the number of remaining tree to * be received for the job to be complete. * * Callers may assume exactly one addTree call will result in zero remaining endpoints. */	TokenNameCOMMENT_JAVADOC	 Add a new received tree and return the number of remaining tree to be received for the job to be complete. * Callers may assume exactly one addTree call will result in zero remaining endpoints. 
public	TokenNamepublic	
synchronized	TokenNamesynchronized	
int	TokenNameint	
addTree	TokenNameIdentifier	 add Tree
(	TokenNameLPAREN	
TreeRequest	TokenNameIdentifier	 Tree Request
request	TokenNameIdentifier	 request
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// Wait for all request to have been performed (see #3400) 	TokenNameCOMMENT_LINE	Wait for all request to have been performed (see #3400) 
try	TokenNametry	
{	TokenNameLBRACE	
requestsSent	TokenNameIdentifier	 requests Sent
.	TokenNameDOT	
await	TokenNameIdentifier	 await
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
AssertionError	TokenNameIdentifier	 Assertion Error
(	TokenNameLPAREN	
"Interrupted while waiting for requests to be sent"	TokenNameStringLiteral	Interrupted while waiting for requests to be sent
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
assert	TokenNameassert	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
right	TokenNameIdentifier	 right
.	TokenNameDOT	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
TreeResponse	TokenNameIdentifier	 Tree Response
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
treeRequests	TokenNameIdentifier	 tree Requests
.	TokenNameDOT	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Submit differencers for running. * All tree *must* have been received before this is called. */	TokenNameCOMMENT_JAVADOC	 Submit differencers for running. All tree *must* have been received before this is called. 
public	TokenNamepublic	
void	TokenNamevoid	
submitDifferencers	TokenNameIdentifier	 submit Differencers
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// We need to difference all trees one against another 	TokenNameCOMMENT_LINE	We need to difference all trees one against another 
for	TokenNamefor	
(	TokenNameLPAREN	
int	TokenNameint	
i	TokenNameIdentifier	 i
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
i	TokenNameIdentifier	 i
<	TokenNameLESS	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
++	TokenNamePLUS_PLUS	
i	TokenNameIdentifier	 i
)	TokenNameRPAREN	
{	TokenNameLBRACE	
TreeResponse	TokenNameIdentifier	 Tree Response
r1	TokenNameIdentifier	 r1
=	TokenNameEQUAL	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
i	TokenNameIdentifier	 i
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
int	TokenNameint	
j	TokenNameIdentifier	 j
=	TokenNameEQUAL	
i	TokenNameIdentifier	 i
+	TokenNamePLUS	
1	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
j	TokenNameIdentifier	 j
<	TokenNameLESS	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
++	TokenNamePLUS_PLUS	
j	TokenNameIdentifier	 j
)	TokenNameRPAREN	
{	TokenNameLBRACE	
TreeResponse	TokenNameIdentifier	 Tree Response
r2	TokenNameIdentifier	 r2
=	TokenNameEQUAL	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
j	TokenNameIdentifier	 j
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Differencer	TokenNameIdentifier	 Differencer
differencer	TokenNameIdentifier	 differencer
=	TokenNameEQUAL	
new	TokenNamenew	
Differencer	TokenNameIdentifier	 Differencer
(	TokenNameLPAREN	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
r1	TokenNameIdentifier	 r1
,	TokenNameCOMMA	
r2	TokenNameIdentifier	 r2
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Queueing comparison {}"	TokenNameStringLiteral	Queueing comparison {}
,	TokenNameCOMMA	
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
differencers	TokenNameIdentifier	 differencers
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
differencers	TokenNameIdentifier	 differencers
.	TokenNameDOT	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
trees	TokenNameIdentifier	 trees
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// allows gc to do its thing 	TokenNameCOMMENT_LINE	allows gc to do its thing 
}	TokenNameRBRACE	
/** * @return true if the @param differencer was the last remaining */	TokenNameCOMMENT_JAVADOC	 @return true if the @param differencer was the last remaining 
synchronized	TokenNamesynchronized	
boolean	TokenNameboolean	
completedSynchronization	TokenNameIdentifier	 completed Synchronization
(	TokenNameLPAREN	
Differencer	TokenNameIdentifier	 Differencer
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
differencers	TokenNameIdentifier	 differencers
.	TokenNameDOT	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
differencer	TokenNameIdentifier	 differencer
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
terminate	TokenNameIdentifier	 terminate
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
while	TokenNamewhile	
(	TokenNameLPAREN	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
.	TokenNameDOT	
getCount	TokenNameIdentifier	 get Count
(	TokenNameLPAREN	
)	TokenNameRPAREN	
>	TokenNameGREATER	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
snapshotLatch	TokenNameIdentifier	 snapshot Latch
.	TokenNameDOT	
countDown	TokenNameIdentifier	 count Down
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Runs on the node that initiated a request to compare two trees, and launch repairs for disagreeing ranges. */	TokenNameCOMMENT_JAVADOC	 Runs on the node that initiated a request to compare two trees, and launch repairs for disagreeing ranges. 
class	TokenNameclass	
Differencer	TokenNameIdentifier	 Differencer
implements	TokenNameimplements	
Runnable	TokenNameIdentifier	 Runnable
{	TokenNameLBRACE	
public	TokenNamepublic	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
cfname	TokenNameIdentifier	 cfname
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
TreeResponse	TokenNameIdentifier	 Tree Response
r1	TokenNameIdentifier	 r1
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
TreeResponse	TokenNameIdentifier	 Tree Response
r2	TokenNameIdentifier	 r2
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>>	TokenNameRIGHT_SHIFT	
differences	TokenNameIdentifier	 differences
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
Range	TokenNameIdentifier	 Range
<	TokenNameLESS	
Token	TokenNameIdentifier	 Token
>>	TokenNameRIGHT_SHIFT	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Differencer	TokenNameIdentifier	 Differencer
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
TreeResponse	TokenNameIdentifier	 Tree Response
r1	TokenNameIdentifier	 r1
,	TokenNameCOMMA	
TreeResponse	TokenNameIdentifier	 Tree Response
r2	TokenNameIdentifier	 r2
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
cfname	TokenNameIdentifier	 cfname
=	TokenNameEQUAL	
cfname	TokenNameIdentifier	 cfname
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
r1	TokenNameIdentifier	 r1
=	TokenNameEQUAL	
r1	TokenNameIdentifier	 r1
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
r2	TokenNameIdentifier	 r2
=	TokenNameEQUAL	
r2	TokenNameIdentifier	 r2
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Compares our trees, and triggers repairs for any ranges that mismatch. */	TokenNameCOMMENT_JAVADOC	 Compares our trees, and triggers repairs for any ranges that mismatch. 
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// restore partitioners (in case we were serialized) 	TokenNameCOMMENT_LINE	restore partitioners (in case we were serialized) 
if	TokenNameif	
(	TokenNameLPAREN	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
partitioner	TokenNameIdentifier	 partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
partitioner	TokenNameIdentifier	 partitioner
(	TokenNameLPAREN	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
getPartitioner	TokenNameIdentifier	 get Partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
partitioner	TokenNameIdentifier	 partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
.	TokenNameDOT	
partitioner	TokenNameIdentifier	 partitioner
(	TokenNameLPAREN	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
getPartitioner	TokenNameIdentifier	 get Partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// compare trees, and collect differences 	TokenNameCOMMENT_LINE	compare trees, and collect differences 
differences	TokenNameIdentifier	 differences
.	TokenNameDOT	
addAll	TokenNameIdentifier	 add All
(	TokenNameLPAREN	
MerkleTree	TokenNameIdentifier	 Merkle Tree
.	TokenNameDOT	
difference	TokenNameIdentifier	 difference
(	TokenNameLPAREN	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
,	TokenNameCOMMA	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// choose a repair method based on the significance of the difference 	TokenNameCOMMENT_LINE	choose a repair method based on the significance of the difference 
String	TokenNameIdentifier	 String
format	TokenNameIdentifier	 format
=	TokenNameEQUAL	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"[repair #%s] Endpoints %s and %s %%s for %s"	TokenNameStringLiteral	[repair #%s] Endpoints %s and %s %%s for %s
,	TokenNameCOMMA	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
cfname	TokenNameIdentifier	 cfname
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
differences	TokenNameIdentifier	 differences
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
format	TokenNameIdentifier	 format
,	TokenNameCOMMA	
"are consistent"	TokenNameStringLiteral	are consistent
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// non-0 difference: perform streaming repair 	TokenNameCOMMENT_LINE	non-0 difference: perform streaming repair 
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
format	TokenNameIdentifier	 format
,	TokenNameCOMMA	
"have "	TokenNameStringLiteral	have 
+	TokenNamePLUS	
differences	TokenNameIdentifier	 differences
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
" range(s) out of sync"	TokenNameStringLiteral	 range(s) out of sync
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
performStreamingRepair	TokenNameIdentifier	 perform Streaming Repair
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Starts sending/receiving our list of differences to/from the remote endpoint: creates a callback * that will be called out of band once the streams complete. */	TokenNameCOMMENT_JAVADOC	 Starts sending/receiving our list of differences to/from the remote endpoint: creates a callback that will be called out of band once the streams complete. 
void	TokenNamevoid	
performStreamingRepair	TokenNameIdentifier	 perform Streaming Repair
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Runnable	TokenNameIdentifier	 Runnable
callback	TokenNameIdentifier	 callback
=	TokenNameEQUAL	
new	TokenNamenew	
Runnable	TokenNameIdentifier	 Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
Differencer	TokenNameIdentifier	 Differencer
.	TokenNameDOT	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
StreamingRepairTask	TokenNameIdentifier	 Streaming Repair Task
task	TokenNameIdentifier	 task
=	TokenNameEQUAL	
StreamingRepairTask	TokenNameIdentifier	 Streaming Repair Task
.	TokenNameDOT	
create	TokenNameIdentifier	 create
(	TokenNameLPAREN	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
tablename	TokenNameIdentifier	 tablename
,	TokenNameCOMMA	
cfname	TokenNameIdentifier	 cfname
,	TokenNameCOMMA	
differences	TokenNameIdentifier	 differences
,	TokenNameCOMMA	
callback	TokenNameIdentifier	 callback
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Pre 1.0, nodes don't know how to handle forwarded streaming task so don't bother 	TokenNameCOMMENT_LINE	Pre 1.0, nodes don't know how to handle forwarded streaming task so don't bother 
if	TokenNameif	
(	TokenNameLPAREN	
task	TokenNameIdentifier	 task
.	TokenNameDOT	
isLocalTask	TokenNameIdentifier	 is Local Task
(	TokenNameLPAREN	
)	TokenNameRPAREN	
||	TokenNameOR_OR	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getVersion	TokenNameIdentifier	 get Version
(	TokenNameLPAREN	
task	TokenNameIdentifier	 task
.	TokenNameDOT	
dst	TokenNameIdentifier	 dst
)	TokenNameRPAREN	
>=	TokenNameGREATER_EQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
VERSION_10	TokenNameIdentifier	 VERSION 10
)	TokenNameRPAREN	
task	TokenNameIdentifier	 task
.	TokenNameDOT	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
String	TokenNameIdentifier	 String
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
"#<Differencer "	TokenNameStringLiteral	#<Differencer 
+	TokenNamePLUS	
r1	TokenNameIdentifier	 r1
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
+	TokenNamePLUS	
"<->"	TokenNameStringLiteral	<->
+	TokenNamePLUS	
r2	TokenNameIdentifier	 r2
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
+	TokenNamePLUS	
"/"	TokenNameStringLiteral	/
+	TokenNamePLUS	
range	TokenNameIdentifier	 range
+	TokenNamePLUS	
">"	TokenNameStringLiteral	>
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
static	TokenNamestatic	
class	TokenNameclass	
TreeResponse	TokenNameIdentifier	 Tree Response
{	TokenNameLBRACE	
public	TokenNamepublic	
final	TokenNamefinal	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
;	TokenNameSEMICOLON	
TreeResponse	TokenNameIdentifier	 Tree Response
(	TokenNameLPAREN	
InetAddress	TokenNameIdentifier	 Inet Address
endpoint	TokenNameIdentifier	 endpoint
,	TokenNameCOMMA	
MerkleTree	TokenNameIdentifier	 Merkle Tree
tree	TokenNameIdentifier	 tree
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
endpoint	TokenNameIdentifier	 endpoint
=	TokenNameEQUAL	
endpoint	TokenNameIdentifier	 endpoint
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
tree	TokenNameIdentifier	 tree
=	TokenNameEQUAL	
tree	TokenNameIdentifier	 tree
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
RepairFuture	TokenNameIdentifier	 Repair Future
extends	TokenNameextends	
FutureTask	TokenNameIdentifier	 Future Task
{	TokenNameLBRACE	
public	TokenNamepublic	
final	TokenNamefinal	
RepairSession	TokenNameIdentifier	 Repair Session
session	TokenNameIdentifier	 session
;	TokenNameSEMICOLON	
RepairFuture	TokenNameIdentifier	 Repair Future
(	TokenNameLPAREN	
RepairSession	TokenNameIdentifier	 Repair Session
session	TokenNameIdentifier	 session
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
,	TokenNameCOMMA	
null	TokenNamenull	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
session	TokenNameIdentifier	 session
=	TokenNameEQUAL	
session	TokenNameIdentifier	 session
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
abstract	TokenNameabstract	
class	TokenNameclass	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
Order	TokenNameIdentifier	 Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
orderer	TokenNameIdentifier	 orderer
;	TokenNameSEMICOLON	
protected	TokenNameprotected	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
(	TokenNameLPAREN	
boolean	TokenNameboolean	
isSequential	TokenNameIdentifier	 is Sequential
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
orderer	TokenNameIdentifier	 orderer
=	TokenNameEQUAL	
isSequential	TokenNameIdentifier	 is Sequential
?	TokenNameQUESTION	
new	TokenNamenew	
SequentialOrder	TokenNameIdentifier	 Sequential Order
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
:	TokenNameCOLON	
new	TokenNamenew	
ParallelOrder	TokenNameIdentifier	 Parallel Order
(	TokenNameLPAREN	
this	TokenNamethis	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
abstract	TokenNameabstract	
void	TokenNamevoid	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
void	TokenNamevoid	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
orderer	TokenNameIdentifier	 orderer
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
orderer	TokenNameIdentifier	 orderer
.	TokenNameDOT	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// Returns how many request remains 	TokenNameCOMMENT_LINE	Returns how many request remains 
public	TokenNamepublic	
int	TokenNameint	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
orderer	TokenNameIdentifier	 orderer
.	TokenNameDOT	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
abstract	TokenNameabstract	
class	TokenNameclass	
Order	TokenNameIdentifier	 Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
{	TokenNameLBRACE	
protected	TokenNameprotected	
final	TokenNamefinal	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
coordinator	TokenNameIdentifier	 coordinator
;	TokenNameSEMICOLON	
Order	TokenNameIdentifier	 Order
(	TokenNameLPAREN	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
coordinator	TokenNameIdentifier	 coordinator
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
coordinator	TokenNameIdentifier	 coordinator
=	TokenNameEQUAL	
coordinator	TokenNameIdentifier	 coordinator
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
abstract	TokenNameabstract	
void	TokenNamevoid	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
abstract	TokenNameabstract	
void	TokenNamevoid	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
abstract	TokenNameabstract	
int	TokenNameint	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
class	TokenNameclass	
SequentialOrder	TokenNameIdentifier	 Sequential Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
extends	TokenNameextends	
Order	TokenNameIdentifier	 Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
Queue	TokenNameIdentifier	 Queue
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
requests	TokenNameIdentifier	 requests
=	TokenNameEQUAL	
new	TokenNamenew	
LinkedList	TokenNameIdentifier	 Linked List
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
SequentialOrder	TokenNameIdentifier	 Sequential Order
(	TokenNameLPAREN	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
coordinator	TokenNameIdentifier	 coordinator
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
coordinator	TokenNameIdentifier	 coordinator
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
coordinator	TokenNameIdentifier	 coordinator
.	TokenNameDOT	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
int	TokenNameint	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
request	TokenNameIdentifier	 request
.	TokenNameDOT	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
poll	TokenNameIdentifier	 poll
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
int	TokenNameint	
remaining	TokenNameIdentifier	 remaining
=	TokenNameEQUAL	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
remaining	TokenNameIdentifier	 remaining
!=	TokenNameNOT_EQUAL	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
coordinator	TokenNameIdentifier	 coordinator
.	TokenNameDOT	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
remaining	TokenNameIdentifier	 remaining
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
class	TokenNameclass	
ParallelOrder	TokenNameIdentifier	 Parallel Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
extends	TokenNameextends	
Order	TokenNameIdentifier	 Order
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
requests	TokenNameIdentifier	 requests
=	TokenNameEQUAL	
new	TokenNamenew	
HashSet	TokenNameIdentifier	 Hash Set
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ParallelOrder	TokenNameIdentifier	 Parallel Order
(	TokenNameLPAREN	
RequestCoordinator	TokenNameIdentifier	 Request Coordinator
<	TokenNameLESS	
R	TokenNameIdentifier	 R
>	TokenNameGREATER	
coordinator	TokenNameIdentifier	 coordinator
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
coordinator	TokenNameIdentifier	 coordinator
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
:	TokenNameCOLON	
requests	TokenNameIdentifier	 requests
)	TokenNameRPAREN	
coordinator	TokenNameIdentifier	 coordinator
.	TokenNameDOT	
send	TokenNameIdentifier	 send
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
int	TokenNameint	
completed	TokenNameIdentifier	 completed
(	TokenNameLPAREN	
R	TokenNameIdentifier	 R
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
{	TokenNameLBRACE	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
request	TokenNameIdentifier	 request
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
requests	TokenNameIdentifier	 requests
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
