package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
pruning	TokenNameIdentifier	 pruning
;	TokenNameSEMICOLON	
/* * Licensed to the Apache Software Foundation (ASF) under one or more * contributor license agreements. See the NOTICE file distributed with * this work for additional information regarding copyright ownership. * The ASF licenses this file to You under the Apache License, Version 2.0 * (the "License"); you may not use this file except in compliance with * the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
IOException	TokenNameIdentifier	 IO Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
ArrayList	TokenNameIdentifier	 Array List
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Arrays	TokenNameIdentifier	 Arrays
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Comparator	TokenNameIdentifier	 Comparator
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Map	TokenNameIdentifier	 Map
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
IndexReader	TokenNameIdentifier	 Index Reader
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
Term	TokenNameIdentifier	 Term
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
TermEnum	TokenNameIdentifier	 Term Enum
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
TermFreqVector	TokenNameIdentifier	 Term Freq Vector
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
index	TokenNameIdentifier	 index
.	TokenNameDOT	
TermPositions	TokenNameIdentifier	 Term Positions
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
Collector	TokenNameIdentifier	 Collector
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
DefaultSimilarity	TokenNameIdentifier	 Default Similarity
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
IndexSearcher	TokenNameIdentifier	 Index Searcher
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
ScoreDoc	TokenNameIdentifier	 Score Doc
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
Scorer	TokenNameIdentifier	 Scorer
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
Similarity	TokenNameIdentifier	 Similarity
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
TermQuery	TokenNameIdentifier	 Term Query
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
lucene	TokenNameIdentifier	 lucene
.	TokenNameDOT	
search	TokenNameIdentifier	 search
.	TokenNameDOT	
TopScoreDocCollector	TokenNameIdentifier	 Top Score Doc Collector
;	TokenNameSEMICOLON	
/** * Pruning policy with a search quality parameterized guarantee - configuration * of this policy allows to specify two parameters: <b>k</b> and * <b>&epsilon;</b> such that: * <p> * <table border="1"> * <tr> * <td> * For any <b>OR</b> query with <b>r</b> terms, the score of each of the top * <b>k</b> results in the original index, should be "practically the same" as * the score that document in the pruned index: the scores difference should not * exceed <b>r * &epsilon;</b>.</td> * </tr> * </table> * <p> * See the following paper for more details about this method: <a * href="http://portal.acm.org/citation.cfm?id=383958">Static index pruning for * information retrieval systems, D. Carmel at al, ACM SIGIR 2001 </a>. * <p> * The claim of this pruning technique is, quoting from the above paper: * <p> * <table border="1"> * <tr> * <td> * Prune the index in such a way that a human * "cannot distinguish the difference" between the results of a search engine * whose index is pruned and one whose index is not pruned.</td> * </tr> * </table> * <p> * For indexes with a large number of terms this policy might be too slow. In * such situations, the uniform pruning approach in * {@link CarmelUniformTermPruningPolicy} will be faster, though it might * produce inferior search quality, as that policy does not pose a theoretical * guarantee on resulted search quality. * <p> * TODO implement also CarmelTermPruningDeltaTopPolicy */	TokenNameCOMMENT_JAVADOC	 Pruning policy with a search quality parameterized guarantee - configuration of this policy allows to specify two parameters: <b>k</b> and <b>&epsilon;</b> such that: <p> <table border="1"> <tr> <td> For any <b>OR</b> query with <b>r</b> terms, the score of each of the top <b>k</b> results in the original index, should be "practically the same" as the score that document in the pruned index: the scores difference should not exceed <b>r &epsilon;</b>.</td> </tr> </table> <p> See the following paper for more details about this method: <a href="http://portal.acm.org/citation.cfm?id=383958">Static index pruning for information retrieval systems, D. Carmel at al, ACM SIGIR 2001 </a>. <p> The claim of this pruning technique is, quoting from the above paper: <p> <table border="1"> <tr> <td> Prune the index in such a way that a human "cannot distinguish the difference" between the results of a search engine whose index is pruned and one whose index is not pruned.</td> </tr> </table> <p> For indexes with a large number of terms this policy might be too slow. In such situations, the uniform pruning approach in {@link CarmelUniformTermPruningPolicy} will be faster, though it might produce inferior search quality, as that policy does not pose a theoretical guarantee on resulted search quality. <p> TODO implement also CarmelTermPruningDeltaTopPolicy 
public	TokenNamepublic	
class	TokenNameclass	
CarmelTopKTermPruningPolicy	TokenNameIdentifier	 Carmel Top K Term Pruning Policy
extends	TokenNameextends	
TermPruningPolicy	TokenNameIdentifier	 Term Pruning Policy
{	TokenNameLBRACE	
/** * Default number of guaranteed top K scores */	TokenNameCOMMENT_JAVADOC	 Default number of guaranteed top K scores 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
DEFAULT_TOP_K	TokenNameIdentifier	 DEFAULT  TOP  K
=	TokenNameEQUAL	
10	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
/** * Default number of query terms */	TokenNameCOMMENT_JAVADOC	 Default number of query terms 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
DEFAULT_R	TokenNameIdentifier	 DEFAULT  R
=	TokenNameEQUAL	
1	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
/** * Default largest meaningless score difference */	TokenNameCOMMENT_JAVADOC	 Default largest meaningless score difference 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
float	TokenNamefloat	
DEFAULT_EPSILON	TokenNameIdentifier	 DEFAULT  EPSILON
=	TokenNameEQUAL	
.001f	TokenNameFloatingPointLiteral	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
int	TokenNameint	
docsPos	TokenNameIdentifier	 docs Pos
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
int	TokenNameint	
k	TokenNameIdentifier	 k
;	TokenNameSEMICOLON	
private	TokenNameprivate	
ScoreDoc	TokenNameIdentifier	 Score Doc
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
docs	TokenNameIdentifier	 docs
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
IndexSearcher	TokenNameIdentifier	 Index Searcher
is	TokenNameIdentifier	 is
;	TokenNameSEMICOLON	
private	TokenNameprivate	
boolean	TokenNameboolean	
noPruningForCurrentTerm	TokenNameIdentifier	 no Pruning For Current Term
;	TokenNameSEMICOLON	
private	TokenNameprivate	
float	TokenNamefloat	
scoreDelta	TokenNameIdentifier	 score Delta
;	TokenNameSEMICOLON	
/** * Constructor with default parameters * * @see #DEFAULT_TOP_K * @see #DEFAULT_EPSILON * @see #DEFAULT_R * @see DefaultSimilarity * @see #CarmelTopKTermPruningPolicy(IndexReader, Map, int, float, int, Similarity) */	TokenNameCOMMENT_JAVADOC	 Constructor with default parameters * @see #DEFAULT_TOP_K @see #DEFAULT_EPSILON @see #DEFAULT_R @see DefaultSimilarity @see #CarmelTopKTermPruningPolicy(IndexReader, Map, int, float, int, Similarity) 
public	TokenNamepublic	
CarmelTopKTermPruningPolicy	TokenNameIdentifier	 Carmel Top K Term Pruning Policy
(	TokenNameLPAREN	
IndexReader	TokenNameIdentifier	 Index Reader
in	TokenNameIdentifier	 in
,	TokenNameCOMMA	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
Integer	TokenNameIdentifier	 Integer
>	TokenNameGREATER	
fieldFlags	TokenNameIdentifier	 field Flags
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
(	TokenNameLPAREN	
in	TokenNameIdentifier	 in
,	TokenNameCOMMA	
fieldFlags	TokenNameIdentifier	 field Flags
,	TokenNameCOMMA	
DEFAULT_TOP_K	TokenNameIdentifier	 DEFAULT  TOP  K
,	TokenNameCOMMA	
DEFAULT_EPSILON	TokenNameIdentifier	 DEFAULT  EPSILON
,	TokenNameCOMMA	
DEFAULT_R	TokenNameIdentifier	 DEFAULT  R
,	TokenNameCOMMA	
null	TokenNamenull	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Constructor with specific settings * * @param in reader for original index * @param k number of guaranteed top scores. Each top K results in the pruned * index is either also an original top K result or its original * score is indistinguishable from some original top K result. * @param epsilon largest meaningless score difference Results whose scores * difference is smaller or equal to epsilon are considered * indistinguishable. * @param r maximal number of terms in a query for which search quaility in * pruned index is guaranteed * @param sim similarity to use when selecting top docs fir each index term. * When null, {@link DefaultSimilarity} is used. */	TokenNameCOMMENT_JAVADOC	 Constructor with specific settings * @param in reader for original index @param k number of guaranteed top scores. Each top K results in the pruned index is either also an original top K result or its original score is indistinguishable from some original top K result. @param epsilon largest meaningless score difference Results whose scores difference is smaller or equal to epsilon are considered indistinguishable. @param r maximal number of terms in a query for which search quaility in pruned index is guaranteed @param sim similarity to use when selecting top docs fir each index term. When null, {@link DefaultSimilarity} is used. 
public	TokenNamepublic	
CarmelTopKTermPruningPolicy	TokenNameIdentifier	 Carmel Top K Term Pruning Policy
(	TokenNameLPAREN	
IndexReader	TokenNameIdentifier	 Index Reader
in	TokenNameIdentifier	 in
,	TokenNameCOMMA	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
Integer	TokenNameIdentifier	 Integer
>	TokenNameGREATER	
fieldFlags	TokenNameIdentifier	 field Flags
,	TokenNameCOMMA	
int	TokenNameint	
k	TokenNameIdentifier	 k
,	TokenNameCOMMA	
float	TokenNamefloat	
epsilon	TokenNameIdentifier	 epsilon
,	TokenNameCOMMA	
int	TokenNameint	
r	TokenNameIdentifier	 r
,	TokenNameCOMMA	
Similarity	TokenNameIdentifier	 Similarity
sim	TokenNameIdentifier	 sim
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
in	TokenNameIdentifier	 in
,	TokenNameCOMMA	
fieldFlags	TokenNameIdentifier	 field Flags
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
k	TokenNameIdentifier	 k
=	TokenNameEQUAL	
k	TokenNameIdentifier	 k
;	TokenNameSEMICOLON	
is	TokenNameIdentifier	 is
=	TokenNameEQUAL	
new	TokenNamenew	
IndexSearcher	TokenNameIdentifier	 Index Searcher
(	TokenNameLPAREN	
in	TokenNameIdentifier	 in
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
is	TokenNameIdentifier	 is
.	TokenNameDOT	
setSimilarity	TokenNameIdentifier	 set Similarity
(	TokenNameLPAREN	
sim	TokenNameIdentifier	 sim
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
?	TokenNameQUESTION	
sim	TokenNameIdentifier	 sim
:	TokenNameCOLON	
new	TokenNamenew	
DefaultSimilarity	TokenNameIdentifier	 Default Similarity
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
scoreDelta	TokenNameIdentifier	 score Delta
=	TokenNameEQUAL	
epsilon	TokenNameIdentifier	 epsilon
*	TokenNameMULTIPLY	
r	TokenNameIdentifier	 r
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// too costly - pass everything at this stage 	TokenNameCOMMENT_LINE	too costly - pass everything at this stage 
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
boolean	TokenNameboolean	
pruneTermEnum	TokenNameIdentifier	 prune Term Enum
(	TokenNameLPAREN	
TermEnum	TokenNameIdentifier	 Term Enum
te	TokenNameIdentifier	 te
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
initPositionsTerm	TokenNameIdentifier	 init Positions Term
(	TokenNameLPAREN	
TermPositions	TokenNameIdentifier	 Term Positions
tp	TokenNameIdentifier	 tp
,	TokenNameCOMMA	
Term	TokenNameIdentifier	 Term
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
// check if there's any point to prune this term 	TokenNameCOMMENT_LINE	check if there's any point to prune this term 
int	TokenNameint	
df	TokenNameIdentifier	 df
=	TokenNameEQUAL	
in	TokenNameIdentifier	 in
.	TokenNameDOT	
docFreq	TokenNameIdentifier	 doc Freq
(	TokenNameLPAREN	
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
noPruningForCurrentTerm	TokenNameIdentifier	 no Pruning For Current Term
=	TokenNameEQUAL	
(	TokenNameLPAREN	
df	TokenNameIdentifier	 df
<=	TokenNameLESS_EQUAL	
k	TokenNameIdentifier	 k
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
noPruningForCurrentTerm	TokenNameIdentifier	 no Pruning For Current Term
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// take more results (k2>k), attempting for sufficient results to avoid a 	TokenNameCOMMENT_LINE	take more results (k2>k), attempting for sufficient results to avoid a 
// second search 	TokenNameCOMMENT_LINE	second search 
int	TokenNameint	
k2	TokenNameIdentifier	 k2
=	TokenNameEQUAL	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
min	TokenNameIdentifier	 min
(	TokenNameLPAREN	
2	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
k	TokenNameIdentifier	 k
,	TokenNameCOMMA	
k	TokenNameIdentifier	 k
+	TokenNamePLUS	
100	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// for small k's 2*k will do, but for 	TokenNameCOMMENT_LINE	for small k's 2*k will do, but for 
// large ones (1000's) keep overhead 	TokenNameCOMMENT_LINE	large ones (1000's) keep overhead 
// smaller 	TokenNameCOMMENT_LINE	smaller 
k2	TokenNameIdentifier	 k2
=	TokenNameEQUAL	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
min	TokenNameIdentifier	 min
(	TokenNameLPAREN	
k2	TokenNameIdentifier	 k2
,	TokenNameCOMMA	
df	TokenNameIdentifier	 df
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// no more than the potential number of results 	TokenNameCOMMENT_LINE	no more than the potential number of results 
TopScoreDocCollector	TokenNameIdentifier	 Top Score Doc Collector
collector	TokenNameIdentifier	 collector
=	TokenNameEQUAL	
TopScoreDocCollector	TokenNameIdentifier	 Top Score Doc Collector
.	TokenNameDOT	
create	TokenNameIdentifier	 create
(	TokenNameLPAREN	
k2	TokenNameIdentifier	 k2
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
TermQuery	TokenNameIdentifier	 Term Query
tq	TokenNameIdentifier	 tq
=	TokenNameEQUAL	
new	TokenNamenew	
TermQuery	TokenNameIdentifier	 Term Query
(	TokenNameLPAREN	
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
is	TokenNameIdentifier	 is
.	TokenNameDOT	
search	TokenNameIdentifier	 search
(	TokenNameLPAREN	
tq	TokenNameIdentifier	 tq
,	TokenNameCOMMA	
collector	TokenNameIdentifier	 collector
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
docs	TokenNameIdentifier	 docs
=	TokenNameEQUAL	
collector	TokenNameIdentifier	 collector
.	TokenNameDOT	
topDocs	TokenNameIdentifier	 top Docs
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
scoreDocs	TokenNameIdentifier	 score Docs
;	TokenNameSEMICOLON	
float	TokenNamefloat	
threshold	TokenNameIdentifier	 threshold
=	TokenNameEQUAL	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
k	TokenNameIdentifier	 k
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
.	TokenNameDOT	
score	TokenNameIdentifier	 score
-	TokenNameMINUS	
scoreDelta	TokenNameIdentifier	 score Delta
;	TokenNameSEMICOLON	
int	TokenNameint	
nLast	TokenNameIdentifier	 n Last
=	TokenNameEQUAL	
k2	TokenNameIdentifier	 k2
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
nLast	TokenNameIdentifier	 n Last
=	TokenNameEQUAL	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
min	TokenNameIdentifier	 min
(	TokenNameLPAREN	
nLast	TokenNameIdentifier	 n Last
,	TokenNameCOMMA	
docs	TokenNameIdentifier	 docs
.	TokenNameDOT	
length	TokenNameIdentifier	 length
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// protect in case of deleted docs 	TokenNameCOMMENT_LINE	protect in case of deleted docs 
if	TokenNameif	
(	TokenNameLPAREN	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
nLast	TokenNameIdentifier	 n Last
]	TokenNameRBRACKET	
.	TokenNameDOT	
score	TokenNameIdentifier	 score
<	TokenNameLESS	
threshold	TokenNameIdentifier	 threshold
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// this is the better/faster case - no need to go over docs again - we 	TokenNameCOMMENT_LINE	this is the better/faster case - no need to go over docs again - we 
// have top ones 	TokenNameCOMMENT_LINE	have top ones 
int	TokenNameint	
n	TokenNameIdentifier	 n
=	TokenNameEQUAL	
nLast	TokenNameIdentifier	 n Last
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
n	TokenNameIdentifier	 n
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
.	TokenNameDOT	
score	TokenNameIdentifier	 score
<	TokenNameLESS	
threshold	TokenNameIdentifier	 threshold
)	TokenNameRPAREN	
--	TokenNameMINUS_MINUS	
n	TokenNameIdentifier	 n
;	TokenNameSEMICOLON	
// n == num-valid-docs == first-invalid-doc 	TokenNameCOMMENT_LINE	n == num-valid-docs == first-invalid-doc 
ScoreDoc	TokenNameIdentifier	 Score Doc
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
subset	TokenNameIdentifier	 subset
=	TokenNameEQUAL	
new	TokenNamenew	
ScoreDoc	TokenNameIdentifier	 Score Doc
[	TokenNameLBRACKET	
n	TokenNameIdentifier	 n
]	TokenNameRBRACKET	
;	TokenNameSEMICOLON	
System	TokenNameIdentifier	 System
.	TokenNameDOT	
arraycopy	TokenNameIdentifier	 arraycopy
(	TokenNameLPAREN	
docs	TokenNameIdentifier	 docs
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
subset	TokenNameIdentifier	 subset
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
n	TokenNameIdentifier	 n
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
docs	TokenNameIdentifier	 docs
=	TokenNameEQUAL	
subset	TokenNameIdentifier	 subset
;	TokenNameSEMICOLON	
// sort by doc but only after taking top scores 	TokenNameCOMMENT_LINE	sort by doc but only after taking top scores 
Arrays	TokenNameIdentifier	 Arrays
.	TokenNameDOT	
sort	TokenNameIdentifier	 sort
(	TokenNameLPAREN	
docs	TokenNameIdentifier	 docs
,	TokenNameCOMMA	
ByDocComparator	TokenNameIdentifier	 By Doc Comparator
.	TokenNameDOT	
INSTANCE	TokenNameIdentifier	 INSTANCE
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
// this is the worse case - must go over docs again 	TokenNameCOMMENT_LINE	this is the worse case - must go over docs again 
ThresholdCollector	TokenNameIdentifier	 Threshold Collector
thresholdCollector	TokenNameIdentifier	 threshold Collector
=	TokenNameEQUAL	
new	TokenNamenew	
ThresholdCollector	TokenNameIdentifier	 Threshold Collector
(	TokenNameLPAREN	
threshold	TokenNameIdentifier	 threshold
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
is	TokenNameIdentifier	 is
.	TokenNameDOT	
search	TokenNameIdentifier	 search
(	TokenNameLPAREN	
tq	TokenNameIdentifier	 tq
,	TokenNameCOMMA	
thresholdCollector	TokenNameIdentifier	 threshold Collector
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
docs	TokenNameIdentifier	 docs
=	TokenNameEQUAL	
thresholdCollector	TokenNameIdentifier	 threshold Collector
.	TokenNameDOT	
scoreDocs	TokenNameIdentifier	 score Docs
.	TokenNameDOT	
toArray	TokenNameIdentifier	 to Array
(	TokenNameLPAREN	
new	TokenNamenew	
ScoreDoc	TokenNameIdentifier	 Score Doc
[	TokenNameLBRACKET	
0	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
docsPos	TokenNameIdentifier	 docs Pos
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
boolean	TokenNameboolean	
pruneAllPositions	TokenNameIdentifier	 prune All Positions
(	TokenNameLPAREN	
TermPositions	TokenNameIdentifier	 Term Positions
termPositions	TokenNameIdentifier	 term Positions
,	TokenNameCOMMA	
Term	TokenNameIdentifier	 Term
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
noPruningForCurrentTerm	TokenNameIdentifier	 no Pruning For Current Term
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
docsPos	TokenNameIdentifier	 docs Pos
>=	TokenNameGREATER_EQUAL	
docs	TokenNameIdentifier	 docs
.	TokenNameDOT	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// used up all doc id-s 	TokenNameCOMMENT_LINE	used up all doc id-s 
return	TokenNamereturn	
true	TokenNametrue	
;	TokenNameSEMICOLON	
// skip any remaining docs 	TokenNameCOMMENT_LINE	skip any remaining docs 
}	TokenNameRBRACE	
while	TokenNamewhile	
(	TokenNameLPAREN	
(	TokenNameLPAREN	
docsPos	TokenNameIdentifier	 docs Pos
<	TokenNameLESS	
docs	TokenNameIdentifier	 docs
.	TokenNameDOT	
length	TokenNameIdentifier	 length
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
termPositions	TokenNameIdentifier	 term Positions
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
(	TokenNameLPAREN	
)	TokenNameRPAREN	
>	TokenNameGREATER	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
docsPos	TokenNameIdentifier	 docs Pos
]	TokenNameRBRACKET	
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
)	TokenNameRPAREN	
{	TokenNameLBRACE	
docsPos	TokenNameIdentifier	 docs Pos
++	TokenNamePLUS_PLUS	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
termPositions	TokenNameIdentifier	 term Positions
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
docsPos	TokenNameIdentifier	 docs Pos
]	TokenNameRBRACKET	
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// pass 	TokenNameCOMMENT_LINE	pass 
docsPos	TokenNameIdentifier	 docs Pos
++	TokenNamePLUS_PLUS	
;	TokenNameSEMICOLON	
// move to next doc id 	TokenNameCOMMENT_LINE	move to next doc id 
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
termPositions	TokenNameIdentifier	 term Positions
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
(	TokenNameLPAREN	
)	TokenNameRPAREN	
<	TokenNameLESS	
docs	TokenNameIdentifier	 docs
[	TokenNameLBRACKET	
docsPos	TokenNameIdentifier	 docs Pos
]	TokenNameRBRACKET	
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
true	TokenNametrue	
;	TokenNameSEMICOLON	
// skip this one - it's less important 	TokenNameCOMMENT_LINE	skip this one - it's less important 
}	TokenNameRBRACE	
// should not happen! 	TokenNameCOMMENT_LINE	should not happen! 
throw	TokenNamethrow	
new	TokenNamenew	
IOException	TokenNameIdentifier	 IO Exception
(	TokenNameLPAREN	
"termPositions.doc > docs[docsPos].doc"	TokenNameStringLiteral	termPositions.doc > docs[docsPos].doc
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// it probably doesn't make sense to prune term vectors using this method, 	TokenNameCOMMENT_LINE	it probably doesn't make sense to prune term vectors using this method, 
// due to its overhead 	TokenNameCOMMENT_LINE	due to its overhead 
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
int	TokenNameint	
pruneTermVectorTerms	TokenNameIdentifier	 prune Term Vector Terms
(	TokenNameLPAREN	
int	TokenNameint	
docNumber	TokenNameIdentifier	 doc Number
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
field	TokenNameIdentifier	 field
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
terms	TokenNameIdentifier	 terms
,	TokenNameCOMMA	
int	TokenNameint	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
freqs	TokenNameIdentifier	 freqs
,	TokenNameCOMMA	
TermFreqVector	TokenNameIdentifier	 Term Freq Vector
tfv	TokenNameIdentifier	 tfv
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
return	TokenNamereturn	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
ByDocComparator	TokenNameIdentifier	 By Doc Comparator
implements	TokenNameimplements	
Comparator	TokenNameIdentifier	 Comparator
<	TokenNameLESS	
ScoreDoc	TokenNameIdentifier	 Score Doc
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
ByDocComparator	TokenNameIdentifier	 By Doc Comparator
INSTANCE	TokenNameIdentifier	 INSTANCE
=	TokenNameEQUAL	
new	TokenNamenew	
ByDocComparator	TokenNameIdentifier	 By Doc Comparator
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
int	TokenNameint	
compare	TokenNameIdentifier	 compare
(	TokenNameLPAREN	
ScoreDoc	TokenNameIdentifier	 Score Doc
o1	TokenNameIdentifier	 o1
,	TokenNameCOMMA	
ScoreDoc	TokenNameIdentifier	 Score Doc
o2	TokenNameIdentifier	 o2
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
o1	TokenNameIdentifier	 o1
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
-	TokenNameMINUS	
o2	TokenNameIdentifier	 o2
.	TokenNameDOT	
doc	TokenNameIdentifier	 doc
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
int	TokenNameint	
pruneSomePositions	TokenNameIdentifier	 prune Some Positions
(	TokenNameLPAREN	
int	TokenNameint	
docNum	TokenNameIdentifier	 doc Num
,	TokenNameCOMMA	
int	TokenNameint	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
positions	TokenNameIdentifier	 positions
,	TokenNameCOMMA	
Term	TokenNameIdentifier	 Term
curTerm	TokenNameIdentifier	 cur Term
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// this policy either prunes all or none, so nothing to prune here 	TokenNameCOMMENT_LINE	this policy either prunes all or none, so nothing to prune here 
}	TokenNameRBRACE	
/** * Collect all docs with score >= higher threshold */	TokenNameCOMMENT_JAVADOC	 Collect all docs with score >= higher threshold 
private	TokenNameprivate	
static	TokenNamestatic	
class	TokenNameclass	
ThresholdCollector	TokenNameIdentifier	 Threshold Collector
extends	TokenNameextends	
Collector	TokenNameIdentifier	 Collector
{	TokenNameLBRACE	
private	TokenNameprivate	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
ScoreDoc	TokenNameIdentifier	 Score Doc
>	TokenNameGREATER	
scoreDocs	TokenNameIdentifier	 score Docs
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
ScoreDoc	TokenNameIdentifier	 Score Doc
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
Scorer	TokenNameIdentifier	 Scorer
scorer	TokenNameIdentifier	 scorer
;	TokenNameSEMICOLON	
private	TokenNameprivate	
float	TokenNamefloat	
threshold	TokenNameIdentifier	 threshold
;	TokenNameSEMICOLON	
private	TokenNameprivate	
int	TokenNameint	
docBase	TokenNameIdentifier	 doc Base
;	TokenNameSEMICOLON	
public	TokenNamepublic	
ThresholdCollector	TokenNameIdentifier	 Threshold Collector
(	TokenNameLPAREN	
float	TokenNamefloat	
threshold	TokenNameIdentifier	 threshold
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
threshold	TokenNameIdentifier	 threshold
=	TokenNameEQUAL	
threshold	TokenNameIdentifier	 threshold
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
boolean	TokenNameboolean	
acceptsDocsOutOfOrder	TokenNameIdentifier	 accepts Docs Out Of Order
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
collect	TokenNameIdentifier	 collect
(	TokenNameLPAREN	
int	TokenNameint	
doc	TokenNameIdentifier	 doc
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
float	TokenNamefloat	
score	TokenNameIdentifier	 score
=	TokenNameEQUAL	
scorer	TokenNameIdentifier	 scorer
.	TokenNameDOT	
score	TokenNameIdentifier	 score
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
score	TokenNameIdentifier	 score
>=	TokenNameGREATER_EQUAL	
threshold	TokenNameIdentifier	 threshold
)	TokenNameRPAREN	
{	TokenNameLBRACE	
scoreDocs	TokenNameIdentifier	 score Docs
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
ScoreDoc	TokenNameIdentifier	 Score Doc
(	TokenNameLPAREN	
docBase	TokenNameIdentifier	 doc Base
+	TokenNamePLUS	
doc	TokenNameIdentifier	 doc
,	TokenNameCOMMA	
score	TokenNameIdentifier	 score
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
setNextReader	TokenNameIdentifier	 set Next Reader
(	TokenNameLPAREN	
IndexReader	TokenNameIdentifier	 Index Reader
reader	TokenNameIdentifier	 reader
,	TokenNameCOMMA	
int	TokenNameint	
docBase	TokenNameIdentifier	 doc Base
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
docBase	TokenNameIdentifier	 doc Base
=	TokenNameEQUAL	
docBase	TokenNameIdentifier	 doc Base
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
setScorer	TokenNameIdentifier	 set Scorer
(	TokenNameLPAREN	
Scorer	TokenNameIdentifier	 Scorer
scorer	TokenNameIdentifier	 scorer
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
scorer	TokenNameIdentifier	 scorer
=	TokenNameEQUAL	
scorer	TokenNameIdentifier	 scorer
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
