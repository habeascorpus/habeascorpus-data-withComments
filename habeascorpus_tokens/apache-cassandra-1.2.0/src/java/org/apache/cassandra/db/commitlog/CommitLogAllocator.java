/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
commitlog	TokenNameIdentifier	 commitlog
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
File	TokenNameIdentifier	 File
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Collection	TokenNameIdentifier	 Collection
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Collections	TokenNameIdentifier	 Collections
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
UUID	TokenNameIdentifier	 UUID
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
BlockingQueue	TokenNameIdentifier	 Blocking Queue
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
LinkedBlockingQueue	TokenNameIdentifier	 Linked Blocking Queue
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
TimeUnit	TokenNameIdentifier	 Time Unit
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
ConcurrentLinkedQueue	TokenNameIdentifier	 Concurrent Linked Queue
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
atomic	TokenNameIdentifier	 atomic
.	TokenNameDOT	
AtomicLong	TokenNameIdentifier	 Atomic Long
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
collect	TokenNameIdentifier	 collect
.	TokenNameDOT	
Iterables	TokenNameIdentifier	 Iterables
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
Schema	TokenNameIdentifier	 Schema
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
Table	TokenNameIdentifier	 Table
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
FileUtils	TokenNameIdentifier	 File Utils
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
MessagingService	TokenNameIdentifier	 Messaging Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
service	TokenNameIdentifier	 service
.	TokenNameDOT	
StorageService	TokenNameIdentifier	 Storage Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
WrappedRunnable	TokenNameIdentifier	 Wrapped Runnable
;	TokenNameSEMICOLON	
/** * Performs the pre-allocation of commit log segments in a background thread. All the * public methods are thread safe. */	TokenNameCOMMENT_JAVADOC	 Performs the pre-allocation of commit log segments in a background thread. All the public methods are thread safe. 
public	TokenNamepublic	
class	TokenNameclass	
CommitLogAllocator	TokenNameIdentifier	 Commit Log Allocator
{	TokenNameLBRACE	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
CommitLogAllocator	TokenNameIdentifier	 Commit Log Allocator
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** The (theoretical) max milliseconds between loop runs to perform janitorial tasks */	TokenNameCOMMENT_JAVADOC	 The (theoretical) max milliseconds between loop runs to perform janitorial tasks 
public	TokenNamepublic	
final	TokenNamefinal	
static	TokenNamestatic	
int	TokenNameint	
TICK_CYCLE_TIME	TokenNameIdentifier	 TICK  CYCLE  TIME
=	TokenNameEQUAL	
100	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
/** Segments that are ready to be used */	TokenNameCOMMENT_JAVADOC	 Segments that are ready to be used 
private	TokenNameprivate	
final	TokenNamefinal	
BlockingQueue	TokenNameIdentifier	 Blocking Queue
<	TokenNameLESS	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
>	TokenNameGREATER	
availableSegments	TokenNameIdentifier	 available Segments
=	TokenNameEQUAL	
new	TokenNamenew	
LinkedBlockingQueue	TokenNameIdentifier	 Linked Blocking Queue
<	TokenNameLESS	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** Allocations to be run by the thread */	TokenNameCOMMENT_JAVADOC	 Allocations to be run by the thread 
private	TokenNameprivate	
final	TokenNamefinal	
BlockingQueue	TokenNameIdentifier	 Blocking Queue
<	TokenNameLESS	
Runnable	TokenNameIdentifier	 Runnable
>	TokenNameGREATER	
queue	TokenNameIdentifier	 queue
=	TokenNameEQUAL	
new	TokenNamenew	
LinkedBlockingQueue	TokenNameIdentifier	 Linked Blocking Queue
<	TokenNameLESS	
Runnable	TokenNameIdentifier	 Runnable
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** Active segments, containing unflushed data */	TokenNameCOMMENT_JAVADOC	 Active segments, containing unflushed data 
private	TokenNameprivate	
final	TokenNamefinal	
ConcurrentLinkedQueue	TokenNameIdentifier	 Concurrent Linked Queue
<	TokenNameLESS	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
>	TokenNameGREATER	
activeSegments	TokenNameIdentifier	 active Segments
=	TokenNameEQUAL	
new	TokenNamenew	
ConcurrentLinkedQueue	TokenNameIdentifier	 Concurrent Linked Queue
<	TokenNameLESS	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** * Tracks commitlog size, in multiples of the segment size. We need to do this so we can "promise" size * adjustments ahead of actually adding/freeing segments on disk, so that the "evict oldest segment" logic * can see the effect of recycling segments immediately (even though they're really happening asynchronously * on the allocator thread, which will take a ms or two). */	TokenNameCOMMENT_JAVADOC	 Tracks commitlog size, in multiples of the segment size. We need to do this so we can "promise" size adjustments ahead of actually adding/freeing segments on disk, so that the "evict oldest segment" logic can see the effect of recycling segments immediately (even though they're really happening asynchronously on the allocator thread, which will take a ms or two). 
private	TokenNameprivate	
final	TokenNamefinal	
AtomicLong	TokenNameIdentifier	 Atomic Long
size	TokenNameIdentifier	 size
=	TokenNameEQUAL	
new	TokenNamenew	
AtomicLong	TokenNameIdentifier	 Atomic Long
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** * New segment creation is initially disabled because we'll typically get some "free" segments * recycled after log replay. */	TokenNameCOMMENT_JAVADOC	 New segment creation is initially disabled because we'll typically get some "free" segments recycled after log replay. 
private	TokenNameprivate	
volatile	TokenNamevolatile	
boolean	TokenNameboolean	
createReserveSegments	TokenNameIdentifier	 create Reserve Segments
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Thread	TokenNameIdentifier	 Thread
allocationThread	TokenNameIdentifier	 allocation Thread
;	TokenNameSEMICOLON	
private	TokenNameprivate	
volatile	TokenNamevolatile	
boolean	TokenNameboolean	
run	TokenNameIdentifier	 run
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
CommitLogAllocator	TokenNameIdentifier	 Commit Log Allocator
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// The run loop for the allocation thread 	TokenNameCOMMENT_LINE	The run loop for the allocation thread 
Runnable	TokenNameIdentifier	 Runnable
runnable	TokenNameIdentifier	 runnable
=	TokenNameEQUAL	
new	TokenNamenew	
WrappedRunnable	TokenNameIdentifier	 Wrapped Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
runMayThrow	TokenNameIdentifier	 run May Throw
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
Exception	TokenNameIdentifier	 Exception
{	TokenNameLBRACE	
while	TokenNamewhile	
(	TokenNameLPAREN	
run	TokenNameIdentifier	 run
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Runnable	TokenNameIdentifier	 Runnable
r	TokenNameIdentifier	 r
=	TokenNameEQUAL	
queue	TokenNameIdentifier	 queue
.	TokenNameDOT	
poll	TokenNameIdentifier	 poll
(	TokenNameLPAREN	
TICK_CYCLE_TIME	TokenNameIdentifier	 TICK  CYCLE  TIME
,	TokenNameCOMMA	
TimeUnit	TokenNameIdentifier	 Time Unit
.	TokenNameDOT	
MILLISECONDS	TokenNameIdentifier	 MILLISECONDS
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
r	TokenNameIdentifier	 r
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
r	TokenNameIdentifier	 r
.	TokenNameDOT	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
// no job, so we're clear to check to see if we're out of segments 	TokenNameCOMMENT_LINE	no job, so we're clear to check to see if we're out of segments 
// and ready a new one if needed. has the effect of ensuring there's 	TokenNameCOMMENT_LINE	and ready a new one if needed. has the effect of ensuring there's 
// almost always a segment available when it's needed. 	TokenNameCOMMENT_LINE	almost always a segment available when it's needed. 
if	TokenNameif	
(	TokenNameLPAREN	
availableSegments	TokenNameIdentifier	 available Segments
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
(	TokenNameLPAREN	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
||	TokenNameOR_OR	
createReserveSegments	TokenNameIdentifier	 create Reserve Segments
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"No segments in reserve; creating a fresh one"	TokenNameStringLiteral	No segments in reserve; creating a fresh one
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
createFreshSegment	TokenNameIdentifier	 create Fresh Segment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
allocationThread	TokenNameIdentifier	 allocation Thread
=	TokenNameEQUAL	
new	TokenNamenew	
Thread	TokenNameIdentifier	 Thread
(	TokenNameLPAREN	
runnable	TokenNameIdentifier	 runnable
,	TokenNameCOMMA	
"COMMIT-LOG-ALLOCATOR"	TokenNameStringLiteral	COMMIT-LOG-ALLOCATOR
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
allocationThread	TokenNameIdentifier	 allocation Thread
.	TokenNameDOT	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Fetches an empty segment file. * * @return the next writable segment */	TokenNameCOMMENT_JAVADOC	 Fetches an empty segment file. * @return the next writable segment 
public	TokenNamepublic	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
fetchSegment	TokenNameIdentifier	 fetch Segment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
next	TokenNameIdentifier	 next
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
next	TokenNameIdentifier	 next
=	TokenNameEQUAL	
availableSegments	TokenNameIdentifier	 available Segments
.	TokenNameDOT	
take	TokenNameIdentifier	 take
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
AssertionError	TokenNameIdentifier	 Assertion Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
assert	TokenNameassert	
!	TokenNameNOT	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
next	TokenNameIdentifier	 next
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
next	TokenNameIdentifier	 next
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
isCapExceeded	TokenNameIdentifier	 is Cap Exceeded
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
flushOldestTables	TokenNameIdentifier	 flush Oldest Tables
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
next	TokenNameIdentifier	 next
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Indicates that a segment is no longer in use and that it should be recycled. * * @param segment segment that is no longer in use */	TokenNameCOMMENT_JAVADOC	 Indicates that a segment is no longer in use and that it should be recycled. * @param segment segment that is no longer in use 
public	TokenNamepublic	
void	TokenNamevoid	
recycleSegment	TokenNameIdentifier	 recycle Segment
(	TokenNameLPAREN	
final	TokenNamefinal	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
{	TokenNameLBRACE	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
CommitLog	TokenNameIdentifier	 Commit Log
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
archiver	TokenNameIdentifier	 archiver
.	TokenNameDOT	
maybeWaitForArchiving	TokenNameIdentifier	 maybe Wait For Archiving
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// if archiving (command) was not successful then leave the file alone. don't delete or recycle. 	TokenNameCOMMENT_LINE	if archiving (command) was not successful then leave the file alone. don't delete or recycle. 
discardSegment	TokenNameIdentifier	 discard Segment
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
,	TokenNameCOMMA	
false	TokenNamefalse	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
isCapExceeded	TokenNameIdentifier	 is Cap Exceeded
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
discardSegment	TokenNameIdentifier	 discard Segment
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Recycling {}"	TokenNameStringLiteral	Recycling {}
,	TokenNameCOMMA	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
queue	TokenNameIdentifier	 queue
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
Runnable	TokenNameIdentifier	 Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
recycled	TokenNameIdentifier	 recycled
=	TokenNameEQUAL	
segment	TokenNameIdentifier	 segment
.	TokenNameDOT	
recycle	TokenNameIdentifier	 recycle
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
internalAddReadySegment	TokenNameIdentifier	 internal Add Ready Segment
(	TokenNameLPAREN	
recycled	TokenNameIdentifier	 recycled
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Differs from the above because it can work on any file instead of just existing * commit log segments managed by this allocator. * * @param file segment file that is no longer in use. */	TokenNameCOMMENT_JAVADOC	 Differs from the above because it can work on any file instead of just existing commit log segments managed by this allocator. * @param file segment file that is no longer in use. 
public	TokenNamepublic	
void	TokenNamevoid	
recycleSegment	TokenNameIdentifier	 recycle Segment
(	TokenNameLPAREN	
final	TokenNamefinal	
File	TokenNameIdentifier	 File
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// check against SEGMENT_SIZE avoids recycling odd-sized or empty segments from old C* versions and unit tests 	TokenNameCOMMENT_LINE	check against SEGMENT_SIZE avoids recycling odd-sized or empty segments from old C* versions and unit tests 
if	TokenNameif	
(	TokenNameLPAREN	
isCapExceeded	TokenNameIdentifier	 is Cap Exceeded
(	TokenNameLPAREN	
)	TokenNameRPAREN	
||	TokenNameOR_OR	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
length	TokenNameIdentifier	 length
(	TokenNameLPAREN	
)	TokenNameRPAREN	
!=	TokenNameNOT_EQUAL	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
||	TokenNameOR_OR	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
.	TokenNameDOT	
fromFileName	TokenNameIdentifier	 from File Name
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getMessagingVersion	TokenNameIdentifier	 get Messaging Version
(	TokenNameLPAREN	
)	TokenNameRPAREN	
!=	TokenNameNOT_EQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
current_version	TokenNameIdentifier	 current version
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// (don't decrease managed size, since this was never a "live" segment) 	TokenNameCOMMENT_LINE	(don't decrease managed size, since this was never a "live" segment) 
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"(Unopened) segment {} is no longer needed and will be deleted now"	TokenNameStringLiteral	(Unopened) segment {} is no longer needed and will be deleted now
,	TokenNameCOMMA	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
FileUtils	TokenNameIdentifier	 File Utils
.	TokenNameDOT	
deleteWithConfirm	TokenNameIdentifier	 delete With Confirm
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Recycling {}"	TokenNameStringLiteral	Recycling {}
,	TokenNameCOMMA	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// this wasn't previously a live segment, so add it to the managed size when we make it live 	TokenNameCOMMENT_LINE	this wasn't previously a live segment, so add it to the managed size when we make it live 
size	TokenNameIdentifier	 size
.	TokenNameDOT	
addAndGet	TokenNameIdentifier	 add And Get
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
queue	TokenNameIdentifier	 queue
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
Runnable	TokenNameIdentifier	 Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
=	TokenNameEQUAL	
new	TokenNamenew	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
internalAddReadySegment	TokenNameIdentifier	 internal Add Ready Segment
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Indicates that a segment file should be deleted. * * @param segment segment to be discarded */	TokenNameCOMMENT_JAVADOC	 Indicates that a segment file should be deleted. * @param segment segment to be discarded 
private	TokenNameprivate	
void	TokenNamevoid	
discardSegment	TokenNameIdentifier	 discard Segment
(	TokenNameLPAREN	
final	TokenNamefinal	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
,	TokenNameCOMMA	
final	TokenNamefinal	
boolean	TokenNameboolean	
deleteFile	TokenNameIdentifier	 delete File
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Segment {} is no longer active and will be deleted {}"	TokenNameStringLiteral	Segment {} is no longer active and will be deleted {}
,	TokenNameCOMMA	
segment	TokenNameIdentifier	 segment
,	TokenNameCOMMA	
deleteFile	TokenNameIdentifier	 delete File
?	TokenNameQUESTION	
"now"	TokenNameStringLiteral	now
:	TokenNameCOLON	
"by the archive script"	TokenNameStringLiteral	by the archive script
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
size	TokenNameIdentifier	 size
.	TokenNameDOT	
addAndGet	TokenNameIdentifier	 add And Get
(	TokenNameLPAREN	
-	TokenNameMINUS	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
queue	TokenNameIdentifier	 queue
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
Runnable	TokenNameIdentifier	 Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
segment	TokenNameIdentifier	 segment
.	TokenNameDOT	
discard	TokenNameIdentifier	 discard
(	TokenNameLPAREN	
deleteFile	TokenNameIdentifier	 delete File
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return the space (in bytes) used by all segment files. */	TokenNameCOMMENT_JAVADOC	 @return the space (in bytes) used by all segment files. 
public	TokenNamepublic	
long	TokenNamelong	
bytesUsed	TokenNameIdentifier	 bytes Used
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
size	TokenNameIdentifier	 size
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @param name the filename to check * @return true if file is managed by this allocator. */	TokenNameCOMMENT_JAVADOC	 @param name the filename to check @return true if file is managed by this allocator. 
public	TokenNamepublic	
boolean	TokenNameboolean	
manages	TokenNameIdentifier	 manages
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
:	TokenNameCOLON	
Iterables	TokenNameIdentifier	 Iterables
.	TokenNameDOT	
concat	TokenNameIdentifier	 concat
(	TokenNameLPAREN	
activeSegments	TokenNameIdentifier	 active Segments
,	TokenNameCOMMA	
availableSegments	TokenNameIdentifier	 available Segments
)	TokenNameRPAREN	
)	TokenNameRPAREN	
if	TokenNameif	
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
true	TokenNametrue	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Creates and readies a brand new segment. * * @return the newly minted segment */	TokenNameCOMMENT_JAVADOC	 Creates and readies a brand new segment. * @return the newly minted segment 
private	TokenNameprivate	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
createFreshSegment	TokenNameIdentifier	 create Fresh Segment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
size	TokenNameIdentifier	 size
.	TokenNameDOT	
addAndGet	TokenNameIdentifier	 add And Get
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
internalAddReadySegment	TokenNameIdentifier	 internal Add Ready Segment
(	TokenNameLPAREN	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
.	TokenNameDOT	
freshSegment	TokenNameIdentifier	 fresh Segment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Adds a segment to our internal tracking list and makes it ready for consumption. * * @param segment the segment to add * @return the newly added segment */	TokenNameCOMMENT_JAVADOC	 Adds a segment to our internal tracking list and makes it ready for consumption. * @param segment the segment to add @return the newly added segment 
private	TokenNameprivate	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
internalAddReadySegment	TokenNameIdentifier	 internal Add Ready Segment
(	TokenNameLPAREN	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
!	TokenNameNOT	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
!	TokenNameNOT	
availableSegments	TokenNameIdentifier	 available Segments
.	TokenNameDOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
availableSegments	TokenNameIdentifier	 available Segments
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
segment	TokenNameIdentifier	 segment
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
segment	TokenNameIdentifier	 segment
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Check to see if the speculative current size exceeds the cap. * * @return true if cap is exceeded */	TokenNameCOMMENT_JAVADOC	 Check to see if the speculative current size exceeds the cap. * @return true if cap is exceeded 
private	TokenNameprivate	
boolean	TokenNameboolean	
isCapExceeded	TokenNameIdentifier	 is Cap Exceeded
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
long	TokenNamelong	
currentSize	TokenNameIdentifier	 current Size
=	TokenNameEQUAL	
size	TokenNameIdentifier	 size
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Total active commitlog segment space used is {}"	TokenNameStringLiteral	Total active commitlog segment space used is {}
,	TokenNameCOMMA	
currentSize	TokenNameIdentifier	 current Size
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
currentSize	TokenNameIdentifier	 current Size
>	TokenNameGREATER	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getTotalCommitlogSpaceInMB	TokenNameIdentifier	 get Total Commitlog Space In MB
(	TokenNameLPAREN	
)	TokenNameRPAREN	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Throws a flag that enables the behavior of keeping at least one spare segment * available at all times. */	TokenNameCOMMENT_JAVADOC	 Throws a flag that enables the behavior of keeping at least one spare segment available at all times. 
public	TokenNamepublic	
void	TokenNamevoid	
enableReserveSegmentCreation	TokenNameIdentifier	 enable Reserve Segment Creation
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
createReserveSegments	TokenNameIdentifier	 create Reserve Segments
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Force a flush on all dirty CFs represented in the oldest commitlog segment */	TokenNameCOMMENT_JAVADOC	 Force a flush on all dirty CFs represented in the oldest commitlog segment 
private	TokenNameprivate	
void	TokenNamevoid	
flushOldestTables	TokenNameIdentifier	 flush Oldest Tables
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
oldestSegment	TokenNameIdentifier	 oldest Segment
=	TokenNameEQUAL	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
peek	TokenNameIdentifier	 peek
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
oldestSegment	TokenNameIdentifier	 oldest Segment
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
dirtyCFId	TokenNameIdentifier	 dirty CF Id
:	TokenNameCOLON	
oldestSegment	TokenNameIdentifier	 oldest Segment
.	TokenNameDOT	
getDirtyCFIDs	TokenNameIdentifier	 get Dirty CFI Ds
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
String	TokenNameIdentifier	 String
keypace	TokenNameIdentifier	 keypace
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getCF	TokenNameIdentifier	 get CF
(	TokenNameLPAREN	
dirtyCFId	TokenNameIdentifier	 dirty CF Id
)	TokenNameRPAREN	
.	TokenNameDOT	
left	TokenNameIdentifier	 left
;	TokenNameSEMICOLON	
final	TokenNamefinal	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfs	TokenNameIdentifier	 cfs
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
keypace	TokenNameIdentifier	 keypace
)	TokenNameRPAREN	
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
dirtyCFId	TokenNameIdentifier	 dirty CF Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// flush shouldn't run on the commitlog executor, since it acquires Table.switchLock, 	TokenNameCOMMENT_LINE	flush shouldn't run on the commitlog executor, since it acquires Table.switchLock, 
// which may already be held by a thread waiting for the CL executor (via getContext), 	TokenNameCOMMENT_LINE	which may already be held by a thread waiting for the CL executor (via getContext), 
// causing deadlock 	TokenNameCOMMENT_LINE	causing deadlock 
Runnable	TokenNameIdentifier	 Runnable
runnable	TokenNameIdentifier	 runnable
=	TokenNameEQUAL	
new	TokenNamenew	
Runnable	TokenNameIdentifier	 Runnable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
forceFlush	TokenNameIdentifier	 force Flush
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
;	TokenNameSEMICOLON	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
optionalTasks	TokenNameIdentifier	 optional Tasks
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
runnable	TokenNameIdentifier	 runnable
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Resets all the segments, for testing purposes. DO NOT USE THIS OUTSIDE OF TESTS. */	TokenNameCOMMENT_JAVADOC	 Resets all the segments, for testing purposes. DO NOT USE THIS OUTSIDE OF TESTS. 
public	TokenNamepublic	
void	TokenNamevoid	
resetUnsafe	TokenNameIdentifier	 reset Unsafe
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Closing and clearing existing commit log segments..."	TokenNameStringLiteral	Closing and clearing existing commit log segments...
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
!	TokenNameNOT	
queue	TokenNameIdentifier	 queue
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
Thread	TokenNameIdentifier	 Thread
.	TokenNameDOT	
yield	TokenNameIdentifier	 yield
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
segment	TokenNameIdentifier	 segment
:	TokenNameCOLON	
Iterables	TokenNameIdentifier	 Iterables
.	TokenNameDOT	
concat	TokenNameIdentifier	 concat
(	TokenNameLPAREN	
activeSegments	TokenNameIdentifier	 active Segments
,	TokenNameCOMMA	
availableSegments	TokenNameIdentifier	 available Segments
)	TokenNameRPAREN	
)	TokenNameRPAREN	
segment	TokenNameIdentifier	 segment
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
activeSegments	TokenNameIdentifier	 active Segments
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
availableSegments	TokenNameIdentifier	 available Segments
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Initiates the shutdown process for the allocator thread. */	TokenNameCOMMENT_JAVADOC	 Initiates the shutdown process for the allocator thread. 
public	TokenNamepublic	
void	TokenNamevoid	
shutdown	TokenNameIdentifier	 shutdown
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
run	TokenNameIdentifier	 run
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Returns when the allocator thread terminates. */	TokenNameCOMMENT_JAVADOC	 Returns when the allocator thread terminates. 
public	TokenNamepublic	
void	TokenNamevoid	
awaitTermination	TokenNameIdentifier	 await Termination
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
{	TokenNameLBRACE	
allocationThread	TokenNameIdentifier	 allocation Thread
.	TokenNameDOT	
join	TokenNameIdentifier	 join
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return a read-only collection of the active commit log segments */	TokenNameCOMMENT_JAVADOC	 @return a read-only collection of the active commit log segments 
public	TokenNamepublic	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
>	TokenNameGREATER	
getActiveSegments	TokenNameIdentifier	 get Active Segments
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
unmodifiableCollection	TokenNameIdentifier	 unmodifiable Collection
(	TokenNameLPAREN	
activeSegments	TokenNameIdentifier	 active Segments
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
