/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
IOException	TokenNameIdentifier	 IO Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
InetSocketAddress	TokenNameIdentifier	 Inet Socket Address
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
SelectionKey	TokenNameIdentifier	 Selection Key
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
Selector	TokenNameIdentifier	 Selector
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
spi	TokenNameIdentifier	 spi
.	TokenNameDOT	
SelectorProvider	TokenNameIdentifier	 Selector Provider
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
HashSet	TokenNameIdentifier	 Hash Set
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Iterator	TokenNameIdentifier	 Iterator
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Set	TokenNameIdentifier	 Set
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
ExecutorService	TokenNameIdentifier	 Executor Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
RejectedExecutionException	TokenNameIdentifier	 Rejected Execution Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
SynchronousQueue	TokenNameIdentifier	 Synchronous Queue
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
TimeUnit	TokenNameIdentifier	 Time Unit
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
FBUtilities	TokenNameIdentifier	 FB Utilities
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
JMXEnabledThreadPoolExecutor	TokenNameIdentifier	 JMX Enabled Thread Pool Executor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
NamedThreadFactory	TokenNameIdentifier	 Named Thread Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
server	TokenNameIdentifier	 server
.	TokenNameDOT	
TNonblockingServer	TokenNameIdentifier	 T Nonblocking Server
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
server	TokenNameIdentifier	 server
.	TokenNameDOT	
TServer	TokenNameIdentifier	 T Server
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
transport	TokenNameIdentifier	 transport
.	TokenNameDOT	
TNonblockingServerTransport	TokenNameIdentifier	 T Nonblocking Server Transport
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
transport	TokenNameIdentifier	 transport
.	TokenNameDOT	
TNonblockingSocket	TokenNameIdentifier	 T Nonblocking Socket
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
transport	TokenNameIdentifier	 transport
.	TokenNameDOT	
TNonblockingTransport	TokenNameIdentifier	 T Nonblocking Transport
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
thrift	TokenNameIdentifier	 thrift
.	TokenNameDOT	
transport	TokenNameIdentifier	 transport
.	TokenNameDOT	
TTransportException	TokenNameIdentifier	 T Transport Exception
;	TokenNameSEMICOLON	
/** * This is a interim solution till THRIFT-1167 gets committed... * * The idea here is to avoid sticking to one CPU for IO's. For better throughput * it is spread across multiple threads. Number of selector thread can be the * number of CPU available. */	TokenNameCOMMENT_JAVADOC	 This is a interim solution till THRIFT-1167 gets committed... * The idea here is to avoid sticking to one CPU for IO's. For better throughput it is spread across multiple threads. Number of selector thread can be the number of CPU available. 
public	TokenNamepublic	
class	TokenNameclass	
CustomTHsHaServer	TokenNameIdentifier	 Custom T Hs Ha Server
extends	TokenNameextends	
TNonblockingServer	TokenNameIdentifier	 T Nonblocking Server
{	TokenNameLBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
LOGGER	TokenNameIdentifier	 LOGGER
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
CustomTHsHaServer	TokenNameIdentifier	 Custom T Hs Ha Server
.	TokenNameDOT	
class	TokenNameclass	
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
SelectorThread	TokenNameIdentifier	 Selector Thread
>	TokenNameGREATER	
ioThreads	TokenNameIdentifier	 io Threads
=	TokenNameEQUAL	
new	TokenNamenew	
HashSet	TokenNameIdentifier	 Hash Set
<	TokenNameLESS	
SelectorThread	TokenNameIdentifier	 Selector Thread
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
volatile	TokenNamevolatile	
boolean	TokenNameboolean	
stopped	TokenNameIdentifier	 stopped
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
ExecutorService	TokenNameIdentifier	 Executor Service
invoker	TokenNameIdentifier	 invoker
;	TokenNameSEMICOLON	
/** * All the arguments to Non Blocking Server will apply here. In addition, * executor pool will be responsible for creating the internal threads which * will process the data. threads for selection usually are equal to the * number of cpu's */	TokenNameCOMMENT_JAVADOC	 All the arguments to Non Blocking Server will apply here. In addition, executor pool will be responsible for creating the internal threads which will process the data. threads for selection usually are equal to the number of cpu's 
public	TokenNamepublic	
CustomTHsHaServer	TokenNameIdentifier	 Custom T Hs Ha Server
(	TokenNameLPAREN	
Args	TokenNameIdentifier	 Args
args	TokenNameIdentifier	 args
,	TokenNameCOMMA	
ExecutorService	TokenNameIdentifier	 Executor Service
invoker	TokenNameIdentifier	 invoker
,	TokenNameCOMMA	
int	TokenNameint	
threadCount	TokenNameIdentifier	 thread Count
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
invoker	TokenNameIdentifier	 invoker
=	TokenNameEQUAL	
invoker	TokenNameIdentifier	 invoker
;	TokenNameSEMICOLON	
// Create all the Network IO Threads. 	TokenNameCOMMENT_LINE	Create all the Network IO Threads. 
for	TokenNamefor	
(	TokenNameLPAREN	
int	TokenNameint	
i	TokenNameIdentifier	 i
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
i	TokenNameIdentifier	 i
<	TokenNameLESS	
threadCount	TokenNameIdentifier	 thread Count
;	TokenNameSEMICOLON	
++	TokenNamePLUS_PLUS	
i	TokenNameIdentifier	 i
)	TokenNameRPAREN	
ioThreads	TokenNameIdentifier	 io Threads
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
SelectorThread	TokenNameIdentifier	 Selector Thread
(	TokenNameLPAREN	
"Selector-Thread-"	TokenNameStringLiteral	Selector-Thread-
+	TokenNamePLUS	
i	TokenNameIdentifier	 i
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** @inheritDoc */	TokenNameCOMMENT_JAVADOC	 @inheritDoc 
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
serve	TokenNameIdentifier	 serve
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
startListening	TokenNameIdentifier	 start Listening
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
startThreads	TokenNameIdentifier	 start Threads
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
setServing	TokenNameIdentifier	 set Serving
(	TokenNameLPAREN	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
joinSelector	TokenNameIdentifier	 join Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
invoker	TokenNameIdentifier	 invoker
.	TokenNameDOT	
shutdown	TokenNameIdentifier	 shutdown
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
setServing	TokenNameIdentifier	 set Serving
(	TokenNameLPAREN	
false	TokenNamefalse	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
stopListening	TokenNameIdentifier	 stop Listening
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Save the remote socket as a thead local for future use of client state. */	TokenNameCOMMENT_JAVADOC	 Save the remote socket as a thead local for future use of client state. 
protected	TokenNameprotected	
class	TokenNameclass	
Invocation	TokenNameIdentifier	 Invocation
implements	TokenNameimplements	
Runnable	TokenNameIdentifier	 Runnable
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
frameBuffer	TokenNameIdentifier	 frame Buffer
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
;	TokenNameSEMICOLON	
public	TokenNamepublic	
Invocation	TokenNameIdentifier	 Invocation
(	TokenNameLPAREN	
final	TokenNamefinal	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
frameBuffer	TokenNameIdentifier	 frame Buffer
,	TokenNameCOMMA	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
frameBuffer	TokenNameIdentifier	 frame Buffer
=	TokenNameEQUAL	
frameBuffer	TokenNameIdentifier	 frame Buffer
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
thread	TokenNameIdentifier	 thread
=	TokenNameEQUAL	
thread	TokenNameIdentifier	 thread
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
TNonblockingSocket	TokenNameIdentifier	 T Nonblocking Socket
socket	TokenNameIdentifier	 socket
=	TokenNameEQUAL	
(	TokenNameLPAREN	
TNonblockingSocket	TokenNameIdentifier	 T Nonblocking Socket
)	TokenNameRPAREN	
frameBuffer	TokenNameIdentifier	 frame Buffer
.	TokenNameDOT	
trans_	TokenNameIdentifier	 trans
;	TokenNameSEMICOLON	
ThriftSessionManager	TokenNameIdentifier	 Thrift Session Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
setCurrentSocket	TokenNameIdentifier	 set Current Socket
(	TokenNameLPAREN	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getSocketChannel	TokenNameIdentifier	 get Socket Channel
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
socket	TokenNameIdentifier	 socket
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getRemoteSocketAddress	TokenNameIdentifier	 get Remote Socket Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
frameBuffer	TokenNameIdentifier	 frame Buffer
.	TokenNameDOT	
invoke	TokenNameIdentifier	 invoke
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// this is how we let the same selector thread change the selection type. 	TokenNameCOMMENT_LINE	this is how we let the same selector thread change the selection type. 
thread	TokenNameIdentifier	 thread
.	TokenNameDOT	
requestSelectInterestChange	TokenNameIdentifier	 request Select Interest Change
(	TokenNameLPAREN	
frameBuffer	TokenNameIdentifier	 frame Buffer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
protected	TokenNameprotected	
boolean	TokenNameboolean	
startThreads	TokenNameIdentifier	 start Threads
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
stopped	TokenNameIdentifier	 stopped
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
// start all the threads. 	TokenNameCOMMENT_LINE	start all the threads. 
for	TokenNamefor	
(	TokenNameLPAREN	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
:	TokenNameCOLON	
ioThreads	TokenNameIdentifier	 io Threads
)	TokenNameRPAREN	
thread	TokenNameIdentifier	 thread
.	TokenNameDOT	
start	TokenNameIdentifier	 start
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
true	TokenNametrue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
protected	TokenNameprotected	
void	TokenNamevoid	
joinSelector	TokenNameIdentifier	 join Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
// wait till all done with stuff's 	TokenNameCOMMENT_LINE	wait till all done with stuff's 
for	TokenNamefor	
(	TokenNameLPAREN	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
:	TokenNameCOLON	
ioThreads	TokenNameIdentifier	 io Threads
)	TokenNameRPAREN	
thread	TokenNameIdentifier	 thread
.	TokenNameDOT	
join	TokenNameIdentifier	 join
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
LOGGER	TokenNameIdentifier	 LOGGER
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
"Interrupted while joining threads!"	TokenNameStringLiteral	Interrupted while joining threads!
,	TokenNameCOMMA	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Stop serving and shut everything down. */	TokenNameCOMMENT_JAVADOC	 Stop serving and shut everything down. 
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
void	TokenNamevoid	
stop	TokenNameIdentifier	 stop
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
stopListening	TokenNameIdentifier	 stop Listening
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
stopped	TokenNameIdentifier	 stopped
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
:	TokenNameCOLON	
ioThreads	TokenNameIdentifier	 io Threads
)	TokenNameRPAREN	
thread	TokenNameIdentifier	 thread
.	TokenNameDOT	
wakeupSelector	TokenNameIdentifier	 wakeup Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
joinSelector	TokenNameIdentifier	 join Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * IO Threads will perform expensive IO operations... */	TokenNameCOMMENT_JAVADOC	 IO Threads will perform expensive IO operations... 
protected	TokenNameprotected	
class	TokenNameclass	
SelectorThread	TokenNameIdentifier	 Selector Thread
extends	TokenNameextends	
Thread	TokenNameIdentifier	 Thread
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
Selector	TokenNameIdentifier	 Selector
selector	TokenNameIdentifier	 selector
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
TNonblockingServerTransport	TokenNameIdentifier	 T Nonblocking Server Transport
serverTransport	TokenNameIdentifier	 server Transport
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
>	TokenNameGREATER	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
=	TokenNameEQUAL	
new	TokenNamenew	
HashSet	TokenNameIdentifier	 Hash Set
<	TokenNameLESS	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
SelectorThread	TokenNameIdentifier	 Selector Thread
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
selector	TokenNameIdentifier	 selector
=	TokenNameEQUAL	
SelectorProvider	TokenNameIdentifier	 Selector Provider
.	TokenNameDOT	
provider	TokenNameIdentifier	 provider
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
openSelector	TokenNameIdentifier	 open Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
serverTransport	TokenNameIdentifier	 server Transport
=	TokenNameEQUAL	
(	TokenNameLPAREN	
TNonblockingServerTransport	TokenNameIdentifier	 T Nonblocking Server Transport
)	TokenNameRPAREN	
serverTransport_	TokenNameIdentifier	 server Transport
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
serverTransport	TokenNameIdentifier	 server Transport
.	TokenNameDOT	
registerSelector	TokenNameIdentifier	 register Selector
(	TokenNameLPAREN	
selector	TokenNameIdentifier	 selector
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
ex	TokenNameIdentifier	 ex
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
"Couldnt open the NIO selector"	TokenNameStringLiteral	Couldnt open the NIO selector
,	TokenNameCOMMA	
ex	TokenNameIdentifier	 ex
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
run	TokenNameIdentifier	 run
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
while	TokenNamewhile	
(	TokenNameLPAREN	
!	TokenNameNOT	
stopped	TokenNameIdentifier	 stopped
)	TokenNameRPAREN	
{	TokenNameLBRACE	
select	TokenNameIdentifier	 select
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
Throwable	TokenNameIdentifier	 Throwable
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
{	TokenNameLBRACE	
LOGGER	TokenNameIdentifier	 LOGGER
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
"Uncaught Exception: "	TokenNameStringLiteral	Uncaught Exception: 
,	TokenNameCOMMA	
t	TokenNameIdentifier	 t
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
finally	TokenNamefinally	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
selector	TokenNameIdentifier	 selector
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// CASSANDRA-3867 	TokenNameCOMMENT_LINE	CASSANDRA-3867 
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// ignore this exception. 	TokenNameCOMMENT_LINE	ignore this exception. 
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
select	TokenNameIdentifier	 select
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
,	TokenNameCOMMA	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
// wait for new keys 	TokenNameCOMMENT_LINE	wait for new keys 
selector	TokenNameIdentifier	 selector
.	TokenNameDOT	
select	TokenNameIdentifier	 select
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Iterator	TokenNameIdentifier	 Iterator
<	TokenNameLESS	
SelectionKey	TokenNameIdentifier	 Selection Key
>	TokenNameGREATER	
keyIterator	TokenNameIdentifier	 key Iterator
=	TokenNameEQUAL	
selector	TokenNameIdentifier	 selector
.	TokenNameDOT	
selectedKeys	TokenNameIdentifier	 selected Keys
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
iterator	TokenNameIdentifier	 iterator
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
keyIterator	TokenNameIdentifier	 key Iterator
.	TokenNameDOT	
hasNext	TokenNameIdentifier	 has Next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
SelectionKey	TokenNameIdentifier	 Selection Key
key	TokenNameIdentifier	 key
=	TokenNameEQUAL	
keyIterator	TokenNameIdentifier	 key Iterator
.	TokenNameDOT	
next	TokenNameIdentifier	 next
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
keyIterator	TokenNameIdentifier	 key Iterator
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
isValid	TokenNameIdentifier	 is Valid
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// if invalid cleanup. 	TokenNameCOMMENT_LINE	if invalid cleanup. 
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
isAcceptable	TokenNameIdentifier	 is Acceptable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
handleAccept	TokenNameIdentifier	 handle Accept
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
isReadable	TokenNameIdentifier	 is Readable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
handleRead	TokenNameIdentifier	 handle Read
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
isWritable	TokenNameIdentifier	 is Writable
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
handleWrite	TokenNameIdentifier	 handle Write
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
else	TokenNameelse	
LOGGER	TokenNameIdentifier	 LOGGER
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Unexpected state "	TokenNameStringLiteral	Unexpected state 
+	TokenNamePLUS	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
interestOps	TokenNameIdentifier	 interest Ops
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
Exception	TokenNameIdentifier	 Exception
io	TokenNameIdentifier	 io
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// just ignore (?) 	TokenNameCOMMENT_LINE	just ignore (?) 
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// process the changes which are inserted after completion. 	TokenNameCOMMENT_LINE	process the changes which are inserted after completion. 
processInterestChanges	TokenNameIdentifier	 process Interest Changes
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
handleAccept	TokenNameIdentifier	 handle Accept
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
SelectionKey	TokenNameIdentifier	 Selection Key
clientKey	TokenNameIdentifier	 client Key
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
TNonblockingTransport	TokenNameIdentifier	 T Nonblocking Transport
client	TokenNameIdentifier	 client
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
// accept the connection 	TokenNameCOMMENT_LINE	accept the connection 
client	TokenNameIdentifier	 client
=	TokenNameEQUAL	
(	TokenNameLPAREN	
TNonblockingTransport	TokenNameIdentifier	 T Nonblocking Transport
)	TokenNameRPAREN	
serverTransport	TokenNameIdentifier	 server Transport
.	TokenNameDOT	
accept	TokenNameIdentifier	 accept
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
clientKey	TokenNameIdentifier	 client Key
=	TokenNameEQUAL	
client	TokenNameIdentifier	 client
.	TokenNameDOT	
registerSelector	TokenNameIdentifier	 register Selector
(	TokenNameLPAREN	
selector	TokenNameIdentifier	 selector
,	TokenNameCOMMA	
SelectionKey	TokenNameIdentifier	 Selection Key
.	TokenNameDOT	
OP_READ	TokenNameIdentifier	 OP  READ
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// add this key to the map 	TokenNameCOMMENT_LINE	add this key to the map 
FrameBuffer	TokenNameIdentifier	 Frame Buffer
frameBuffer	TokenNameIdentifier	 frame Buffer
=	TokenNameEQUAL	
new	TokenNamenew	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
(	TokenNameLPAREN	
client	TokenNameIdentifier	 client
,	TokenNameCOMMA	
clientKey	TokenNameIdentifier	 client Key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
clientKey	TokenNameIdentifier	 client Key
.	TokenNameDOT	
attach	TokenNameIdentifier	 attach
(	TokenNameLPAREN	
frameBuffer	TokenNameIdentifier	 frame Buffer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
TTransportException	TokenNameIdentifier	 T Transport Exception
ex	TokenNameIdentifier	 ex
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// ignore this might have been handled by the other threads. 	TokenNameCOMMENT_LINE	ignore this might have been handled by the other threads. 
// serverTransport.accept() as it returns null as nothing to accept. 	TokenNameCOMMENT_LINE	serverTransport.accept() as it returns null as nothing to accept. 
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
tte	TokenNameIdentifier	 tte
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// something went wrong accepting. 	TokenNameCOMMENT_LINE	something went wrong accepting. 
LOGGER	TokenNameIdentifier	 LOGGER
.	TokenNameDOT	
warn	TokenNameIdentifier	 warn
(	TokenNameLPAREN	
"Exception trying to accept!"	TokenNameStringLiteral	Exception trying to accept!
,	TokenNameCOMMA	
tte	TokenNameIdentifier	 tte
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
tte	TokenNameIdentifier	 tte
.	TokenNameDOT	
printStackTrace	TokenNameIdentifier	 print Stack Trace
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
clientKey	TokenNameIdentifier	 client Key
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
clientKey	TokenNameIdentifier	 client Key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
client	TokenNameIdentifier	 client
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
client	TokenNameIdentifier	 client
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
handleRead	TokenNameIdentifier	 handle Read
(	TokenNameLPAREN	
SelectionKey	TokenNameIdentifier	 Selection Key
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
{	TokenNameLBRACE	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
buffer	TokenNameIdentifier	 buffer
=	TokenNameEQUAL	
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
)	TokenNameRPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
attachment	TokenNameIdentifier	 attachment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
read	TokenNameIdentifier	 read
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
isFrameFullyRead	TokenNameIdentifier	 is Frame Fully Read
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
requestInvoke	TokenNameIdentifier	 request Invoke
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
,	TokenNameCOMMA	
this	TokenNamethis	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
handleWrite	TokenNameIdentifier	 handle Write
(	TokenNameLPAREN	
SelectionKey	TokenNameIdentifier	 Selection Key
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
{	TokenNameLBRACE	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
buffer	TokenNameIdentifier	 buffer
=	TokenNameEQUAL	
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
)	TokenNameRPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
attachment	TokenNameIdentifier	 attachment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
requestSelectInterestChange	TokenNameIdentifier	 request Select Interest Change
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
frameBuffer	TokenNameIdentifier	 frame Buffer
)	TokenNameRPAREN	
{	TokenNameLBRACE	
synchronized	TokenNamesynchronized	
(	TokenNameLPAREN	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
)	TokenNameRPAREN	
{	TokenNameLBRACE	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
frameBuffer	TokenNameIdentifier	 frame Buffer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// Wake-up the selector, if it's currently blocked. 	TokenNameCOMMENT_LINE	Wake-up the selector, if it's currently blocked. 
selector	TokenNameIdentifier	 selector
.	TokenNameDOT	
wakeup	TokenNameIdentifier	 wakeup
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
processInterestChanges	TokenNameIdentifier	 process Interest Changes
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
synchronized	TokenNamesynchronized	
(	TokenNameLPAREN	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
fb	TokenNameIdentifier	 fb
:	TokenNameCOLON	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
)	TokenNameRPAREN	
fb	TokenNameIdentifier	 fb
.	TokenNameDOT	
changeSelectInterests	TokenNameIdentifier	 change Select Interests
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
selectInterestChanges	TokenNameIdentifier	 select Interest Changes
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
void	TokenNamevoid	
cleanupSelectionkey	TokenNameIdentifier	 cleanup Selectionkey
(	TokenNameLPAREN	
SelectionKey	TokenNameIdentifier	 Selection Key
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
{	TokenNameLBRACE	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
buffer	TokenNameIdentifier	 buffer
=	TokenNameEQUAL	
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
)	TokenNameRPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
attachment	TokenNameIdentifier	 attachment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// cancel the selection key 	TokenNameCOMMENT_LINE	cancel the selection key 
key	TokenNameIdentifier	 key
.	TokenNameDOT	
cancel	TokenNameIdentifier	 cancel
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
wakeupSelector	TokenNameIdentifier	 wakeup Selector
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
selector	TokenNameIdentifier	 selector
.	TokenNameDOT	
wakeup	TokenNameIdentifier	 wakeup
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
protected	TokenNameprotected	
boolean	TokenNameboolean	
requestInvoke	TokenNameIdentifier	 request Invoke
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
frameBuffer	TokenNameIdentifier	 frame Buffer
,	TokenNameCOMMA	
SelectorThread	TokenNameIdentifier	 Selector Thread
thread	TokenNameIdentifier	 thread
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
Runnable	TokenNameIdentifier	 Runnable
invocation	TokenNameIdentifier	 invocation
=	TokenNameEQUAL	
new	TokenNamenew	
Invocation	TokenNameIdentifier	 Invocation
(	TokenNameLPAREN	
frameBuffer	TokenNameIdentifier	 frame Buffer
,	TokenNameCOMMA	
thread	TokenNameIdentifier	 thread
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
invoker	TokenNameIdentifier	 invoker
.	TokenNameDOT	
execute	TokenNameIdentifier	 execute
(	TokenNameLPAREN	
invocation	TokenNameIdentifier	 invocation
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
true	TokenNametrue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
RejectedExecutionException	TokenNameIdentifier	 Rejected Execution Exception
rx	TokenNameIdentifier	 rx
)	TokenNameRPAREN	
{	TokenNameLBRACE	
LOGGER	TokenNameIdentifier	 LOGGER
.	TokenNameDOT	
warn	TokenNameIdentifier	 warn
(	TokenNameLPAREN	
"ExecutorService rejected execution!"	TokenNameStringLiteral	ExecutorService rejected execution!
,	TokenNameCOMMA	
rx	TokenNameIdentifier	 rx
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
protected	TokenNameprotected	
void	TokenNamevoid	
requestSelectInterestChange	TokenNameIdentifier	 request Select Interest Change
(	TokenNameLPAREN	
FrameBuffer	TokenNameIdentifier	 Frame Buffer
fb	TokenNameIdentifier	 fb
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// Dont change the interest here, this has to be done by the selector 	TokenNameCOMMENT_LINE	Dont change the interest here, this has to be done by the selector 
// thread because the method is not synchronized with the rest of the 	TokenNameCOMMENT_LINE	thread because the method is not synchronized with the rest of the 
// selectors threads. 	TokenNameCOMMENT_LINE	selectors threads. 
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
Factory	TokenNameIdentifier	 Factory
implements	TokenNameimplements	
TServerFactory	TokenNameIdentifier	 T Server Factory
{	TokenNameLBRACE	
public	TokenNamepublic	
TServer	TokenNameIdentifier	 T Server
buildTServer	TokenNameIdentifier	 build T Server
(	TokenNameLPAREN	
Args	TokenNameIdentifier	 Args
args	TokenNameIdentifier	 args
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getClientEncryptionOptions	TokenNameIdentifier	 get Client Encryption Options
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
enabled	TokenNameIdentifier	 enabled
)	TokenNameRPAREN	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
"Client SSL is not supported for non-blocking sockets (hsha). Please remove client ssl from the configuration."	TokenNameStringLiteral	Client SSL is not supported for non-blocking sockets (hsha). Please remove client ssl from the configuration.
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
final	TokenNamefinal	
InetSocketAddress	TokenNameIdentifier	 Inet Socket Address
addr	TokenNameIdentifier	 addr
=	TokenNameEQUAL	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
addr	TokenNameIdentifier	 addr
;	TokenNameSEMICOLON	
TNonblockingServerTransport	TokenNameIdentifier	 T Nonblocking Server Transport
serverTransport	TokenNameIdentifier	 server Transport
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
serverTransport	TokenNameIdentifier	 server Transport
=	TokenNameEQUAL	
new	TokenNamenew	
TCustomNonblockingServerSocket	TokenNameIdentifier	 T Custom Nonblocking Server Socket
(	TokenNameLPAREN	
addr	TokenNameIdentifier	 addr
,	TokenNameCOMMA	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
keepAlive	TokenNameIdentifier	 keep Alive
,	TokenNameCOMMA	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
sendBufferSize	TokenNameIdentifier	 send Buffer Size
,	TokenNameCOMMA	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
recvBufferSize	TokenNameIdentifier	 recv Buffer Size
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
TTransportException	TokenNameIdentifier	 T Transport Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"Unable to create thrift socket to %s:%s"	TokenNameStringLiteral	Unable to create thrift socket to %s:%s
,	TokenNameCOMMA	
addr	TokenNameIdentifier	 addr
.	TokenNameDOT	
getAddress	TokenNameIdentifier	 get Address
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
addr	TokenNameIdentifier	 addr
.	TokenNameDOT	
getPort	TokenNameIdentifier	 get Port
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// This is NIO selector service but the invocation will be Multi-Threaded with the Executor service. 	TokenNameCOMMENT_LINE	This is NIO selector service but the invocation will be Multi-Threaded with the Executor service. 
ExecutorService	TokenNameIdentifier	 Executor Service
executorService	TokenNameIdentifier	 executor Service
=	TokenNameEQUAL	
new	TokenNamenew	
JMXEnabledThreadPoolExecutor	TokenNameIdentifier	 JMX Enabled Thread Pool Executor
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getRpcMinThreads	TokenNameIdentifier	 get Rpc Min Threads
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getRpcMaxThreads	TokenNameIdentifier	 get Rpc Max Threads
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
60L	TokenNameLongLiteral	
,	TokenNameCOMMA	
TimeUnit	TokenNameIdentifier	 Time Unit
.	TokenNameDOT	
SECONDS	TokenNameIdentifier	 SECONDS
,	TokenNameCOMMA	
new	TokenNamenew	
SynchronousQueue	TokenNameIdentifier	 Synchronous Queue
<	TokenNameLESS	
Runnable	TokenNameIdentifier	 Runnable
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
new	TokenNamenew	
NamedThreadFactory	TokenNameIdentifier	 Named Thread Factory
(	TokenNameLPAREN	
"RPC-Thread"	TokenNameStringLiteral	RPC-Thread
)	TokenNameRPAREN	
,	TokenNameCOMMA	
"RPC-THREAD-POOL"	TokenNameStringLiteral	RPC-THREAD-POOL
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
TNonblockingServer	TokenNameIdentifier	 T Nonblocking Server
.	TokenNameDOT	
Args	TokenNameIdentifier	 Args
serverArgs	TokenNameIdentifier	 server Args
=	TokenNameEQUAL	
new	TokenNamenew	
TNonblockingServer	TokenNameIdentifier	 T Nonblocking Server
.	TokenNameDOT	
Args	TokenNameIdentifier	 Args
(	TokenNameLPAREN	
serverTransport	TokenNameIdentifier	 server Transport
)	TokenNameRPAREN	
.	TokenNameDOT	
inputTransportFactory	TokenNameIdentifier	 input Transport Factory
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
inTransportFactory	TokenNameIdentifier	 in Transport Factory
)	TokenNameRPAREN	
.	TokenNameDOT	
outputTransportFactory	TokenNameIdentifier	 output Transport Factory
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
outTransportFactory	TokenNameIdentifier	 out Transport Factory
)	TokenNameRPAREN	
.	TokenNameDOT	
inputProtocolFactory	TokenNameIdentifier	 input Protocol Factory
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
tProtocolFactory	TokenNameIdentifier	 t Protocol Factory
)	TokenNameRPAREN	
.	TokenNameDOT	
outputProtocolFactory	TokenNameIdentifier	 output Protocol Factory
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
tProtocolFactory	TokenNameIdentifier	 t Protocol Factory
)	TokenNameRPAREN	
.	TokenNameDOT	
processor	TokenNameIdentifier	 processor
(	TokenNameLPAREN	
args	TokenNameIdentifier	 args
.	TokenNameDOT	
processor	TokenNameIdentifier	 processor
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Check for available processors in the system which will be equal to the IO Threads. 	TokenNameCOMMENT_LINE	Check for available processors in the system which will be equal to the IO Threads. 
return	TokenNamereturn	
new	TokenNamenew	
CustomTHsHaServer	TokenNameIdentifier	 Custom T Hs Ha Server
(	TokenNameLPAREN	
serverArgs	TokenNameIdentifier	 server Args
,	TokenNameCOMMA	
executorService	TokenNameIdentifier	 executor Service
,	TokenNameCOMMA	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
getAvailableProcessors	TokenNameIdentifier	 get Available Processors
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
