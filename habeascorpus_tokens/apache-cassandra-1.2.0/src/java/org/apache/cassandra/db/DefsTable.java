/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
IOException	TokenNameIdentifier	 IO Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
ExecutionException	TokenNameIdentifier	 Execution Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
Future	TokenNameIdentifier	 Future
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
collect	TokenNameIdentifier	 collect
.	TokenNameDOT	
Iterables	TokenNameIdentifier	 Iterables
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
collect	TokenNameIdentifier	 collect
.	TokenNameDOT	
MapDifference	TokenNameIdentifier	 Map Difference
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
google	TokenNameIdentifier	 google
.	TokenNameDOT	
common	TokenNameIdentifier	 common
.	TokenNameDOT	
collect	TokenNameIdentifier	 collect
.	TokenNameDOT	
Maps	TokenNameIdentifier	 Maps
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
BinaryDecoder	TokenNameIdentifier	 Binary Decoder
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
DecoderFactory	TokenNameIdentifier	 Decoder Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
specific	TokenNameIdentifier	 specific
.	TokenNameDOT	
SpecificDatumReader	TokenNameIdentifier	 Specific Datum Reader
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
specific	TokenNameIdentifier	 specific
.	TokenNameDOT	
SpecificRecord	TokenNameIdentifier	 Specific Record
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
compaction	TokenNameIdentifier	 compaction
.	TokenNameDOT	
CompactionManager	TokenNameIdentifier	 Compaction Manager
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
filter	TokenNameIdentifier	 filter
.	TokenNameDOT	
QueryFilter	TokenNameIdentifier	 Query Filter
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
filter	TokenNameIdentifier	 filter
.	TokenNameDOT	
QueryPath	TokenNameIdentifier	 Query Path
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
marshal	TokenNameIdentifier	 marshal
.	TokenNameDOT	
AsciiType	TokenNameIdentifier	 Ascii Type
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
marshal	TokenNameIdentifier	 marshal
.	TokenNameDOT	
UTF8Type	TokenNameIdentifier	 UT F8 Type
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
migration	TokenNameIdentifier	 migration
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
KsDef	TokenNameIdentifier	 Ks Def
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
exceptions	TokenNameIdentifier	 exceptions
.	TokenNameDOT	
ConfigurationException	TokenNameIdentifier	 Configuration Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
service	TokenNameIdentifier	 service
.	TokenNameDOT	
StorageService	TokenNameIdentifier	 Storage Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
service	TokenNameIdentifier	 service
.	TokenNameDOT	
MigrationManager	TokenNameIdentifier	 Migration Manager
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
FBUtilities	TokenNameIdentifier	 FB Utilities
;	TokenNameSEMICOLON	
/** * SCHEMA_{KEYSPACES, COLUMNFAMILIES, COLUMNS}_CF are used to store Keyspace/ColumnFamily attributes to make schema * load/distribution easy, it replaces old mechanism when local migrations where serialized, stored in system.Migrations * and used for schema distribution. * * SCHEMA_KEYSPACES_CF layout: * * <key (AsciiType)> * ascii => json_serialized_value * ... * </key> * * Where <key> is a name of keyspace e.g. "ks". * * SCHEMA_COLUMNFAMILIES_CF layout: * * <key (AsciiType)> * composite(ascii, ascii) => json_serialized_value * </key> * * Where <key> is a name of keyspace e.g. "ks"., first component of the column name is name of the ColumnFamily, last * component is the name of the ColumnFamily attribute. * * SCHEMA_COLUMNS_CF layout: * * <key (AsciiType)> * composite(ascii, ascii, ascii) => json_serialized value * </key> * * Where <key> is a name of keyspace e.g. "ks". * * Column names where made composite to support 3-level nesting which represents following structure: * "ColumnFamily name":"column name":"column attribute" => "value" * * Example of schema (using CLI): * * schema_keyspaces * ---------------- * RowKey: ks * => (column=durable_writes, value=true, timestamp=1327061028312185000) * => (column=name, value="ks", timestamp=1327061028312185000) * => (column=replication_factor, value=0, timestamp=1327061028312185000) * => (column=strategy_class, value="org.apache.cassandra.locator.NetworkTopologyStrategy", timestamp=1327061028312185000) * => (column=strategy_options, value={"datacenter1":"1"}, timestamp=1327061028312185000) * * schema_columnfamilies * --------------------- * RowKey: ks * => (column=cf:bloom_filter_fp_chance, value=0.0, timestamp=1327061105833119000) * => (column=cf:caching, value="NONE", timestamp=1327061105833119000) * => (column=cf:column_type, value="Standard", timestamp=1327061105833119000) * => (column=cf:comment, value="ColumnFamily", timestamp=1327061105833119000) * => (column=cf:default_validation_class, value="org.apache.cassandra.db.marshal.BytesType", timestamp=1327061105833119000) * => (column=cf:gc_grace_seconds, value=864000, timestamp=1327061105833119000) * => (column=cf:id, value=1000, timestamp=1327061105833119000) * => (column=cf:key_alias, value="S0VZ", timestamp=1327061105833119000) * ... part of the output omitted. * * schema_columns * -------------- * RowKey: ks * => (column=cf:c:index_name, value=null, timestamp=1327061105833119000) * => (column=cf:c:index_options, value=null, timestamp=1327061105833119000) * => (column=cf:c:index_type, value=null, timestamp=1327061105833119000) * => (column=cf:c:name, value="aGVsbG8=", timestamp=1327061105833119000) * => (column=cf:c:validation_class, value="org.apache.cassandra.db.marshal.AsciiType", timestamp=1327061105833119000) */	TokenNameCOMMENT_JAVADOC	 SCHEMA_{KEYSPACES, COLUMNFAMILIES, COLUMNS}_CF are used to store Keyspace/ColumnFamily attributes to make schema load/distribution easy, it replaces old mechanism when local migrations where serialized, stored in system.Migrations and used for schema distribution. * SCHEMA_KEYSPACES_CF layout: * <key (AsciiType)> ascii => json_serialized_value ... </key> * Where <key> is a name of keyspace e.g. "ks". * SCHEMA_COLUMNFAMILIES_CF layout: * <key (AsciiType)> composite(ascii, ascii) => json_serialized_value </key> * Where <key> is a name of keyspace e.g. "ks"., first component of the column name is name of the ColumnFamily, last component is the name of the ColumnFamily attribute. * SCHEMA_COLUMNS_CF layout: * <key (AsciiType)> composite(ascii, ascii, ascii) => json_serialized value </key> * Where <key> is a name of keyspace e.g. "ks". * Column names where made composite to support 3-level nesting which represents following structure: "ColumnFamily name":"column name":"column attribute" => "value" * Example of schema (using CLI): * schema_keyspaces ---------------- RowKey: ks => (column=durable_writes, value=true, timestamp=1327061028312185000) => (column=name, value="ks", timestamp=1327061028312185000) => (column=replication_factor, value=0, timestamp=1327061028312185000) => (column=strategy_class, value="org.apache.cassandra.locator.NetworkTopologyStrategy", timestamp=1327061028312185000) => (column=strategy_options, value={"datacenter1":"1"}, timestamp=1327061028312185000) * schema_columnfamilies --------------------- RowKey: ks => (column=cf:bloom_filter_fp_chance, value=0.0, timestamp=1327061105833119000) => (column=cf:caching, value="NONE", timestamp=1327061105833119000) => (column=cf:column_type, value="Standard", timestamp=1327061105833119000) => (column=cf:comment, value="ColumnFamily", timestamp=1327061105833119000) => (column=cf:default_validation_class, value="org.apache.cassandra.db.marshal.BytesType", timestamp=1327061105833119000) => (column=cf:gc_grace_seconds, value=864000, timestamp=1327061105833119000) => (column=cf:id, value=1000, timestamp=1327061105833119000) => (column=cf:key_alias, value="S0VZ", timestamp=1327061105833119000) ... part of the output omitted. * schema_columns -------------- RowKey: ks => (column=cf:c:index_name, value=null, timestamp=1327061105833119000) => (column=cf:c:index_options, value=null, timestamp=1327061105833119000) => (column=cf:c:index_type, value=null, timestamp=1327061105833119000) => (column=cf:c:name, value="aGVsbG8=", timestamp=1327061105833119000) => (column=cf:c:validation_class, value="org.apache.cassandra.db.marshal.AsciiType", timestamp=1327061105833119000) 
public	TokenNamepublic	
class	TokenNameclass	
DefsTable	TokenNameIdentifier	 Defs Table
{	TokenNameLBRACE	
private	TokenNameprivate	
final	TokenNamefinal	
static	TokenNamestatic	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
DefsTable	TokenNameIdentifier	 Defs Table
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// unbuffered decoders 	TokenNameCOMMENT_LINE	unbuffered decoders 
private	TokenNameprivate	
final	TokenNamefinal	
static	TokenNamestatic	
DecoderFactory	TokenNameIdentifier	 Decoder Factory
DIRECT_DECODERS	TokenNameIdentifier	 DIRECT  DECODERS
=	TokenNameEQUAL	
new	TokenNamenew	
DecoderFactory	TokenNameIdentifier	 Decoder Factory
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
configureDirectDecoder	TokenNameIdentifier	 configure Direct Decoder
(	TokenNameLPAREN	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// column name for the schema storing serialized keyspace definitions 	TokenNameCOMMENT_LINE	column name for the schema storing serialized keyspace definitions 
// NB: must be an invalid keyspace name 	TokenNameCOMMENT_LINE	NB: must be an invalid keyspace name 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
DEFINITION_SCHEMA_COLUMN_NAME	TokenNameIdentifier	 DEFINITION  SCHEMA  COLUMN  NAME
=	TokenNameEQUAL	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
bytes	TokenNameIdentifier	 bytes
(	TokenNameLPAREN	
"Avro/Schema"	TokenNameStringLiteral	Avro/Schema
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
OLD_MIGRATIONS_CF	TokenNameIdentifier	 OLD  MIGRATIONS  CF
=	TokenNameEQUAL	
"Migrations"	TokenNameStringLiteral	Migrations
;	TokenNameSEMICOLON	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
String	TokenNameIdentifier	 String
OLD_SCHEMA_CF	TokenNameIdentifier	 OLD  SCHEMA  CF
=	TokenNameEQUAL	
"Schema"	TokenNameStringLiteral	Schema
;	TokenNameSEMICOLON	
/* saves keyspace definitions to system schema columnfamilies */	TokenNameCOMMENT_BLOCK	 saves keyspace definitions to system schema columnfamilies 
public	TokenNamepublic	
static	TokenNamestatic	
synchronized	TokenNamesynchronized	
void	TokenNamevoid	
save	TokenNameIdentifier	 save
(	TokenNameLPAREN	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
keyspaces	TokenNameIdentifier	 keyspaces
)	TokenNameRPAREN	
{	TokenNameLBRACE	
long	TokenNamelong	
timestamp	TokenNameIdentifier	 timestamp
=	TokenNameEQUAL	
System	TokenNameIdentifier	 System
.	TokenNameDOT	
currentTimeMillis	TokenNameIdentifier	 current Time Millis
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksMetaData	TokenNameIdentifier	 ks Meta Data
:	TokenNameCOLON	
keyspaces	TokenNameIdentifier	 keyspaces
)	TokenNameRPAREN	
ksMetaData	TokenNameIdentifier	 ks Meta Data
.	TokenNameDOT	
toSchema	TokenNameIdentifier	 to Schema
(	TokenNameLPAREN	
timestamp	TokenNameIdentifier	 timestamp
)	TokenNameRPAREN	
.	TokenNameDOT	
apply	TokenNameIdentifier	 apply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Load keyspace definitions for the system keyspace (system.SCHEMA_KEYSPACES_CF) * * @return Collection of found keyspace definitions */	TokenNameCOMMENT_JAVADOC	 Load keyspace definitions for the system keyspace (system.SCHEMA_KEYSPACES_CF) * @return Collection of found keyspace definitions 
public	TokenNamepublic	
static	TokenNamestatic	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
loadFromTable	TokenNameIdentifier	 load From Table
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Row	TokenNameIdentifier	 Row
>	TokenNameGREATER	
serializedSchema	TokenNameIdentifier	 serialized Schema
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
serializedSchema	TokenNameIdentifier	 serialized Schema
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_KEYSPACES_CF	TokenNameIdentifier	 SCHEMA  KEYSPACES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
keyspaces	TokenNameIdentifier	 keyspaces
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
(	TokenNameLPAREN	
serializedSchema	TokenNameIdentifier	 serialized Schema
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
Row	TokenNameIdentifier	 Row
row	TokenNameIdentifier	 row
:	TokenNameCOLON	
serializedSchema	TokenNameIdentifier	 serialized Schema
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
invalidSchemaRow	TokenNameIdentifier	 invalid Schema Row
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
||	TokenNameOR_OR	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
ignoredSchemaRow	TokenNameIdentifier	 ignored Schema Row
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
)	TokenNameRPAREN	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
keyspaces	TokenNameIdentifier	 keyspaces
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
fromSchema	TokenNameIdentifier	 from Schema
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
,	TokenNameCOMMA	
serializedColumnFamilies	TokenNameIdentifier	 serialized Column Families
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
return	TokenNamereturn	
keyspaces	TokenNameIdentifier	 keyspaces
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
void	TokenNamevoid	
fixSchemaNanoTimestamps	TokenNameIdentifier	 fix Schema Nano Timestamps
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
fixSchemaNanoTimestamp	TokenNameIdentifier	 fix Schema Nano Timestamp
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_KEYSPACES_CF	TokenNameIdentifier	 SCHEMA  KEYSPACES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
fixSchemaNanoTimestamp	TokenNameIdentifier	 fix Schema Nano Timestamp
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
fixSchemaNanoTimestamp	TokenNameIdentifier	 fix Schema Nano Timestamp
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNS_CF	TokenNameIdentifier	 SCHEMA  COLUMNS  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
fixSchemaNanoTimestamp	TokenNameIdentifier	 fix Schema Nano Timestamp
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
columnFamily	TokenNameIdentifier	 column Family
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfs	TokenNameIdentifier	 cfs
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
SYSTEM_KS	TokenNameIdentifier	 SYSTEM  KS
)	TokenNameRPAREN	
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
columnFamily	TokenNameIdentifier	 column Family
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
boolean	TokenNameboolean	
needsCleanup	TokenNameIdentifier	 needs Cleanup
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
Date	TokenNameIdentifier	 Date
now	TokenNameIdentifier	 now
=	TokenNameEQUAL	
new	TokenNamenew	
Date	TokenNameIdentifier	 Date
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Row	TokenNameIdentifier	 Row
>	TokenNameGREATER	
rows	TokenNameIdentifier	 rows
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
serializedSchema	TokenNameIdentifier	 serialized Schema
(	TokenNameLPAREN	
columnFamily	TokenNameIdentifier	 column Family
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
row_check_loop	TokenNameIdentifier	 row check loop
:	TokenNameCOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
Row	TokenNameIdentifier	 Row
row	TokenNameIdentifier	 row
:	TokenNameCOLON	
rows	TokenNameIdentifier	 rows
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
invalidSchemaRow	TokenNameIdentifier	 invalid Schema Row
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
)	TokenNameRPAREN	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
IColumn	TokenNameIdentifier	 I Column
column	TokenNameIdentifier	 column
:	TokenNameCOLON	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
columns	TokenNameIdentifier	 columns
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Date	TokenNameIdentifier	 Date
columnDate	TokenNameIdentifier	 column Date
=	TokenNameEQUAL	
new	TokenNamenew	
Date	TokenNameIdentifier	 Date
(	TokenNameLPAREN	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
timestamp	TokenNameIdentifier	 timestamp
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
columnDate	TokenNameIdentifier	 column Date
.	TokenNameDOT	
after	TokenNameIdentifier	 after
(	TokenNameLPAREN	
now	TokenNameIdentifier	 now
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Date	TokenNameIdentifier	 Date
micros	TokenNameIdentifier	 micros
=	TokenNameEQUAL	
new	TokenNamenew	
Date	TokenNameIdentifier	 Date
(	TokenNameLPAREN	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
timestamp	TokenNameIdentifier	 timestamp
(	TokenNameLPAREN	
)	TokenNameRPAREN	
/	TokenNameDIVIDE	
1000	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// assume that it was in micros 	TokenNameCOMMENT_LINE	assume that it was in micros 
Calendar	TokenNameIdentifier	 Calendar
calendar	TokenNameIdentifier	 calendar
=	TokenNameEQUAL	
Calendar	TokenNameIdentifier	 Calendar
.	TokenNameDOT	
getInstance	TokenNameIdentifier	 get Instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
calendar	TokenNameIdentifier	 calendar
.	TokenNameDOT	
setTime	TokenNameIdentifier	 set Time
(	TokenNameLPAREN	
micros	TokenNameIdentifier	 micros
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
(	TokenNameLPAREN	
micros	TokenNameIdentifier	 micros
.	TokenNameDOT	
before	TokenNameIdentifier	 before
(	TokenNameLPAREN	
now	TokenNameIdentifier	 now
)	TokenNameRPAREN	
&&	TokenNameAND_AND	
calendar	TokenNameIdentifier	 calendar
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
Calendar	TokenNameIdentifier	 Calendar
.	TokenNameDOT	
YEAR	TokenNameIdentifier	 YEAR
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
1970	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
||	TokenNameOR_OR	
micros	TokenNameIdentifier	 micros
.	TokenNameDOT	
after	TokenNameIdentifier	 after
(	TokenNameLPAREN	
now	TokenNameIdentifier	 now
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
needsCleanup	TokenNameIdentifier	 needs Cleanup
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
row_check_loop	TokenNameIdentifier	 row check loop
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
else	TokenNameelse	
// millis and we have to fix it to micros 	TokenNameCOMMENT_LINE	millis and we have to fix it to micros 
{	TokenNameLBRACE	
needsCleanup	TokenNameIdentifier	 needs Cleanup
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
row_check_loop	TokenNameIdentifier	 row check loop
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
needsCleanup	TokenNameIdentifier	 needs Cleanup
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
"Fixing timestamps of schema ColumnFamily "	TokenNameStringLiteral	Fixing timestamps of schema ColumnFamily 
+	TokenNamePLUS	
columnFamily	TokenNameIdentifier	 column Family
+	TokenNamePLUS	
"..."	TokenNameStringLiteral	...
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
truncate	TokenNameIdentifier	 truncate
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
ExecutionException	TokenNameIdentifier	 Execution Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
AssertionError	TokenNameIdentifier	 Assertion Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
long	TokenNamelong	
microTimestamp	TokenNameIdentifier	 micro Timestamp
=	TokenNameEQUAL	
now	TokenNameIdentifier	 now
.	TokenNameDOT	
getTime	TokenNameIdentifier	 get Time
(	TokenNameLPAREN	
)	TokenNameRPAREN	
*	TokenNameMULTIPLY	
1000	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
Row	TokenNameIdentifier	 Row
row	TokenNameIdentifier	 row
:	TokenNameCOLON	
rows	TokenNameIdentifier	 rows
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
invalidSchemaRow	TokenNameIdentifier	 invalid Schema Row
(	TokenNameLPAREN	
row	TokenNameIdentifier	 row
)	TokenNameRPAREN	
)	TokenNameRPAREN	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
RowMutation	TokenNameIdentifier	 Row Mutation
mutation	TokenNameIdentifier	 mutation
=	TokenNameEQUAL	
new	TokenNamenew	
RowMutation	TokenNameIdentifier	 Row Mutation
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
SYSTEM_KS	TokenNameIdentifier	 SYSTEM  KS
,	TokenNameCOMMA	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
IColumn	TokenNameIdentifier	 I Column
column	TokenNameIdentifier	 column
:	TokenNameCOLON	
row	TokenNameIdentifier	 row
.	TokenNameDOT	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
columns	TokenNameIdentifier	 columns
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
isLive	TokenNameIdentifier	 is Live
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
mutation	TokenNameIdentifier	 mutation
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
new	TokenNamenew	
QueryPath	TokenNameIdentifier	 Query Path
(	TokenNameLPAREN	
columnFamily	TokenNameIdentifier	 column Family
,	TokenNameCOMMA	
null	TokenNamenull	
,	TokenNameCOMMA	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
name	TokenNameIdentifier	 name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
value	TokenNameIdentifier	 value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
microTimestamp	TokenNameIdentifier	 micro Timestamp
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
mutation	TokenNameIdentifier	 mutation
.	TokenNameDOT	
apply	TokenNameIdentifier	 apply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// flush immediately because we read schema before replaying the commitlog 	TokenNameCOMMENT_LINE	flush immediately because we read schema before replaying the commitlog 
try	TokenNametry	
{	TokenNameLBRACE	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
forceBlockingFlush	TokenNameIdentifier	 force Blocking Flush
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
ExecutionException	TokenNameIdentifier	 Execution Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
"Could not flush after fixing schema timestamps"	TokenNameStringLiteral	Could not flush after fixing schema timestamps
,	TokenNameCOMMA	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
AssertionError	TokenNameIdentifier	 Assertion Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
searchComposite	TokenNameIdentifier	 search Composite
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
name	TokenNameIdentifier	 name
,	TokenNameCOMMA	
boolean	TokenNameboolean	
start	TokenNameIdentifier	 start
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
name	TokenNameIdentifier	 name
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
nameBytes	TokenNameIdentifier	 name Bytes
=	TokenNameEQUAL	
UTF8Type	TokenNameIdentifier	 UT F8 Type
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
decompose	TokenNameIdentifier	 decompose
(	TokenNameLPAREN	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
int	TokenNameint	
length	TokenNameIdentifier	 length
=	TokenNameEQUAL	
nameBytes	TokenNameIdentifier	 name Bytes
.	TokenNameDOT	
remaining	TokenNameIdentifier	 remaining
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
bytes	TokenNameIdentifier	 bytes
=	TokenNameEQUAL	
new	TokenNamenew	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
2	TokenNameIntegerLiteral	
+	TokenNamePLUS	
length	TokenNameIdentifier	 length
+	TokenNamePLUS	
1	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
;	TokenNameSEMICOLON	
bytes	TokenNameIdentifier	 bytes
[	TokenNameLBRACKET	
0	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
=	TokenNameEQUAL	
(	TokenNameLPAREN	
byte	TokenNamebyte	
)	TokenNameRPAREN	
(	TokenNameLPAREN	
(	TokenNameLPAREN	
length	TokenNameIdentifier	 length
>>	TokenNameRIGHT_SHIFT	
8	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
&	TokenNameAND	
0xFF	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
bytes	TokenNameIdentifier	 bytes
[	TokenNameLBRACKET	
1	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
=	TokenNameEQUAL	
(	TokenNameLPAREN	
byte	TokenNamebyte	
)	TokenNameRPAREN	
(	TokenNameLPAREN	
length	TokenNameIdentifier	 length
&	TokenNameAND	
0xFF	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
arrayCopy	TokenNameIdentifier	 array Copy
(	TokenNameLPAREN	
nameBytes	TokenNameIdentifier	 name Bytes
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
bytes	TokenNameIdentifier	 bytes
,	TokenNameCOMMA	
2	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
bytes	TokenNameIdentifier	 bytes
[	TokenNameLBRACKET	
bytes	TokenNameIdentifier	 bytes
.	TokenNameDOT	
length	TokenNameIdentifier	 length
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
]	TokenNameRBRACKET	
=	TokenNameEQUAL	
(	TokenNameLPAREN	
byte	TokenNamebyte	
)	TokenNameRPAREN	
(	TokenNameLPAREN	
start	TokenNameIdentifier	 start
?	TokenNameQUESTION	
0	TokenNameIntegerLiteral	
:	TokenNameCOLON	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
.	TokenNameDOT	
wrap	TokenNameIdentifier	 wrap
(	TokenNameLPAREN	
bytes	TokenNameIdentifier	 bytes
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
Row	TokenNameIdentifier	 Row
serializedColumnFamilies	TokenNameIdentifier	 serialized Column Families
(	TokenNameLPAREN	
DecoratedKey	TokenNameIdentifier	 Decorated Key
ksNameKey	TokenNameIdentifier	 ks Name Key
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfsStore	TokenNameIdentifier	 cfs Store
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
schemaCFS	TokenNameIdentifier	 schema CFS
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
ksNameKey	TokenNameIdentifier	 ks Name Key
,	TokenNameCOMMA	
cfsStore	TokenNameIdentifier	 cfs Store
.	TokenNameDOT	
getColumnFamily	TokenNameIdentifier	 get Column Family
(	TokenNameLPAREN	
QueryFilter	TokenNameIdentifier	 Query Filter
.	TokenNameDOT	
getIdentityFilter	TokenNameIdentifier	 get Identity Filter
(	TokenNameLPAREN	
ksNameKey	TokenNameIdentifier	 ks Name Key
,	TokenNameCOMMA	
new	TokenNamenew	
QueryPath	TokenNameIdentifier	 Query Path
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Loads a version of keyspace definitions from storage (using old SCHEMA_CF as a data source) * Note: If definitions where found in SCHEMA_CF this method would load them into new schema handling table KEYSPACE_CF * * @param version The version of the latest migration. * * @return Collection of found keyspace definitions * * @throws IOException if failed to read SCHEMA_CF or failed to deserialize Avro schema */	TokenNameCOMMENT_JAVADOC	 Loads a version of keyspace definitions from storage (using old SCHEMA_CF as a data source) Note: If definitions where found in SCHEMA_CF this method would load them into new schema handling table KEYSPACE_CF * @param version The version of the latest migration. * @return Collection of found keyspace definitions * @throws IOException if failed to read SCHEMA_CF or failed to deserialize Avro schema 
public	TokenNamepublic	
static	TokenNamestatic	
synchronized	TokenNamesynchronized	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
loadFromStorage	TokenNameIdentifier	 load From Storage
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
DecoratedKey	TokenNameIdentifier	 Decorated Key
vkey	TokenNameIdentifier	 vkey
=	TokenNameEQUAL	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
getPartitioner	TokenNameIdentifier	 get Partitioner
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
decorateKey	TokenNameIdentifier	 decorate Key
(	TokenNameLPAREN	
toUTF8Bytes	TokenNameIdentifier	 to UT F8 Bytes
(	TokenNameLPAREN	
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Table	TokenNameIdentifier	 Table
defs	TokenNameIdentifier	 defs
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
SYSTEM_KS	TokenNameIdentifier	 SYSTEM  KS
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfStore	TokenNameIdentifier	 cf Store
=	TokenNameEQUAL	
defs	TokenNameIdentifier	 defs
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
OLD_SCHEMA_CF	TokenNameIdentifier	 OLD  SCHEMA  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ColumnFamily	TokenNameIdentifier	 Column Family
cf	TokenNameIdentifier	 cf
=	TokenNameEQUAL	
cfStore	TokenNameIdentifier	 cf Store
.	TokenNameDOT	
getColumnFamily	TokenNameIdentifier	 get Column Family
(	TokenNameLPAREN	
QueryFilter	TokenNameIdentifier	 Query Filter
.	TokenNameDOT	
getIdentityFilter	TokenNameIdentifier	 get Identity Filter
(	TokenNameLPAREN	
vkey	TokenNameIdentifier	 vkey
,	TokenNameCOMMA	
new	TokenNamenew	
QueryPath	TokenNameIdentifier	 Query Path
(	TokenNameLPAREN	
OLD_SCHEMA_CF	TokenNameIdentifier	 OLD  SCHEMA  CF
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
IColumn	TokenNameIdentifier	 I Column
avroschema	TokenNameIdentifier	 avroschema
=	TokenNameEQUAL	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
getColumn	TokenNameIdentifier	 get Column
(	TokenNameLPAREN	
DEFINITION_SCHEMA_COLUMN_NAME	TokenNameIdentifier	 DEFINITION  SCHEMA  COLUMN  NAME
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
keyspaces	TokenNameIdentifier	 keyspaces
=	TokenNameEQUAL	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
emptyList	TokenNameIdentifier	 empty List
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
avroschema	TokenNameIdentifier	 avroschema
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
value	TokenNameIdentifier	 value
=	TokenNameEQUAL	
avroschema	TokenNameIdentifier	 avroschema
.	TokenNameDOT	
value	TokenNameIdentifier	 value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
Schema	TokenNameIdentifier	 Schema
schema	TokenNameIdentifier	 schema
=	TokenNameEQUAL	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
parse	TokenNameIdentifier	 parse
(	TokenNameLPAREN	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
string	TokenNameIdentifier	 string
(	TokenNameLPAREN	
value	TokenNameIdentifier	 value
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// deserialize keyspaces using schema 	TokenNameCOMMENT_LINE	deserialize keyspaces using schema 
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
IColumn	TokenNameIdentifier	 I Column
>	TokenNameGREATER	
columns	TokenNameIdentifier	 columns
=	TokenNameEQUAL	
cf	TokenNameIdentifier	 cf
.	TokenNameDOT	
getSortedColumns	TokenNameIdentifier	 get Sorted Columns
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
keyspaces	TokenNameIdentifier	 keyspaces
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
KSMetaData	TokenNameIdentifier	 KS Meta Data
>	TokenNameGREATER	
(	TokenNameLPAREN	
columns	TokenNameIdentifier	 columns
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
IColumn	TokenNameIdentifier	 I Column
column	TokenNameIdentifier	 column
:	TokenNameCOLON	
columns	TokenNameIdentifier	 columns
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
name	TokenNameIdentifier	 name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
equals	TokenNameIdentifier	 equals
(	TokenNameLPAREN	
DEFINITION_SCHEMA_COLUMN_NAME	TokenNameIdentifier	 DEFINITION  SCHEMA  COLUMN  NAME
)	TokenNameRPAREN	
)	TokenNameRPAREN	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
KsDef	TokenNameIdentifier	 Ks Def
ks	TokenNameIdentifier	 ks
=	TokenNameEQUAL	
deserializeAvro	TokenNameIdentifier	 deserialize Avro
(	TokenNameLPAREN	
schema	TokenNameIdentifier	 schema
,	TokenNameCOMMA	
column	TokenNameIdentifier	 column
.	TokenNameDOT	
value	TokenNameIdentifier	 value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
new	TokenNamenew	
KsDef	TokenNameIdentifier	 Ks Def
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
keyspaces	TokenNameIdentifier	 keyspaces
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
Avro	TokenNameIdentifier	 Avro
.	TokenNameDOT	
ksFromAvro	TokenNameIdentifier	 ks From Avro
(	TokenNameLPAREN	
ks	TokenNameIdentifier	 ks
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// store deserialized keyspaces into new place 	TokenNameCOMMENT_LINE	store deserialized keyspaces into new place 
save	TokenNameIdentifier	 save
(	TokenNameLPAREN	
keyspaces	TokenNameIdentifier	 keyspaces
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
"Truncating deprecated system column families (migrations, schema)..."	TokenNameStringLiteral	Truncating deprecated system column families (migrations, schema)...
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
dropColumnFamily	TokenNameIdentifier	 drop Column Family
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
SYSTEM_KS	TokenNameIdentifier	 SYSTEM  KS
,	TokenNameCOMMA	
OLD_MIGRATIONS_CF	TokenNameIdentifier	 OLD  MIGRATIONS  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
dropColumnFamily	TokenNameIdentifier	 drop Column Family
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
SYSTEM_KS	TokenNameIdentifier	 SYSTEM  KS
,	TokenNameCOMMA	
OLD_SCHEMA_CF	TokenNameIdentifier	 OLD  SCHEMA  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
return	TokenNamereturn	
keyspaces	TokenNameIdentifier	 keyspaces
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Merge remote schema in form of row mutations with local and mutate ks/cf metadata objects * (which also involves fs operations on add/drop ks/cf) * * @param mutations the schema changes to apply * * @throws ConfigurationException If one of metadata attributes has invalid value * @throws IOException If data was corrupted during transportation or failed to apply fs operations */	TokenNameCOMMENT_JAVADOC	 Merge remote schema in form of row mutations with local and mutate ks/cf metadata objects (which also involves fs operations on add/drop ks/cf) * @param mutations the schema changes to apply * @throws ConfigurationException If one of metadata attributes has invalid value @throws IOException If data was corrupted during transportation or failed to apply fs operations 
public	TokenNamepublic	
static	TokenNamestatic	
synchronized	TokenNamesynchronized	
void	TokenNamevoid	
mergeSchema	TokenNameIdentifier	 merge Schema
(	TokenNameLPAREN	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
RowMutation	TokenNameIdentifier	 Row Mutation
>	TokenNameGREATER	
mutations	TokenNameIdentifier	 mutations
)	TokenNameRPAREN	
throws	TokenNamethrows	
ConfigurationException	TokenNameIdentifier	 Configuration Exception
,	TokenNameCOMMA	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
// current state of the schema 	TokenNameCOMMENT_LINE	current state of the schema 
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
oldKeyspaces	TokenNameIdentifier	 old Keyspaces
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
getSchema	TokenNameIdentifier	 get Schema
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_KEYSPACES_CF	TokenNameIdentifier	 SCHEMA  KEYSPACES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
oldColumnFamilies	TokenNameIdentifier	 old Column Families
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
getSchema	TokenNameIdentifier	 get Schema
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
RowMutation	TokenNameIdentifier	 Row Mutation
mutation	TokenNameIdentifier	 mutation
:	TokenNameCOLON	
mutations	TokenNameIdentifier	 mutations
)	TokenNameRPAREN	
mutation	TokenNameIdentifier	 mutation
.	TokenNameDOT	
apply	TokenNameIdentifier	 apply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
flushSchemaCFs	TokenNameIdentifier	 flush Schema C Fs
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
updateVersionAndAnnounce	TokenNameIdentifier	 update Version And Announce
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// with new data applied 	TokenNameCOMMENT_LINE	with new data applied 
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
newKeyspaces	TokenNameIdentifier	 new Keyspaces
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
getSchema	TokenNameIdentifier	 get Schema
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_KEYSPACES_CF	TokenNameIdentifier	 SCHEMA  KEYSPACES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
newColumnFamilies	TokenNameIdentifier	 new Column Families
=	TokenNameEQUAL	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
getSchema	TokenNameIdentifier	 get Schema
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
String	TokenNameIdentifier	 String
>	TokenNameGREATER	
keyspacesToDrop	TokenNameIdentifier	 keyspaces To Drop
=	TokenNameEQUAL	
mergeKeyspaces	TokenNameIdentifier	 merge Keyspaces
(	TokenNameLPAREN	
oldKeyspaces	TokenNameIdentifier	 old Keyspaces
,	TokenNameCOMMA	
newKeyspaces	TokenNameIdentifier	 new Keyspaces
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
mergeColumnFamilies	TokenNameIdentifier	 merge Column Families
(	TokenNameLPAREN	
oldColumnFamilies	TokenNameIdentifier	 old Column Families
,	TokenNameCOMMA	
newColumnFamilies	TokenNameIdentifier	 new Column Families
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// it is safe to drop a keyspace only when all nested ColumnFamilies where deleted 	TokenNameCOMMENT_LINE	it is safe to drop a keyspace only when all nested ColumnFamilies where deleted 
for	TokenNamefor	
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
keyspaceToDrop	TokenNameIdentifier	 keyspace To Drop
:	TokenNameCOLON	
keyspacesToDrop	TokenNameIdentifier	 keyspaces To Drop
)	TokenNameRPAREN	
dropKeyspace	TokenNameIdentifier	 drop Keyspace
(	TokenNameLPAREN	
keyspaceToDrop	TokenNameIdentifier	 keyspace To Drop
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
String	TokenNameIdentifier	 String
>	TokenNameGREATER	
mergeKeyspaces	TokenNameIdentifier	 merge Keyspaces
(	TokenNameLPAREN	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
old	TokenNameIdentifier	 old
,	TokenNameCOMMA	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
updated	TokenNameIdentifier	 updated
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// calculate the difference between old and new states (note that entriesOnlyLeft() will be always empty) 	TokenNameCOMMENT_LINE	calculate the difference between old and new states (note that entriesOnlyLeft() will be always empty) 
MapDifference	TokenNameIdentifier	 Map Difference
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
diff	TokenNameIdentifier	 diff
=	TokenNameEQUAL	
Maps	TokenNameIdentifier	 Maps
.	TokenNameDOT	
difference	TokenNameIdentifier	 difference
(	TokenNameLPAREN	
old	TokenNameIdentifier	 old
,	TokenNameCOMMA	
updated	TokenNameIdentifier	 updated
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** * At first step we check if any new keyspaces were added. */	TokenNameCOMMENT_JAVADOC	 At first step we check if any new keyspaces were added. 
for	TokenNamefor	
(	TokenNameLPAREN	
Map	TokenNameIdentifier	 Map
.	TokenNameDOT	
Entry	TokenNameIdentifier	 Entry
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
entry	TokenNameIdentifier	 entry
:	TokenNameCOLON	
diff	TokenNameIdentifier	 diff
.	TokenNameDOT	
entriesOnlyOnRight	TokenNameIdentifier	 entries Only On Right
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
entrySet	TokenNameIdentifier	 entry Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamily	TokenNameIdentifier	 Column Family
ksAttrs	TokenNameIdentifier	 ks Attrs
=	TokenNameEQUAL	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// we don't care about nested ColumnFamilies here because those are going to be processed separately 	TokenNameCOMMENT_LINE	we don't care about nested ColumnFamilies here because those are going to be processed separately 
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
ksAttrs	TokenNameIdentifier	 ks Attrs
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
addKeyspace	TokenNameIdentifier	 add Keyspace
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
fromSchema	TokenNameIdentifier	 from Schema
(	TokenNameLPAREN	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getKey	TokenNameIdentifier	 get Key
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
emptyList	TokenNameIdentifier	 empty List
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * At second step we check if there were any keyspaces re-created, in this context * re-created means that they were previously deleted but still exist in the low-level schema as empty keys */	TokenNameCOMMENT_JAVADOC	 At second step we check if there were any keyspaces re-created, in this context re-created means that they were previously deleted but still exist in the low-level schema as empty keys 
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
ColumnFamily	TokenNameIdentifier	 Column Family
>>	TokenNameRIGHT_SHIFT	
modifiedEntries	TokenNameIdentifier	 modified Entries
=	TokenNameEQUAL	
diff	TokenNameIdentifier	 diff
.	TokenNameDOT	
entriesDiffering	TokenNameIdentifier	 entries Differing
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// instead of looping over all modified entries and skipping processed keys all the time 	TokenNameCOMMENT_LINE	instead of looping over all modified entries and skipping processed keys all the time 
// we would rather store "left to process" items and iterate over them removing already met keys 	TokenNameCOMMENT_LINE	we would rather store "left to process" items and iterate over them removing already met keys 
List	TokenNameIdentifier	 List
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
>	TokenNameGREATER	
leftToProcess	TokenNameIdentifier	 left To Process
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
>	TokenNameGREATER	
(	TokenNameLPAREN	
modifiedEntries	TokenNameIdentifier	 modified Entries
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
Map	TokenNameIdentifier	 Map
.	TokenNameDOT	
Entry	TokenNameIdentifier	 Entry
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
ColumnFamily	TokenNameIdentifier	 Column Family
>>	TokenNameRIGHT_SHIFT	
entry	TokenNameIdentifier	 entry
:	TokenNameCOLON	
modifiedEntries	TokenNameIdentifier	 modified Entries
.	TokenNameDOT	
entrySet	TokenNameIdentifier	 entry Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamily	TokenNameIdentifier	 Column Family
prevValue	TokenNameIdentifier	 prev Value
=	TokenNameEQUAL	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
leftValue	TokenNameIdentifier	 left Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ColumnFamily	TokenNameIdentifier	 Column Family
newValue	TokenNameIdentifier	 new Value
=	TokenNameEQUAL	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
rightValue	TokenNameIdentifier	 right Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
prevValue	TokenNameIdentifier	 prev Value
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
addKeyspace	TokenNameIdentifier	 add Keyspace
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
fromSchema	TokenNameIdentifier	 from Schema
(	TokenNameLPAREN	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getKey	TokenNameIdentifier	 get Key
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
newValue	TokenNameIdentifier	 new Value
)	TokenNameRPAREN	
,	TokenNameCOMMA	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
emptyList	TokenNameIdentifier	 empty List
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
continue	TokenNamecontinue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
leftToProcess	TokenNameIdentifier	 left To Process
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getKey	TokenNameIdentifier	 get Key
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
leftToProcess	TokenNameIdentifier	 left To Process
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
return	TokenNamereturn	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
emptySet	TokenNameIdentifier	 empty Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
/** * At final step we updating modified keyspaces and saving keyspaces drop them later */	TokenNameCOMMENT_JAVADOC	 At final step we updating modified keyspaces and saving keyspaces drop them later 
Set	TokenNameIdentifier	 Set
<	TokenNameLESS	
String	TokenNameIdentifier	 String
>	TokenNameGREATER	
keyspacesToDrop	TokenNameIdentifier	 keyspaces To Drop
=	TokenNameEQUAL	
new	TokenNamenew	
HashSet	TokenNameIdentifier	 Hash Set
<	TokenNameLESS	
String	TokenNameIdentifier	 String
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
DecoratedKey	TokenNameIdentifier	 Decorated Key
key	TokenNameIdentifier	 key
:	TokenNameCOLON	
leftToProcess	TokenNameIdentifier	 left To Process
)	TokenNameRPAREN	
{	TokenNameLBRACE	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
valueDiff	TokenNameIdentifier	 value Diff
=	TokenNameEQUAL	
modifiedEntries	TokenNameIdentifier	 modified Entries
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ColumnFamily	TokenNameIdentifier	 Column Family
newState	TokenNameIdentifier	 new State
=	TokenNameEQUAL	
valueDiff	TokenNameIdentifier	 value Diff
.	TokenNameDOT	
rightValue	TokenNameIdentifier	 right Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
newState	TokenNameIdentifier	 new State
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
keyspacesToDrop	TokenNameIdentifier	 keyspaces To Drop
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
AsciiType	TokenNameIdentifier	 Ascii Type
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getString	TokenNameIdentifier	 get String
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
.	TokenNameDOT	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
else	TokenNameelse	
updateKeyspace	TokenNameIdentifier	 update Keyspace
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
fromSchema	TokenNameIdentifier	 from Schema
(	TokenNameLPAREN	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
key	TokenNameIdentifier	 key
,	TokenNameCOMMA	
newState	TokenNameIdentifier	 new State
)	TokenNameRPAREN	
,	TokenNameCOMMA	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
emptyList	TokenNameIdentifier	 empty List
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
return	TokenNamereturn	
keyspacesToDrop	TokenNameIdentifier	 keyspaces To Drop
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
mergeColumnFamilies	TokenNameIdentifier	 merge Column Families
(	TokenNameLPAREN	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
old	TokenNameIdentifier	 old
,	TokenNameCOMMA	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
updated	TokenNameIdentifier	 updated
)	TokenNameRPAREN	
throws	TokenNamethrows	
ConfigurationException	TokenNameIdentifier	 Configuration Exception
,	TokenNameCOMMA	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
// calculate the difference between old and new states (note that entriesOnlyLeft() will be always empty) 	TokenNameCOMMENT_LINE	calculate the difference between old and new states (note that entriesOnlyLeft() will be always empty) 
MapDifference	TokenNameIdentifier	 Map Difference
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
diff	TokenNameIdentifier	 diff
=	TokenNameEQUAL	
Maps	TokenNameIdentifier	 Maps
.	TokenNameDOT	
difference	TokenNameIdentifier	 difference
(	TokenNameLPAREN	
old	TokenNameIdentifier	 old
,	TokenNameCOMMA	
updated	TokenNameIdentifier	 updated
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// check if any new Keyspaces with ColumnFamilies were added. 	TokenNameCOMMENT_LINE	check if any new Keyspaces with ColumnFamilies were added. 
for	TokenNamefor	
(	TokenNameLPAREN	
Map	TokenNameIdentifier	 Map
.	TokenNameDOT	
Entry	TokenNameIdentifier	 Entry
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
entry	TokenNameIdentifier	 entry
:	TokenNameCOLON	
diff	TokenNameIdentifier	 diff
.	TokenNameDOT	
entriesOnlyOnRight	TokenNameIdentifier	 entries Only On Right
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
entrySet	TokenNameIdentifier	 entry Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamily	TokenNameIdentifier	 Column Family
cfAttrs	TokenNameIdentifier	 cf Attrs
=	TokenNameEQUAL	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
cfAttrs	TokenNameIdentifier	 cf Attrs
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
cfDefs	TokenNameIdentifier	 cf Defs
=	TokenNameEQUAL	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
deserializeColumnFamilies	TokenNameIdentifier	 deserialize Column Families
(	TokenNameLPAREN	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
entry	TokenNameIdentifier	 entry
.	TokenNameDOT	
getKey	TokenNameIdentifier	 get Key
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
cfAttrs	TokenNameIdentifier	 cf Attrs
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfDef	TokenNameIdentifier	 cf Def
:	TokenNameCOLON	
cfDefs	TokenNameIdentifier	 cf Defs
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
addColumnFamily	TokenNameIdentifier	 add Column Family
(	TokenNameLPAREN	
cfDef	TokenNameIdentifier	 cf Def
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// deal with modified ColumnFamilies (remember that all of the keyspace nested ColumnFamilies are put to the single row) 	TokenNameCOMMENT_LINE	deal with modified ColumnFamilies (remember that all of the keyspace nested ColumnFamilies are put to the single row) 
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
DecoratedKey	TokenNameIdentifier	 Decorated Key
,	TokenNameCOMMA	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
ColumnFamily	TokenNameIdentifier	 Column Family
>>	TokenNameRIGHT_SHIFT	
modifiedEntries	TokenNameIdentifier	 modified Entries
=	TokenNameEQUAL	
diff	TokenNameIdentifier	 diff
.	TokenNameDOT	
entriesDiffering	TokenNameIdentifier	 entries Differing
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
DecoratedKey	TokenNameIdentifier	 Decorated Key
keyspace	TokenNameIdentifier	 keyspace
:	TokenNameCOLON	
modifiedEntries	TokenNameIdentifier	 modified Entries
.	TokenNameDOT	
keySet	TokenNameIdentifier	 key Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
ColumnFamily	TokenNameIdentifier	 Column Family
>	TokenNameGREATER	
valueDiff	TokenNameIdentifier	 value Diff
=	TokenNameEQUAL	
modifiedEntries	TokenNameIdentifier	 modified Entries
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
keyspace	TokenNameIdentifier	 keyspace
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ColumnFamily	TokenNameIdentifier	 Column Family
prevValue	TokenNameIdentifier	 prev Value
=	TokenNameEQUAL	
valueDiff	TokenNameIdentifier	 value Diff
.	TokenNameDOT	
leftValue	TokenNameIdentifier	 left Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// state before external modification 	TokenNameCOMMENT_LINE	state before external modification 
ColumnFamily	TokenNameIdentifier	 Column Family
newValue	TokenNameIdentifier	 new Value
=	TokenNameEQUAL	
valueDiff	TokenNameIdentifier	 value Diff
.	TokenNameDOT	
rightValue	TokenNameIdentifier	 right Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// updated state 	TokenNameCOMMENT_LINE	updated state 
Row	TokenNameIdentifier	 Row
newRow	TokenNameIdentifier	 new Row
=	TokenNameEQUAL	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
keyspace	TokenNameIdentifier	 keyspace
,	TokenNameCOMMA	
newValue	TokenNameIdentifier	 new Value
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
prevValue	TokenNameIdentifier	 prev Value
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
// whole keyspace was deleted and now it's re-created 	TokenNameCOMMENT_LINE	whole keyspace was deleted and now it's re-created 
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
:	TokenNameCOLON	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
deserializeColumnFamilies	TokenNameIdentifier	 deserialize Column Families
(	TokenNameLPAREN	
newRow	TokenNameIdentifier	 new Row
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
addColumnFamily	TokenNameIdentifier	 add Column Family
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
newValue	TokenNameIdentifier	 new Value
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
// whole keyspace is deleted 	TokenNameCOMMENT_LINE	whole keyspace is deleted 
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
:	TokenNameCOLON	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
deserializeColumnFamilies	TokenNameIdentifier	 deserialize Column Families
(	TokenNameLPAREN	
new	TokenNamenew	
Row	TokenNameIdentifier	 Row
(	TokenNameLPAREN	
keyspace	TokenNameIdentifier	 keyspace
,	TokenNameCOMMA	
prevValue	TokenNameIdentifier	 prev Value
)	TokenNameRPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
dropColumnFamily	TokenNameIdentifier	 drop Column Family
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
,	TokenNameCOMMA	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
// has modifications in the nested ColumnFamilies, need to perform nested diff to determine what was really changed 	TokenNameCOMMENT_LINE	has modifications in the nested ColumnFamilies, need to perform nested diff to determine what was really changed 
{	TokenNameLBRACE	
String	TokenNameIdentifier	 String
ksName	TokenNameIdentifier	 ks Name
=	TokenNameEQUAL	
AsciiType	TokenNameIdentifier	 Ascii Type
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getString	TokenNameIdentifier	 get String
(	TokenNameLPAREN	
keyspace	TokenNameIdentifier	 keyspace
.	TokenNameDOT	
key	TokenNameIdentifier	 key
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
oldCfDefs	TokenNameIdentifier	 old Cf Defs
=	TokenNameEQUAL	
new	TokenNamenew	
HashMap	TokenNameIdentifier	 Hash Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
:	TokenNameCOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getKSMetaData	TokenNameIdentifier	 get KS Meta Data
(	TokenNameLPAREN	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
oldCfDefs	TokenNameIdentifier	 old Cf Defs
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
,	TokenNameCOMMA	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Map	TokenNameIdentifier	 Map
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
newCfDefs	TokenNameIdentifier	 new Cf Defs
=	TokenNameEQUAL	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
deserializeColumnFamilies	TokenNameIdentifier	 deserialize Column Families
(	TokenNameLPAREN	
newRow	TokenNameIdentifier	 new Row
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MapDifference	TokenNameIdentifier	 Map Difference
<	TokenNameLESS	
String	TokenNameIdentifier	 String
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
cfDefDiff	TokenNameIdentifier	 cf Def Diff
=	TokenNameEQUAL	
Maps	TokenNameIdentifier	 Maps
.	TokenNameDOT	
difference	TokenNameIdentifier	 difference
(	TokenNameLPAREN	
oldCfDefs	TokenNameIdentifier	 old Cf Defs
,	TokenNameCOMMA	
newCfDefs	TokenNameIdentifier	 new Cf Defs
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfDef	TokenNameIdentifier	 cf Def
:	TokenNameCOLON	
cfDefDiff	TokenNameIdentifier	 cf Def Diff
.	TokenNameDOT	
entriesOnlyOnRight	TokenNameIdentifier	 entries Only On Right
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
addColumnFamily	TokenNameIdentifier	 add Column Family
(	TokenNameLPAREN	
cfDef	TokenNameIdentifier	 cf Def
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfDef	TokenNameIdentifier	 cf Def
:	TokenNameCOLON	
cfDefDiff	TokenNameIdentifier	 cf Def Diff
.	TokenNameDOT	
entriesOnlyOnLeft	TokenNameIdentifier	 entries Only On Left
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
dropColumnFamily	TokenNameIdentifier	 drop Column Family
(	TokenNameLPAREN	
cfDef	TokenNameIdentifier	 cf Def
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
,	TokenNameCOMMA	
cfDef	TokenNameIdentifier	 cf Def
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
MapDifference	TokenNameIdentifier	 Map Difference
.	TokenNameDOT	
ValueDifference	TokenNameIdentifier	 Value Difference
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
cfDef	TokenNameIdentifier	 cf Def
:	TokenNameCOLON	
cfDefDiff	TokenNameIdentifier	 cf Def Diff
.	TokenNameDOT	
entriesDiffering	TokenNameIdentifier	 entries Differing
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
updateColumnFamily	TokenNameIdentifier	 update Column Family
(	TokenNameLPAREN	
cfDef	TokenNameIdentifier	 cf Def
.	TokenNameDOT	
rightValue	TokenNameIdentifier	 right Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
addKeyspace	TokenNameIdentifier	 add Keyspace
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getKSMetaData	TokenNameIdentifier	 get KS Meta Data
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
load	TokenNameIdentifier	 load
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyCreateKeyspace	TokenNameIdentifier	 notify Create Keyspace
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
addColumnFamily	TokenNameIdentifier	 add Column Family
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
{	TokenNameLBRACE	
assert	TokenNameassert	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getCFMetaData	TokenNameIdentifier	 get CF Meta Data
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
,	TokenNameCOMMA	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksm	TokenNameIdentifier	 ksm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getTableDefinition	TokenNameIdentifier	 get Table Definition
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
ksm	TokenNameIdentifier	 ksm
=	TokenNameEQUAL	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
cloneWith	TokenNameIdentifier	 clone With
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
,	TokenNameCOMMA	
Iterables	TokenNameIdentifier	 Iterables
.	TokenNameDOT	
concat	TokenNameIdentifier	 concat
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
Collections	TokenNameIdentifier	 Collections
.	TokenNameDOT	
singleton	TokenNameIdentifier	 singleton
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
load	TokenNameIdentifier	 load
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// make sure it's init-ed w/ the old definitions first, 	TokenNameCOMMENT_LINE	make sure it's init-ed w/ the old definitions first, 
// since we're going to call initCf on the new one manually 	TokenNameCOMMENT_LINE	since we're going to call initCf on the new one manually 
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
setTableDefinition	TokenNameIdentifier	 set Table Definition
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
.	TokenNameDOT	
initCf	TokenNameIdentifier	 init Cf
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfId	TokenNameIdentifier	 cf Id
,	TokenNameCOMMA	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyCreateColumnFamily	TokenNameIdentifier	 notify Create Column Family
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
updateKeyspace	TokenNameIdentifier	 update Keyspace
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
newState	TokenNameIdentifier	 new State
)	TokenNameRPAREN	
{	TokenNameLBRACE	
KSMetaData	TokenNameIdentifier	 KS Meta Data
oldKsm	TokenNameIdentifier	 old Ksm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getKSMetaData	TokenNameIdentifier	 get KS Meta Data
(	TokenNameLPAREN	
newState	TokenNameIdentifier	 new State
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
oldKsm	TokenNameIdentifier	 old Ksm
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
KSMetaData	TokenNameIdentifier	 KS Meta Data
newKsm	TokenNameIdentifier	 new Ksm
=	TokenNameEQUAL	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
cloneWith	TokenNameIdentifier	 clone With
(	TokenNameLPAREN	
oldKsm	TokenNameIdentifier	 old Ksm
.	TokenNameDOT	
reloadAttributes	TokenNameIdentifier	 reload Attributes
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
oldKsm	TokenNameIdentifier	 old Ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
setTableDefinition	TokenNameIdentifier	 set Table Definition
(	TokenNameLPAREN	
newKsm	TokenNameIdentifier	 new Ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
newState	TokenNameIdentifier	 new State
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
.	TokenNameDOT	
createReplicationStrategy	TokenNameIdentifier	 create Replication Strategy
(	TokenNameLPAREN	
newKsm	TokenNameIdentifier	 new Ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyUpdateKeyspace	TokenNameIdentifier	 notify Update Keyspace
(	TokenNameLPAREN	
newKsm	TokenNameIdentifier	 new Ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
ConfigurationException	TokenNameIdentifier	 Configuration Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// It's too late to throw a configuration exception, we should have catch those previously 	TokenNameCOMMENT_LINE	It's too late to throw a configuration exception, we should have catch those previously 
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
updateColumnFamily	TokenNameIdentifier	 update Column Family
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
newState	TokenNameIdentifier	 new State
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getCFMetaData	TokenNameIdentifier	 get CF Meta Data
(	TokenNameLPAREN	
newState	TokenNameIdentifier	 new State
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
,	TokenNameCOMMA	
newState	TokenNameIdentifier	 new State
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
cfm	TokenNameIdentifier	 cfm
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
reload	TokenNameIdentifier	 reload
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Table	TokenNameIdentifier	 Table
table	TokenNameIdentifier	 table
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
table	TokenNameIdentifier	 table
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
.	TokenNameDOT	
reload	TokenNameIdentifier	 reload
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyUpdateColumnFamily	TokenNameIdentifier	 notify Update Column Family
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
dropKeyspace	TokenNameIdentifier	 drop Keyspace
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksm	TokenNameIdentifier	 ksm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getTableDefinition	TokenNameIdentifier	 get Table Definition
(	TokenNameLPAREN	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
String	TokenNameIdentifier	 String
snapshotName	TokenNameIdentifier	 snapshot Name
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
getTimestampedSnapshotName	TokenNameIdentifier	 get Timestamped Snapshot Name
(	TokenNameLPAREN	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CompactionManager	TokenNameIdentifier	 Compaction Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
stopCompactionFor	TokenNameIdentifier	 stop Compaction For
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// remove all cfs from the table instance. 	TokenNameCOMMENT_LINE	remove all cfs from the table instance. 
for	TokenNamefor	
(	TokenNameLPAREN	
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
:	TokenNameCOLON	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfs	TokenNameIdentifier	 cfs
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
purge	TokenNameIdentifier	 purge
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
isAutoSnapshot	TokenNameIdentifier	 is Auto Snapshot
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
snapshot	TokenNameIdentifier	 snapshot
(	TokenNameLPAREN	
snapshotName	TokenNameIdentifier	 snapshot Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
.	TokenNameDOT	
dropCf	TokenNameIdentifier	 drop Cf
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// remove the table from the static instances. 	TokenNameCOMMENT_LINE	remove the table from the static instances. 
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
clear	TokenNameIdentifier	 clear
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
clearTableDefinition	TokenNameIdentifier	 clear Table Definition
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyDropKeyspace	TokenNameIdentifier	 notify Drop Keyspace
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
dropColumnFamily	TokenNameIdentifier	 drop Column Family
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
ksName	TokenNameIdentifier	 ks Name
,	TokenNameCOMMA	
String	TokenNameIdentifier	 String
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksm	TokenNameIdentifier	 ksm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getTableDefinition	TokenNameIdentifier	 get Table Definition
(	TokenNameLPAREN	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
ksm	TokenNameIdentifier	 ksm
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
ColumnFamilyStore	TokenNameIdentifier	 Column Family Store
cfs	TokenNameIdentifier	 cfs
=	TokenNameEQUAL	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksName	TokenNameIdentifier	 ks Name
)	TokenNameRPAREN	
.	TokenNameDOT	
getColumnFamilyStore	TokenNameIdentifier	 get Column Family Store
(	TokenNameLPAREN	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
cfs	TokenNameIdentifier	 cfs
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
// reinitialize the table. 	TokenNameCOMMENT_LINE	reinitialize the table. 
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
=	TokenNameEQUAL	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
purge	TokenNameIdentifier	 purge
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
setTableDefinition	TokenNameIdentifier	 set Table Definition
(	TokenNameLPAREN	
makeNewKeyspaceDefinition	TokenNameIdentifier	 make New Keyspace Definition
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
,	TokenNameCOMMA	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CompactionManager	TokenNameIdentifier	 Compaction Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
stopCompactionFor	TokenNameIdentifier	 stop Compaction For
(	TokenNameLPAREN	
Arrays	TokenNameIdentifier	 Arrays
.	TokenNameDOT	
asList	TokenNameIdentifier	 as List
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
StorageService	TokenNameIdentifier	 Storage Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
isClientMode	TokenNameIdentifier	 is Client Mode
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
isAutoSnapshot	TokenNameIdentifier	 is Auto Snapshot
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
snapshot	TokenNameIdentifier	 snapshot
(	TokenNameLPAREN	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
getTimestampedSnapshotName	TokenNameIdentifier	 get Timestamped Snapshot Name
(	TokenNameLPAREN	
cfs	TokenNameIdentifier	 cfs
.	TokenNameDOT	
columnFamily	TokenNameIdentifier	 column Family
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Table	TokenNameIdentifier	 Table
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
name	TokenNameIdentifier	 name
)	TokenNameRPAREN	
.	TokenNameDOT	
dropCf	TokenNameIdentifier	 drop Cf
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
MigrationManager	TokenNameIdentifier	 Migration Manager
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
notifyDropColumnFamily	TokenNameIdentifier	 notify Drop Column Family
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
KSMetaData	TokenNameIdentifier	 KS Meta Data
makeNewKeyspaceDefinition	TokenNameIdentifier	 make New Keyspace Definition
(	TokenNameLPAREN	
KSMetaData	TokenNameIdentifier	 KS Meta Data
ksm	TokenNameIdentifier	 ksm
,	TokenNameCOMMA	
CFMetaData	TokenNameIdentifier	 CF Meta Data
toExclude	TokenNameIdentifier	 to Exclude
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// clone ksm but do not include the new def 	TokenNameCOMMENT_LINE	clone ksm but do not include the new def 
List	TokenNameIdentifier	 List
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
newCfs	TokenNameIdentifier	 new Cfs
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
CFMetaData	TokenNameIdentifier	 CF Meta Data
>	TokenNameGREATER	
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
values	TokenNameIdentifier	 values
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
newCfs	TokenNameIdentifier	 new Cfs
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
toExclude	TokenNameIdentifier	 to Exclude
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
newCfs	TokenNameIdentifier	 new Cfs
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
ksm	TokenNameIdentifier	 ksm
.	TokenNameDOT	
cfMetaData	TokenNameIdentifier	 cf Meta Data
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
-	TokenNameMINUS	
1	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
KSMetaData	TokenNameIdentifier	 KS Meta Data
.	TokenNameDOT	
cloneWith	TokenNameIdentifier	 clone With
(	TokenNameLPAREN	
ksm	TokenNameIdentifier	 ksm
,	TokenNameCOMMA	
newCfs	TokenNameIdentifier	 new Cfs
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
flushSchemaCFs	TokenNameIdentifier	 flush Schema C Fs
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
flushSchemaCF	TokenNameIdentifier	 flush Schema CF
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_KEYSPACES_CF	TokenNameIdentifier	 SCHEMA  KEYSPACES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
flushSchemaCF	TokenNameIdentifier	 flush Schema CF
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNFAMILIES_CF	TokenNameIdentifier	 SCHEMA  COLUMNFAMILIES  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
flushSchemaCF	TokenNameIdentifier	 flush Schema CF
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
SCHEMA_COLUMNS_CF	TokenNameIdentifier	 SCHEMA  COLUMNS  CF
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
void	TokenNamevoid	
flushSchemaCF	TokenNameIdentifier	 flush Schema CF
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
{	TokenNameLBRACE	
FBUtilities	TokenNameIdentifier	 FB Utilities
.	TokenNameDOT	
waitOnFuture	TokenNameIdentifier	 wait On Future
(	TokenNameLPAREN	
SystemTable	TokenNameIdentifier	 System Table
.	TokenNameDOT	
schemaCFS	TokenNameIdentifier	 schema CFS
(	TokenNameLPAREN	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
.	TokenNameDOT	
forceFlush	TokenNameIdentifier	 force Flush
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
toUTF8Bytes	TokenNameIdentifier	 to UT F8 Bytes
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
version	TokenNameIdentifier	 version
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
bytes	TokenNameIdentifier	 bytes
(	TokenNameLPAREN	
version	TokenNameIdentifier	 version
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Deserialize a single object based on the given Schema. * * @param writer writer's schema * @param bytes Array to deserialize from * @param ob An empty object to deserialize into (must not be null). * * @return serialized Avro object * * @throws IOException if deserialization failed */	TokenNameCOMMENT_JAVADOC	 Deserialize a single object based on the given Schema. * @param writer writer's schema @param bytes Array to deserialize from @param ob An empty object to deserialize into (must not be null). * @return serialized Avro object * @throws IOException if deserialization failed 
public	TokenNamepublic	
static	TokenNamestatic	
<	TokenNameLESS	
T	TokenNameIdentifier	 T
extends	TokenNameextends	
SpecificRecord	TokenNameIdentifier	 Specific Record
>	TokenNameGREATER	
T	TokenNameIdentifier	 T
deserializeAvro	TokenNameIdentifier	 deserialize Avro
(	TokenNameLPAREN	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
avro	TokenNameIdentifier	 avro
.	TokenNameDOT	
Schema	TokenNameIdentifier	 Schema
writer	TokenNameIdentifier	 writer
,	TokenNameCOMMA	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
bytes	TokenNameIdentifier	 bytes
,	TokenNameCOMMA	
T	TokenNameIdentifier	 T
ob	TokenNameIdentifier	 ob
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
BinaryDecoder	TokenNameIdentifier	 Binary Decoder
dec	TokenNameIdentifier	 dec
=	TokenNameEQUAL	
DIRECT_DECODERS	TokenNameIdentifier	 DIRECT  DECODERS
.	TokenNameDOT	
createBinaryDecoder	TokenNameIdentifier	 create Binary Decoder
(	TokenNameLPAREN	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
getArray	TokenNameIdentifier	 get Array
(	TokenNameLPAREN	
bytes	TokenNameIdentifier	 bytes
)	TokenNameRPAREN	
,	TokenNameCOMMA	
null	TokenNamenull	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
SpecificDatumReader	TokenNameIdentifier	 Specific Datum Reader
<	TokenNameLESS	
T	TokenNameIdentifier	 T
>	TokenNameGREATER	
reader	TokenNameIdentifier	 reader
=	TokenNameEQUAL	
new	TokenNamenew	
SpecificDatumReader	TokenNameIdentifier	 Specific Datum Reader
<	TokenNameLESS	
T	TokenNameIdentifier	 T
>	TokenNameGREATER	
(	TokenNameLPAREN	
writer	TokenNameIdentifier	 writer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
reader	TokenNameIdentifier	 reader
.	TokenNameDOT	
setExpected	TokenNameIdentifier	 set Expected
(	TokenNameLPAREN	
ob	TokenNameIdentifier	 ob
.	TokenNameDOT	
getSchema	TokenNameIdentifier	 get Schema
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
reader	TokenNameIdentifier	 reader
.	TokenNameDOT	
read	TokenNameIdentifier	 read
(	TokenNameLPAREN	
ob	TokenNameIdentifier	 ob
,	TokenNameCOMMA	
dec	TokenNameIdentifier	 dec
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
