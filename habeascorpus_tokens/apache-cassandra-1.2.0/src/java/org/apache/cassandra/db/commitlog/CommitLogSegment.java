/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
commitlog	TokenNameIdentifier	 commitlog
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
File	TokenNameIdentifier	 File
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
IOException	TokenNameIdentifier	 IO Exception
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
RandomAccessFile	TokenNameIdentifier	 Random Access File
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
MappedByteBuffer	TokenNameIdentifier	 Mapped Byte Buffer
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
FileChannel	TokenNameIdentifier	 File Channel
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Collection	TokenNameIdentifier	 Collection
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Comparator	TokenNameIdentifier	 Comparator
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
HashMap	TokenNameIdentifier	 Hash Map
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
UUID	TokenNameIdentifier	 UUID
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
concurrent	TokenNameIdentifier	 concurrent
.	TokenNameDOT	
atomic	TokenNameIdentifier	 atomic
.	TokenNameDOT	
AtomicInteger	TokenNameIdentifier	 Atomic Integer
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
zip	TokenNameIdentifier	 zip
.	TokenNameDOT	
Checksum	TokenNameIdentifier	 Checksum
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
CFMetaData	TokenNameIdentifier	 CF Meta Data
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
Schema	TokenNameIdentifier	 Schema
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
ColumnFamily	TokenNameIdentifier	 Column Family
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
db	TokenNameIdentifier	 db
.	TokenNameDOT	
RowMutation	TokenNameIdentifier	 Row Mutation
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
FSWriteError	TokenNameIdentifier	 FS Write Error
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
FileUtils	TokenNameIdentifier	 File Utils
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
MessagingService	TokenNameIdentifier	 Messaging Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
PureJavaCrc32	TokenNameIdentifier	 Pure Java Crc32
;	TokenNameSEMICOLON	
/* * A single commit log file on disk. Manages creation of the file and writing row mutations to disk, * as well as tracking the last mutation position of any "dirty" CFs covered by the segment file. Segment * files are initially allocated to a fixed size and can grow to accomidate a larger value if necessary. */	TokenNameCOMMENT_BLOCK	 A single commit log file on disk. Manages creation of the file and writing row mutations to disk, as well as tracking the last mutation position of any "dirty" CFs covered by the segment file. Segment files are initially allocated to a fixed size and can grow to accomidate a larger value if necessary. 
public	TokenNamepublic	
class	TokenNameclass	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
{	TokenNameLBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
static	TokenNamestatic	
long	TokenNamelong	
idBase	TokenNameIdentifier	 id Base
=	TokenNameEQUAL	
System	TokenNameIdentifier	 System
.	TokenNameDOT	
currentTimeMillis	TokenNameIdentifier	 current Time Millis
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
static	TokenNamestatic	
AtomicInteger	TokenNameIdentifier	 Atomic Integer
nextId	TokenNameIdentifier	 next Id
=	TokenNameEQUAL	
new	TokenNamenew	
AtomicInteger	TokenNameIdentifier	 Atomic Integer
(	TokenNameLPAREN	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// The commit log entry overhead in bytes (int: length + long: head checksum + long: tail checksum) 	TokenNameCOMMENT_LINE	The commit log entry overhead in bytes (int: length + long: head checksum + long: tail checksum) 
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
ENTRY_OVERHEAD_SIZE	TokenNameIdentifier	 ENTRY  OVERHEAD  SIZE
=	TokenNameEQUAL	
4	TokenNameIntegerLiteral	
+	TokenNamePLUS	
8	TokenNameIntegerLiteral	
+	TokenNamePLUS	
8	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// cache which cf is dirty in this segment to avoid having to lookup all ReplayPositions to decide if we can delete this segment 	TokenNameCOMMENT_LINE	cache which cf is dirty in this segment to avoid having to lookup all ReplayPositions to decide if we can delete this segment 
private	TokenNameprivate	
final	TokenNamefinal	
HashMap	TokenNameIdentifier	 Hash Map
<	TokenNameLESS	
UUID	TokenNameIdentifier	 UUID
,	TokenNameCOMMA	
Integer	TokenNameIdentifier	 Integer
>	TokenNameGREATER	
cfLastWrite	TokenNameIdentifier	 cf Last Write
=	TokenNameEQUAL	
new	TokenNamenew	
HashMap	TokenNameIdentifier	 Hash Map
<	TokenNameLESS	
UUID	TokenNameIdentifier	 UUID
,	TokenNameCOMMA	
Integer	TokenNameIdentifier	 Integer
>	TokenNameGREATER	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
long	TokenNamelong	
id	TokenNameIdentifier	 id
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
File	TokenNameIdentifier	 File
logFile	TokenNameIdentifier	 log File
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
RandomAccessFile	TokenNameIdentifier	 Random Access File
logFileAccessor	TokenNameIdentifier	 log File Accessor
;	TokenNameSEMICOLON	
private	TokenNameprivate	
boolean	TokenNameboolean	
needsSync	TokenNameIdentifier	 needs Sync
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
MappedByteBuffer	TokenNameIdentifier	 Mapped Byte Buffer
buffer	TokenNameIdentifier	 buffer
;	TokenNameSEMICOLON	
private	TokenNameprivate	
boolean	TokenNameboolean	
closed	TokenNameIdentifier	 closed
;	TokenNameSEMICOLON	
public	TokenNamepublic	
final	TokenNamefinal	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
descriptor	TokenNameIdentifier	 descriptor
;	TokenNameSEMICOLON	
/** * @return a newly minted segment file */	TokenNameCOMMENT_JAVADOC	 @return a newly minted segment file 
public	TokenNamepublic	
static	TokenNamestatic	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
freshSegment	TokenNameIdentifier	 fresh Segment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
(	TokenNameLPAREN	
null	TokenNamenull	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
long	TokenNamelong	
getNextId	TokenNameIdentifier	 get Next Id
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
idBase	TokenNameIdentifier	 id Base
+	TokenNamePLUS	
nextId	TokenNameIdentifier	 next Id
.	TokenNameDOT	
getAndIncrement	TokenNameIdentifier	 get And Increment
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Constructs a new segment file. * * @param filePath if not null, recycles the existing file by renaming it and truncating it to CommitLog.SEGMENT_SIZE. */	TokenNameCOMMENT_JAVADOC	 Constructs a new segment file. * @param filePath if not null, recycles the existing file by renaming it and truncating it to CommitLog.SEGMENT_SIZE. 
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
(	TokenNameLPAREN	
String	TokenNameIdentifier	 String
filePath	TokenNameIdentifier	 file Path
)	TokenNameRPAREN	
{	TokenNameLBRACE	
id	TokenNameIdentifier	 id
=	TokenNameEQUAL	
getNextId	TokenNameIdentifier	 get Next Id
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
descriptor	TokenNameIdentifier	 descriptor
=	TokenNameEQUAL	
new	TokenNamenew	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
(	TokenNameLPAREN	
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logFile	TokenNameIdentifier	 log File
=	TokenNameEQUAL	
new	TokenNamenew	
File	TokenNameIdentifier	 File
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogLocation	TokenNameIdentifier	 get Commit Log Location
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
descriptor	TokenNameIdentifier	 descriptor
.	TokenNameDOT	
fileName	TokenNameIdentifier	 file Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
boolean	TokenNameboolean	
isCreating	TokenNameIdentifier	 is Creating
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
filePath	TokenNameIdentifier	 file Path
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
File	TokenNameIdentifier	 File
oldFile	TokenNameIdentifier	 old File
=	TokenNameEQUAL	
new	TokenNamenew	
File	TokenNameIdentifier	 File
(	TokenNameLPAREN	
filePath	TokenNameIdentifier	 file Path
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
oldFile	TokenNameIdentifier	 old File
.	TokenNameDOT	
exists	TokenNameIdentifier	 exists
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Re-using discarded CommitLog segment for {} from {}"	TokenNameStringLiteral	Re-using discarded CommitLog segment for {} from {}
,	TokenNameCOMMA	
id	TokenNameIdentifier	 id
,	TokenNameCOMMA	
filePath	TokenNameIdentifier	 file Path
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
!	TokenNameNOT	
oldFile	TokenNameIdentifier	 old File
.	TokenNameDOT	
renameTo	TokenNameIdentifier	 rename To
(	TokenNameLPAREN	
logFile	TokenNameIdentifier	 log File
)	TokenNameRPAREN	
)	TokenNameRPAREN	
throw	TokenNamethrow	
new	TokenNamenew	
IOException	TokenNameIdentifier	 IO Exception
(	TokenNameLPAREN	
"Rename from "	TokenNameStringLiteral	Rename from 
+	TokenNamePLUS	
filePath	TokenNameIdentifier	 file Path
+	TokenNamePLUS	
" to "	TokenNameStringLiteral	 to 
+	TokenNamePLUS	
id	TokenNameIdentifier	 id
+	TokenNamePLUS	
" failed"	TokenNameStringLiteral	 failed
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
isCreating	TokenNameIdentifier	 is Creating
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// Open the initial the segment file 	TokenNameCOMMENT_LINE	Open the initial the segment file 
logFileAccessor	TokenNameIdentifier	 log File Accessor
=	TokenNameEQUAL	
new	TokenNamenew	
RandomAccessFile	TokenNameIdentifier	 Random Access File
(	TokenNameLPAREN	
logFile	TokenNameIdentifier	 log File
,	TokenNameCOMMA	
"rw"	TokenNameStringLiteral	rw
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
isCreating	TokenNameIdentifier	 is Creating
)	TokenNameRPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Creating new commit log segment {}"	TokenNameStringLiteral	Creating new commit log segment {}
,	TokenNameCOMMA	
logFile	TokenNameIdentifier	 log File
.	TokenNameDOT	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Map the segment, extending or truncating it to the standard segment size 	TokenNameCOMMENT_LINE	Map the segment, extending or truncating it to the standard segment size 
logFileAccessor	TokenNameIdentifier	 log File Accessor
.	TokenNameDOT	
setLength	TokenNameIdentifier	 set Length
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
=	TokenNameEQUAL	
logFileAccessor	TokenNameIdentifier	 log File Accessor
.	TokenNameDOT	
getChannel	TokenNameIdentifier	 get Channel
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
map	TokenNameIdentifier	 map
(	TokenNameLPAREN	
FileChannel	TokenNameIdentifier	 File Channel
.	TokenNameDOT	
MapMode	TokenNameIdentifier	 Map Mode
.	TokenNameDOT	
READ_WRITE	TokenNameIdentifier	 READ  WRITE
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getCommitLogSegmentSize	TokenNameIdentifier	 get Commit Log Segment Size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putInt	TokenNameIdentifier	 put Int
(	TokenNameLPAREN	
CommitLog	TokenNameIdentifier	 Commit Log
.	TokenNameDOT	
END_OF_SEGMENT_MARKER	TokenNameIdentifier	 END  OF  SEGMENT  MARKER
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
needsSync	TokenNameIdentifier	 needs Sync
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
FSWriteError	TokenNameIdentifier	 FS Write Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
,	TokenNameCOMMA	
logFile	TokenNameIdentifier	 log File
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Completely discards a segment file by deleting it. (Potentially blocking operation) */	TokenNameCOMMENT_JAVADOC	 Completely discards a segment file by deleting it. (Potentially blocking operation) 
public	TokenNamepublic	
void	TokenNamevoid	
discard	TokenNameIdentifier	 discard
(	TokenNameLPAREN	
boolean	TokenNameboolean	
deleteFile	TokenNameIdentifier	 delete File
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// TODO shouldn't we close the file when we're done writing to it, which comes (potentially) much earlier than it's eligible for recyling? 	TokenNameCOMMENT_LINE	TODO shouldn't we close the file when we're done writing to it, which comes (potentially) much earlier than it's eligible for recyling? 
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
deleteFile	TokenNameIdentifier	 delete File
)	TokenNameRPAREN	
FileUtils	TokenNameIdentifier	 File Utils
.	TokenNameDOT	
deleteWithConfirm	TokenNameIdentifier	 delete With Confirm
(	TokenNameLPAREN	
logFile	TokenNameIdentifier	 log File
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Recycle processes an unneeded segment file for reuse. * * @return a new CommitLogSegment representing the newly reusable segment. */	TokenNameCOMMENT_JAVADOC	 Recycle processes an unneeded segment file for reuse. * @return a new CommitLogSegment representing the newly reusable segment. 
public	TokenNamepublic	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
recycle	TokenNameIdentifier	 recycle
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// writes an end-of-segment marker at the very beginning of the file and closes it 	TokenNameCOMMENT_LINE	writes an end-of-segment marker at the very beginning of the file and closes it 
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putInt	TokenNameIdentifier	 put Int
(	TokenNameLPAREN	
CommitLog	TokenNameIdentifier	 Commit Log
.	TokenNameDOT	
END_OF_SEGMENT_MARKER	TokenNameIdentifier	 END  OF  SEGMENT  MARKER
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
sync	TokenNameIdentifier	 sync
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
FSWriteError	TokenNameIdentifier	 FS Write Error
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
"I/O error flushing "	TokenNameStringLiteral	I/O error flushing 
+	TokenNamePLUS	
this	TokenNamethis	
+	TokenNamePLUS	
" "	TokenNameStringLiteral	 
+	TokenNamePLUS	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throw	TokenNamethrow	
e	TokenNameIdentifier	 e
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
new	TokenNamenew	
CommitLogSegment	TokenNameIdentifier	 Commit Log Segment
(	TokenNameLPAREN	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return true if there is room to write() @param mutation to this segment */	TokenNameCOMMENT_JAVADOC	 @return true if there is room to write() @param mutation to this segment 
public	TokenNamepublic	
boolean	TokenNameboolean	
hasCapacityFor	TokenNameIdentifier	 has Capacity For
(	TokenNameLPAREN	
RowMutation	TokenNameIdentifier	 Row Mutation
mutation	TokenNameIdentifier	 mutation
)	TokenNameRPAREN	
{	TokenNameLBRACE	
long	TokenNamelong	
totalSize	TokenNameIdentifier	 total Size
=	TokenNameEQUAL	
RowMutation	TokenNameIdentifier	 Row Mutation
.	TokenNameDOT	
serializer	TokenNameIdentifier	 serializer
.	TokenNameDOT	
serializedSize	TokenNameIdentifier	 serialized Size
(	TokenNameLPAREN	
mutation	TokenNameIdentifier	 mutation
,	TokenNameCOMMA	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
current_version	TokenNameIdentifier	 current version
)	TokenNameRPAREN	
+	TokenNamePLUS	
ENTRY_OVERHEAD_SIZE	TokenNameIdentifier	 ENTRY  OVERHEAD  SIZE
;	TokenNameSEMICOLON	
return	TokenNamereturn	
totalSize	TokenNameIdentifier	 total Size
<=	TokenNameLESS_EQUAL	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
remaining	TokenNameIdentifier	 remaining
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * mark all of the column families we're modifying as dirty at this position */	TokenNameCOMMENT_JAVADOC	 mark all of the column families we're modifying as dirty at this position 
private	TokenNameprivate	
void	TokenNamevoid	
markDirty	TokenNameIdentifier	 mark Dirty
(	TokenNameLPAREN	
RowMutation	TokenNameIdentifier	 Row Mutation
rowMutation	TokenNameIdentifier	 row Mutation
,	TokenNameCOMMA	
ReplayPosition	TokenNameIdentifier	 Replay Position
repPos	TokenNameIdentifier	 rep Pos
)	TokenNameRPAREN	
{	TokenNameLBRACE	
for	TokenNamefor	
(	TokenNameLPAREN	
ColumnFamily	TokenNameIdentifier	 Column Family
columnFamily	TokenNameIdentifier	 column Family
:	TokenNameCOLON	
rowMutation	TokenNameIdentifier	 row Mutation
.	TokenNameDOT	
getColumnFamilies	TokenNameIdentifier	 get Column Families
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// check for null cfm in case a cl write goes through after the cf is 	TokenNameCOMMENT_LINE	check for null cfm in case a cl write goes through after the cf is 
// defined but before a new segment is created. 	TokenNameCOMMENT_LINE	defined but before a new segment is created. 
CFMetaData	TokenNameIdentifier	 CF Meta Data
cfm	TokenNameIdentifier	 cfm
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getCFMetaData	TokenNameIdentifier	 get CF Meta Data
(	TokenNameLPAREN	
columnFamily	TokenNameIdentifier	 column Family
.	TokenNameDOT	
id	TokenNameIdentifier	 id
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
error	TokenNameIdentifier	 error
(	TokenNameLPAREN	
"Attempted to write commit log entry for unrecognized column family: "	TokenNameStringLiteral	Attempted to write commit log entry for unrecognized column family: 
+	TokenNamePLUS	
columnFamily	TokenNameIdentifier	 column Family
.	TokenNameDOT	
id	TokenNameIdentifier	 id
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
markCFDirty	TokenNameIdentifier	 mark CF Dirty
(	TokenNameLPAREN	
cfm	TokenNameIdentifier	 cfm
.	TokenNameDOT	
cfId	TokenNameIdentifier	 cf Id
,	TokenNameCOMMA	
repPos	TokenNameIdentifier	 rep Pos
.	TokenNameDOT	
position	TokenNameIdentifier	 position
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Appends a row mutation onto the commit log. Requres that hasCapacityFor has already been checked. * * @param rowMutation the mutation to append to the commit log. * @return the position of the appended mutation */	TokenNameCOMMENT_JAVADOC	 Appends a row mutation onto the commit log. Requres that hasCapacityFor has already been checked. * @param rowMutation the mutation to append to the commit log. @return the position of the appended mutation 
public	TokenNamepublic	
ReplayPosition	TokenNameIdentifier	 Replay Position
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
RowMutation	TokenNameIdentifier	 Row Mutation
rowMutation	TokenNameIdentifier	 row Mutation
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
assert	TokenNameassert	
!	TokenNameNOT	
closed	TokenNameIdentifier	 closed
;	TokenNameSEMICOLON	
ReplayPosition	TokenNameIdentifier	 Replay Position
repPos	TokenNameIdentifier	 rep Pos
=	TokenNameEQUAL	
getContext	TokenNameIdentifier	 get Context
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
markDirty	TokenNameIdentifier	 mark Dirty
(	TokenNameLPAREN	
rowMutation	TokenNameIdentifier	 row Mutation
,	TokenNameCOMMA	
repPos	TokenNameIdentifier	 rep Pos
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Checksum	TokenNameIdentifier	 Checksum
checksum	TokenNameIdentifier	 checksum
=	TokenNameEQUAL	
new	TokenNamenew	
PureJavaCrc32	TokenNameIdentifier	 Pure Java Crc32
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
serializedRow	TokenNameIdentifier	 serialized Row
=	TokenNameEQUAL	
rowMutation	TokenNameIdentifier	 row Mutation
.	TokenNameDOT	
getSerializedBuffer	TokenNameIdentifier	 get Serialized Buffer
(	TokenNameLPAREN	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
current_version	TokenNameIdentifier	 current version
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
checksum	TokenNameIdentifier	 checksum
.	TokenNameDOT	
update	TokenNameIdentifier	 update
(	TokenNameLPAREN	
serializedRow	TokenNameIdentifier	 serialized Row
.	TokenNameDOT	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putInt	TokenNameIdentifier	 put Int
(	TokenNameLPAREN	
serializedRow	TokenNameIdentifier	 serialized Row
.	TokenNameDOT	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putLong	TokenNameIdentifier	 put Long
(	TokenNameLPAREN	
checksum	TokenNameIdentifier	 checksum
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
serializedRow	TokenNameIdentifier	 serialized Row
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
checksum	TokenNameIdentifier	 checksum
.	TokenNameDOT	
update	TokenNameIdentifier	 update
(	TokenNameLPAREN	
serializedRow	TokenNameIdentifier	 serialized Row
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
serializedRow	TokenNameIdentifier	 serialized Row
.	TokenNameDOT	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putLong	TokenNameIdentifier	 put Long
(	TokenNameLPAREN	
checksum	TokenNameIdentifier	 checksum
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
remaining	TokenNameIdentifier	 remaining
(	TokenNameLPAREN	
)	TokenNameRPAREN	
>=	TokenNameGREATER_EQUAL	
4	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// writes end of segment marker and rewinds back to position where it starts 	TokenNameCOMMENT_LINE	writes end of segment marker and rewinds back to position where it starts 
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
putInt	TokenNameIdentifier	 put Int
(	TokenNameLPAREN	
CommitLog	TokenNameIdentifier	 Commit Log
.	TokenNameDOT	
END_OF_SEGMENT_MARKER	TokenNameIdentifier	 END  OF  SEGMENT  MARKER
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
)	TokenNameRPAREN	
-	TokenNameMINUS	
CommitLog	TokenNameIdentifier	 Commit Log
.	TokenNameDOT	
END_OF_SEGMENT_MARKER_SIZE	TokenNameIdentifier	 END  OF  SEGMENT  MARKER  SIZE
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
needsSync	TokenNameIdentifier	 needs Sync
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
repPos	TokenNameIdentifier	 rep Pos
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Forces a disk flush for this segment file. */	TokenNameCOMMENT_JAVADOC	 Forces a disk flush for this segment file. 
public	TokenNamepublic	
void	TokenNamevoid	
sync	TokenNameIdentifier	 sync
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
needsSync	TokenNameIdentifier	 needs Sync
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
force	TokenNameIdentifier	 force
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
Exception	TokenNameIdentifier	 Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
// MappedByteBuffer.force() does not declare IOException but can actually throw it 	TokenNameCOMMENT_LINE	MappedByteBuffer.force() does not declare IOException but can actually throw it 
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
FSWriteError	TokenNameIdentifier	 FS Write Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
,	TokenNameCOMMA	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
needsSync	TokenNameIdentifier	 needs Sync
=	TokenNameEQUAL	
false	TokenNamefalse	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * @return the current ReplayPosition for this log segment */	TokenNameCOMMENT_JAVADOC	 @return the current ReplayPosition for this log segment 
public	TokenNamepublic	
ReplayPosition	TokenNameIdentifier	 Replay Position
getContext	TokenNameIdentifier	 get Context
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
new	TokenNamenew	
ReplayPosition	TokenNameIdentifier	 Replay Position
(	TokenNameLPAREN	
id	TokenNameIdentifier	 id
,	TokenNameCOMMA	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return the file path to this segment */	TokenNameCOMMENT_JAVADOC	 @return the file path to this segment 
public	TokenNamepublic	
String	TokenNameIdentifier	 String
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
logFile	TokenNameIdentifier	 log File
.	TokenNameDOT	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return the file name of this segment */	TokenNameCOMMENT_JAVADOC	 @return the file name of this segment 
public	TokenNamepublic	
String	TokenNameIdentifier	 String
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
logFile	TokenNameIdentifier	 log File
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Close the segment file. */	TokenNameCOMMENT_JAVADOC	 Close the segment file. 
public	TokenNamepublic	
void	TokenNamevoid	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
closed	TokenNameIdentifier	 closed
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
FileUtils	TokenNameIdentifier	 File Utils
.	TokenNameDOT	
clean	TokenNameIdentifier	 clean
(	TokenNameLPAREN	
buffer	TokenNameIdentifier	 buffer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logFileAccessor	TokenNameIdentifier	 log File Accessor
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
closed	TokenNameIdentifier	 closed
=	TokenNameEQUAL	
true	TokenNametrue	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
FSWriteError	TokenNameIdentifier	 FS Write Error
(	TokenNameLPAREN	
e	TokenNameIdentifier	 e
,	TokenNameCOMMA	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Records the CF as dirty at a certain position. * * @param cfId the column family ID that is now dirty * @param position the position the last write for this CF was written at */	TokenNameCOMMENT_JAVADOC	 Records the CF as dirty at a certain position. * @param cfId the column family ID that is now dirty @param position the position the last write for this CF was written at 
private	TokenNameprivate	
void	TokenNamevoid	
markCFDirty	TokenNameIdentifier	 mark CF Dirty
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
cfId	TokenNameIdentifier	 cf Id
,	TokenNameCOMMA	
Integer	TokenNameIdentifier	 Integer
position	TokenNameIdentifier	 position
)	TokenNameRPAREN	
{	TokenNameLBRACE	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
put	TokenNameIdentifier	 put
(	TokenNameLPAREN	
cfId	TokenNameIdentifier	 cf Id
,	TokenNameCOMMA	
position	TokenNameIdentifier	 position
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Marks the ColumnFamily specified by cfId as clean for this log segment. If the * given context argument is contained in this file, it will only mark the CF as * clean if no newer writes have taken place. * * @param cfId the column family ID that is now clean * @param context the optional clean offset */	TokenNameCOMMENT_JAVADOC	 Marks the ColumnFamily specified by cfId as clean for this log segment. If the given context argument is contained in this file, it will only mark the CF as clean if no newer writes have taken place. * @param cfId the column family ID that is now clean @param context the optional clean offset 
public	TokenNamepublic	
void	TokenNamevoid	
markClean	TokenNameIdentifier	 mark Clean
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
cfId	TokenNameIdentifier	 cf Id
,	TokenNameCOMMA	
ReplayPosition	TokenNameIdentifier	 Replay Position
context	TokenNameIdentifier	 context
)	TokenNameRPAREN	
{	TokenNameLBRACE	
Integer	TokenNameIdentifier	 Integer
lastWritten	TokenNameIdentifier	 last Written
=	TokenNameEQUAL	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
lastWritten	TokenNameIdentifier	 last Written
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
&&	TokenNameAND_AND	
(	TokenNameLPAREN	
!	TokenNameNOT	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
context	TokenNameIdentifier	 context
)	TokenNameRPAREN	
||	TokenNameOR_OR	
lastWritten	TokenNameIdentifier	 last Written
<	TokenNameLESS	
context	TokenNameIdentifier	 context
.	TokenNameDOT	
position	TokenNameIdentifier	 position
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
remove	TokenNameIdentifier	 remove
(	TokenNameLPAREN	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * @return a collection of dirty CFIDs for this segment file. */	TokenNameCOMMENT_JAVADOC	 @return a collection of dirty CFIDs for this segment file. 
public	TokenNamepublic	
Collection	TokenNameIdentifier	 Collection
<	TokenNameLESS	
UUID	TokenNameIdentifier	 UUID
>	TokenNameGREATER	
getDirtyCFIDs	TokenNameIdentifier	 get Dirty CFI Ds
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
keySet	TokenNameIdentifier	 key Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * @return true if this segment is unused and safe to recycle or delete */	TokenNameCOMMENT_JAVADOC	 @return true if this segment is unused and safe to recycle or delete 
public	TokenNamepublic	
boolean	TokenNameboolean	
isUnused	TokenNameIdentifier	 is Unused
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
isEmpty	TokenNameIdentifier	 is Empty
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Check to see if a certain ReplayPosition is contained by this segment file. * * @param context the replay position to be checked * @return true if the replay position is contained by this segment file. */	TokenNameCOMMENT_JAVADOC	 Check to see if a certain ReplayPosition is contained by this segment file. * @param context the replay position to be checked @return true if the replay position is contained by this segment file. 
public	TokenNamepublic	
boolean	TokenNameboolean	
contains	TokenNameIdentifier	 contains
(	TokenNameLPAREN	
ReplayPosition	TokenNameIdentifier	 Replay Position
context	TokenNameIdentifier	 context
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
context	TokenNameIdentifier	 context
.	TokenNameDOT	
segment	TokenNameIdentifier	 segment
==	TokenNameEQUAL_EQUAL	
id	TokenNameIdentifier	 id
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// For debugging, not fast 	TokenNameCOMMENT_LINE	For debugging, not fast 
public	TokenNamepublic	
String	TokenNameIdentifier	 String
dirtyString	TokenNameIdentifier	 dirty String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
StringBuilder	TokenNameIdentifier	 String Builder
sb	TokenNameIdentifier	 sb
=	TokenNameEQUAL	
new	TokenNamenew	
StringBuilder	TokenNameIdentifier	 String Builder
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
UUID	TokenNameIdentifier	 UUID
cfId	TokenNameIdentifier	 cf Id
:	TokenNameCOLON	
cfLastWrite	TokenNameIdentifier	 cf Last Write
.	TokenNameDOT	
keySet	TokenNameIdentifier	 key Set
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CFMetaData	TokenNameIdentifier	 CF Meta Data
m	TokenNameIdentifier	 m
=	TokenNameEQUAL	
Schema	TokenNameIdentifier	 Schema
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
.	TokenNameDOT	
getCFMetaData	TokenNameIdentifier	 get CF Meta Data
(	TokenNameLPAREN	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
sb	TokenNameIdentifier	 sb
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
m	TokenNameIdentifier	 m
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
?	TokenNameQUESTION	
"<deleted>"	TokenNameStringLiteral	<deleted>
:	TokenNameCOLON	
m	TokenNameIdentifier	 m
.	TokenNameDOT	
cfName	TokenNameIdentifier	 cf Name
)	TokenNameRPAREN	
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
" ("	TokenNameStringLiteral	 (
)	TokenNameRPAREN	
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
cfId	TokenNameIdentifier	 cf Id
)	TokenNameRPAREN	
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
"), "	TokenNameStringLiteral	), 
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
return	TokenNamereturn	
sb	TokenNameIdentifier	 sb
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
@	TokenNameAT	
Override	TokenNameIdentifier	 Override
public	TokenNamepublic	
String	TokenNameIdentifier	 String
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
"CommitLogSegment("	TokenNameStringLiteral	CommitLogSegment(
+	TokenNamePLUS	
getPath	TokenNameIdentifier	 get Path
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
')'	TokenNameCharacterLiteral	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
int	TokenNameint	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
buffer	TokenNameIdentifier	 buffer
.	TokenNameDOT	
position	TokenNameIdentifier	 position
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
static	TokenNamestatic	
class	TokenNameclass	
CommitLogSegmentFileComparator	TokenNameIdentifier	 Commit Log Segment File Comparator
implements	TokenNameimplements	
Comparator	TokenNameIdentifier	 Comparator
<	TokenNameLESS	
File	TokenNameIdentifier	 File
>	TokenNameGREATER	
{	TokenNameLBRACE	
public	TokenNamepublic	
int	TokenNameint	
compare	TokenNameIdentifier	 compare
(	TokenNameLPAREN	
File	TokenNameIdentifier	 File
f	TokenNameIdentifier	 f
,	TokenNameCOMMA	
File	TokenNameIdentifier	 File
f2	TokenNameIdentifier	 f2
)	TokenNameRPAREN	
{	TokenNameLBRACE	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
desc	TokenNameIdentifier	 desc
=	TokenNameEQUAL	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
.	TokenNameDOT	
fromFileName	TokenNameIdentifier	 from File Name
(	TokenNameLPAREN	
f	TokenNameIdentifier	 f
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
desc2	TokenNameIdentifier	 desc2
=	TokenNameEQUAL	
CommitLogDescriptor	TokenNameIdentifier	 Commit Log Descriptor
.	TokenNameDOT	
fromFileName	TokenNameIdentifier	 from File Name
(	TokenNameLPAREN	
f2	TokenNameIdentifier	 f2
.	TokenNameDOT	
getName	TokenNameIdentifier	 get Name
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
(	TokenNameLPAREN	
int	TokenNameint	
)	TokenNameRPAREN	
(	TokenNameLPAREN	
desc	TokenNameIdentifier	 desc
.	TokenNameDOT	
id	TokenNameIdentifier	 id
-	TokenNameMINUS	
desc2	TokenNameIdentifier	 desc2
.	TokenNameDOT	
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
