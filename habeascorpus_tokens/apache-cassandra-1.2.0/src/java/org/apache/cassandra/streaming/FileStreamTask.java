/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
streaming	TokenNameIdentifier	 streaming
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
InetAddress	TokenNameIdentifier	 Inet Address
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
Socket	TokenNameIdentifier	 Socket
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
com	TokenNameIdentifier	 com
.	TokenNameDOT	
ning	TokenNameIdentifier	 ning
.	TokenNameDOT	
compress	TokenNameIdentifier	 compress
.	TokenNameDOT	
lzf	TokenNameIdentifier	 lzf
.	TokenNameDOT	
LZFOutputStream	TokenNameIdentifier	 LZF Output Stream
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
config	TokenNameIdentifier	 config
.	TokenNameDOT	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
FileUtils	TokenNameIdentifier	 File Utils
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
metrics	TokenNameIdentifier	 metrics
.	TokenNameDOT	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
MessageIn	TokenNameIdentifier	 Message In
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
MessagingService	TokenNameIdentifier	 Messaging Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
Pair	TokenNameIdentifier	 Pair
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
Throttle	TokenNameIdentifier	 Throttle
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
WrappedRunnable	TokenNameIdentifier	 Wrapped Runnable
;	TokenNameSEMICOLON	
public	TokenNamepublic	
class	TokenNameclass	
FileStreamTask	TokenNameIdentifier	 File Stream Task
extends	TokenNameextends	
WrappedRunnable	TokenNameIdentifier	 Wrapped Runnable
{	TokenNameLBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
FileStreamTask	TokenNameIdentifier	 File Stream Task
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
=	TokenNameEQUAL	
64	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
MAX_CONNECT_ATTEMPTS	TokenNameIdentifier	 MAX  CONNECT  ATTEMPTS
=	TokenNameEQUAL	
4	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
protected	TokenNameprotected	
final	TokenNamefinal	
StreamHeader	TokenNameIdentifier	 Stream Header
header	TokenNameIdentifier	 header
;	TokenNameSEMICOLON	
protected	TokenNameprotected	
final	TokenNamefinal	
InetAddress	TokenNameIdentifier	 Inet Address
to	TokenNameIdentifier	 to
;	TokenNameSEMICOLON	
// communication socket 	TokenNameCOMMENT_LINE	communication socket 
protected	TokenNameprotected	
Socket	TokenNameIdentifier	 Socket
socket	TokenNameIdentifier	 socket
;	TokenNameSEMICOLON	
// socket's output/input stream 	TokenNameCOMMENT_LINE	socket's output/input stream 
private	TokenNameprivate	
OutputStream	TokenNameIdentifier	 Output Stream
output	TokenNameIdentifier	 output
;	TokenNameSEMICOLON	
private	TokenNameprivate	
OutputStream	TokenNameIdentifier	 Output Stream
compressedoutput	TokenNameIdentifier	 compressedoutput
;	TokenNameSEMICOLON	
private	TokenNameprivate	
DataInputStream	TokenNameIdentifier	 Data Input Stream
input	TokenNameIdentifier	 input
;	TokenNameSEMICOLON	
// allocate buffer to use for transfers only once 	TokenNameCOMMENT_LINE	allocate buffer to use for transfers only once 
private	TokenNameprivate	
final	TokenNamefinal	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
transferBuffer	TokenNameIdentifier	 transfer Buffer
=	TokenNameEQUAL	
new	TokenNamenew	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
]	TokenNameRBRACKET	
;	TokenNameSEMICOLON	
// outbound global throughput limiter 	TokenNameCOMMENT_LINE	outbound global throughput limiter 
protected	TokenNameprotected	
final	TokenNamefinal	
Throttle	TokenNameIdentifier	 Throttle
throttle	TokenNameIdentifier	 throttle
;	TokenNameSEMICOLON	
private	TokenNameprivate	
final	TokenNamefinal	
StreamReplyVerbHandler	TokenNameIdentifier	 Stream Reply Verb Handler
handler	TokenNameIdentifier	 handler
=	TokenNameEQUAL	
new	TokenNamenew	
StreamReplyVerbHandler	TokenNameIdentifier	 Stream Reply Verb Handler
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
protected	TokenNameprotected	
final	TokenNamefinal	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
metrics	TokenNameIdentifier	 metrics
;	TokenNameSEMICOLON	
public	TokenNamepublic	
FileStreamTask	TokenNameIdentifier	 File Stream Task
(	TokenNameLPAREN	
StreamHeader	TokenNameIdentifier	 Stream Header
header	TokenNameIdentifier	 header
,	TokenNameCOMMA	
InetAddress	TokenNameIdentifier	 Inet Address
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
{	TokenNameLBRACE	
this	TokenNamethis	
.	TokenNameDOT	
header	TokenNameIdentifier	 header
=	TokenNameEQUAL	
header	TokenNameIdentifier	 header
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
to	TokenNameIdentifier	 to
=	TokenNameEQUAL	
to	TokenNameIdentifier	 to
;	TokenNameSEMICOLON	
this	TokenNamethis	
.	TokenNameDOT	
throttle	TokenNameIdentifier	 throttle
=	TokenNameEQUAL	
new	TokenNamenew	
Throttle	TokenNameIdentifier	 Throttle
(	TokenNameLPAREN	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
new	TokenNamenew	
Throttle	TokenNameIdentifier	 Throttle
.	TokenNameDOT	
ThroughputFunction	TokenNameIdentifier	 Throughput Function
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
/** @return Instantaneous throughput target in bytes per millisecond. */	TokenNameCOMMENT_JAVADOC	 @return Instantaneous throughput target in bytes per millisecond. 
public	TokenNamepublic	
int	TokenNameint	
targetThroughput	TokenNameIdentifier	 target Throughput
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getStreamThroughputOutboundMegabitsPerSec	TokenNameIdentifier	 get Stream Throughput Outbound Megabits Per Sec
(	TokenNameLPAREN	
)	TokenNameRPAREN	
<	TokenNameLESS	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
// throttling disabled 	TokenNameCOMMENT_LINE	throttling disabled 
return	TokenNamereturn	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// total throughput 	TokenNameCOMMENT_LINE	total throughput 
int	TokenNameint	
totalBytesPerMS	TokenNameIdentifier	 total Bytes Per MS
=	TokenNameEQUAL	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getStreamThroughputOutboundMegabitsPerSec	TokenNameIdentifier	 get Stream Throughput Outbound Megabits Per Sec
(	TokenNameLPAREN	
)	TokenNameRPAREN	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
/	TokenNameDIVIDE	
8	TokenNameIntegerLiteral	
/	TokenNameDIVIDE	
1000	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// per stream throughput (target bytes per MS) 	TokenNameCOMMENT_LINE	per stream throughput (target bytes per MS) 
return	TokenNamereturn	
totalBytesPerMS	TokenNameIdentifier	 total Bytes Per MS
/	TokenNameDIVIDE	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
max	TokenNameIdentifier	 max
(	TokenNameLPAREN	
1	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
(	TokenNameLPAREN	
int	TokenNameint	
)	TokenNameRPAREN	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
activeStreamsOutbound	TokenNameIdentifier	 active Streams Outbound
.	TokenNameDOT	
count	TokenNameIdentifier	 count
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
metrics	TokenNameIdentifier	 metrics
=	TokenNameEQUAL	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
void	TokenNamevoid	
runMayThrow	TokenNameIdentifier	 run May Throw
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
connectAttempt	TokenNameIdentifier	 connect Attempt
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// successfully connected: stream. 	TokenNameCOMMENT_LINE	successfully connected: stream. 
// (at this point, if we fail, it is the receiver's job to re-request) 	TokenNameCOMMENT_LINE	(at this point, if we fail, it is the receiver's job to re-request) 
stream	TokenNameIdentifier	 stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
StreamOutSession	TokenNameIdentifier	 Stream Out Session
session	TokenNameIdentifier	 session
=	TokenNameEQUAL	
StreamOutSession	TokenNameIdentifier	 Stream Out Session
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
sessionId	TokenNameIdentifier	 session Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
"Found no stream out session at end of file stream task - this is expected if the receiver went down"	TokenNameStringLiteral	Found no stream out session at end of file stream task - this is expected if the receiver went down
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
getFiles	TokenNameIdentifier	 get Files
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
size	TokenNameIdentifier	 size
(	TokenNameLPAREN	
)	TokenNameRPAREN	
==	TokenNameEQUAL_EQUAL	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// we are the last of our kind, receive the final confirmation before closing 	TokenNameCOMMENT_LINE	we are the last of our kind, receive the final confirmation before closing 
receiveReply	TokenNameIdentifier	 receive Reply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
info	TokenNameIdentifier	 info
(	TokenNameLPAREN	
"Finished streaming session to {}"	TokenNameStringLiteral	Finished streaming session to {}
,	TokenNameCOMMA	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
StreamOutSession	TokenNameIdentifier	 Stream Out Session
session	TokenNameIdentifier	 session
=	TokenNameEQUAL	
StreamOutSession	TokenNameIdentifier	 Stream Out Session
.	TokenNameDOT	
get	TokenNameIdentifier	 get
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
sessionId	TokenNameIdentifier	 session Id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
session	TokenNameIdentifier	 session
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
session	TokenNameIdentifier	 session
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
false	TokenNamefalse	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throw	TokenNamethrow	
e	TokenNameIdentifier	 e
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
finally	TokenNamefinally	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
isDebugEnabled	TokenNameIdentifier	 is Debug Enabled
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"error closing socket"	TokenNameStringLiteral	error closing socket
,	TokenNameCOMMA	
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
isDebugEnabled	TokenNameIdentifier	 is Debug Enabled
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Done streaming "	TokenNameStringLiteral	Done streaming 
+	TokenNamePLUS	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Stream file by it's sections specified by this.header * @throws IOException on any I/O error */	TokenNameCOMMENT_JAVADOC	 Stream file by it's sections specified by this.header @throws IOException on any I/O error 
protected	TokenNameprotected	
void	TokenNamevoid	
stream	TokenNameIdentifier	 stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
headerBuffer	TokenNameIdentifier	 header Buffer
=	TokenNameEQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
constructStreamHeader	TokenNameIdentifier	 construct Stream Header
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
,	TokenNameCOMMA	
false	TokenNamefalse	
,	TokenNameCOMMA	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getVersion	TokenNameIdentifier	 get Version
(	TokenNameLPAREN	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// write header (this should not be compressed for compatibility with other messages) 	TokenNameCOMMENT_LINE	write header (this should not be compressed for compatibility with other messages) 
output	TokenNameIdentifier	 output
.	TokenNameDOT	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
getArray	TokenNameIdentifier	 get Array
(	TokenNameLPAREN	
headerBuffer	TokenNameIdentifier	 header Buffer
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
// try to skip kernel page cache if possible 	TokenNameCOMMENT_LINE	try to skip kernel page cache if possible 
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
file	TokenNameIdentifier	 file
=	TokenNameEQUAL	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
new	TokenNamenew	
File	TokenNameIdentifier	 File
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
getFilename	TokenNameIdentifier	 get Filename
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// setting up data compression stream 	TokenNameCOMMENT_LINE	setting up data compression stream 
compressedoutput	TokenNameIdentifier	 compressedoutput
=	TokenNameEQUAL	
new	TokenNamenew	
LZFOutputStream	TokenNameIdentifier	 LZF Output Stream
(	TokenNameLPAREN	
output	TokenNameIdentifier	 output
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
activeStreamsOutbound	TokenNameIdentifier	 active Streams Outbound
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
long	TokenNamelong	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// stream each of the required sections of the file 	TokenNameCOMMENT_LINE	stream each of the required sections of the file 
for	TokenNamefor	
(	TokenNameLPAREN	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>	TokenNameGREATER	
section	TokenNameIdentifier	 section
:	TokenNameCOLON	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
sections	TokenNameIdentifier	 sections
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// seek to the beginning of the section 	TokenNameCOMMENT_LINE	seek to the beginning of the section 
file	TokenNameIdentifier	 file
.	TokenNameDOT	
seek	TokenNameIdentifier	 seek
(	TokenNameLPAREN	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
left	TokenNameIdentifier	 left
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// length of the section to stream 	TokenNameCOMMENT_LINE	length of the section to stream 
long	TokenNamelong	
length	TokenNameIdentifier	 length
=	TokenNameEQUAL	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
right	TokenNameIdentifier	 right
-	TokenNameMINUS	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
left	TokenNameIdentifier	 left
;	TokenNameSEMICOLON	
// tracks write progress 	TokenNameCOMMENT_LINE	tracks write progress 
long	TokenNamelong	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
<	TokenNameLESS	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
{	TokenNameLBRACE	
long	TokenNamelong	
lastWrite	TokenNameIdentifier	 last Write
=	TokenNameEQUAL	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
,	TokenNameCOMMA	
length	TokenNameIdentifier	 length
,	TokenNameCOMMA	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
// store streaming progress 	TokenNameCOMMENT_LINE	store streaming progress 
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
progress	TokenNameIdentifier	 progress
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// make sure that current section is send 	TokenNameCOMMENT_LINE	make sure that current section is send 
compressedoutput	TokenNameIdentifier	 compressedoutput
.	TokenNameDOT	
flush	TokenNameIdentifier	 flush
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
isDebugEnabled	TokenNameIdentifier	 is Debug Enabled
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Bytes transferred "	TokenNameStringLiteral	Bytes transferred 
+	TokenNamePLUS	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
+	TokenNamePLUS	
"/"	TokenNameStringLiteral	/
+	TokenNamePLUS	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
size	TokenNameIdentifier	 size
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
totalOutgoingBytes	TokenNameIdentifier	 total Outgoing Bytes
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
metrics	TokenNameIdentifier	 metrics
.	TokenNameDOT	
outgoingBytes	TokenNameIdentifier	 outgoing Bytes
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// receive reply confirmation 	TokenNameCOMMENT_LINE	receive reply confirmation 
receiveReply	TokenNameIdentifier	 receive Reply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
finally	TokenNamefinally	
{	TokenNameLBRACE	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
activeStreamsOutbound	TokenNameIdentifier	 active Streams Outbound
.	TokenNameDOT	
dec	TokenNameIdentifier	 dec
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// no matter what happens close file 	TokenNameCOMMENT_LINE	no matter what happens close file 
FileUtils	TokenNameIdentifier	 File Utils
.	TokenNameDOT	
closeQuietly	TokenNameIdentifier	 close Quietly
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
protected	TokenNameprotected	
void	TokenNamevoid	
receiveReply	TokenNameIdentifier	 receive Reply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
validateMagic	TokenNameIdentifier	 validate Magic
(	TokenNameLPAREN	
input	TokenNameIdentifier	 input
.	TokenNameDOT	
readInt	TokenNameIdentifier	 read Int
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
String	TokenNameIdentifier	 String
id	TokenNameIdentifier	 id
=	TokenNameEQUAL	
input	TokenNameIdentifier	 input
.	TokenNameDOT	
readUTF	TokenNameIdentifier	 read UTF
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
input	TokenNameIdentifier	 input
.	TokenNameDOT	
readInt	TokenNameIdentifier	 read Int
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// skip timestamp 	TokenNameCOMMENT_LINE	skip timestamp 
// since we reject streaming with different version, using current_version here is fine 	TokenNameCOMMENT_LINE	since we reject streaming with different version, using current_version here is fine 
MessageIn	TokenNameIdentifier	 Message In
message	TokenNameIdentifier	 message
=	TokenNameEQUAL	
MessageIn	TokenNameIdentifier	 Message In
.	TokenNameDOT	
read	TokenNameIdentifier	 read
(	TokenNameLPAREN	
input	TokenNameIdentifier	 input
,	TokenNameCOMMA	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
current_version	TokenNameIdentifier	 current version
,	TokenNameCOMMA	
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
assert	TokenNameassert	
message	TokenNameIdentifier	 message
.	TokenNameDOT	
verb	TokenNameIdentifier	 verb
==	TokenNameEQUAL_EQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
Verb	TokenNameIdentifier	 Verb
.	TokenNameDOT	
STREAM_REPLY	TokenNameIdentifier	 STREAM  REPLY
:	TokenNameCOLON	
"Non-reply message received on stream socket"	TokenNameStringLiteral	Non-reply message received on stream socket
;	TokenNameSEMICOLON	
handler	TokenNameIdentifier	 handler
.	TokenNameDOT	
doVerb	TokenNameIdentifier	 do Verb
(	TokenNameLPAREN	
message	TokenNameIdentifier	 message
,	TokenNameCOMMA	
id	TokenNameIdentifier	 id
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Sequentially read bytes from the file and write them to the output stream * * @param reader The file reader to read from * @param length The full length that should be transferred * @param bytesTransferred Number of bytes remaining to transfer * * @return Number of bytes transferred * * @throws IOException on any I/O error */	TokenNameCOMMENT_JAVADOC	 Sequentially read bytes from the file and write them to the output stream * @param reader The file reader to read from @param length The full length that should be transferred @param bytesTransferred Number of bytes remaining to transfer * @return Number of bytes transferred * @throws IOException on any I/O error 
protected	TokenNameprotected	
long	TokenNamelong	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
reader	TokenNameIdentifier	 reader
,	TokenNameCOMMA	
long	TokenNamelong	
length	TokenNameIdentifier	 length
,	TokenNameCOMMA	
long	TokenNamelong	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
int	TokenNameint	
toTransfer	TokenNameIdentifier	 to Transfer
=	TokenNameEQUAL	
(	TokenNameLPAREN	
int	TokenNameint	
)	TokenNameRPAREN	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
min	TokenNameIdentifier	 min
(	TokenNameLPAREN	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
,	TokenNameCOMMA	
length	TokenNameIdentifier	 length
-	TokenNameMINUS	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
reader	TokenNameIdentifier	 reader
.	TokenNameDOT	
readFully	TokenNameIdentifier	 read Fully
(	TokenNameLPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
compressedoutput	TokenNameIdentifier	 compressedoutput
.	TokenNameDOT	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throttle	TokenNameIdentifier	 throttle
.	TokenNameDOT	
throttleDelta	TokenNameIdentifier	 throttle Delta
(	TokenNameLPAREN	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
toTransfer	TokenNameIdentifier	 to Transfer
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * Connects to the destination, with backoff for failed attempts. * TODO: all nodes on a cluster must currently use the same storage port * @throws IOException If all attempts fail. */	TokenNameCOMMENT_JAVADOC	 Connects to the destination, with backoff for failed attempts. TODO: all nodes on a cluster must currently use the same storage port @throws IOException If all attempts fail. 
private	TokenNameprivate	
void	TokenNamevoid	
connectAttempt	TokenNameIdentifier	 connect Attempt
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
int	TokenNameint	
attempts	TokenNameIdentifier	 attempts
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
true	TokenNametrue	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
try	TokenNametry	
{	TokenNameLBRACE	
socket	TokenNameIdentifier	 socket
=	TokenNameEQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getConnectionPool	TokenNameIdentifier	 get Connection Pool
(	TokenNameLPAREN	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
.	TokenNameDOT	
newSocket	TokenNameIdentifier	 new Socket
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
setSoTimeout	TokenNameIdentifier	 set So Timeout
(	TokenNameLPAREN	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getStreamingSocketTimeout	TokenNameIdentifier	 get Streaming Socket Timeout
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
output	TokenNameIdentifier	 output
=	TokenNameEQUAL	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getOutputStream	TokenNameIdentifier	 get Output Stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
input	TokenNameIdentifier	 input
=	TokenNameEQUAL	
new	TokenNamenew	
DataInputStream	TokenNameIdentifier	 Data Input Stream
(	TokenNameLPAREN	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getInputStream	TokenNameIdentifier	 get Input Stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
IOException	TokenNameIdentifier	 IO Exception
e	TokenNameIdentifier	 e
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
++	TokenNamePLUS_PLUS	
attempts	TokenNameIdentifier	 attempts
>=	TokenNameGREATER_EQUAL	
MAX_CONNECT_ATTEMPTS	TokenNameIdentifier	 MAX  CONNECT  ATTEMPTS
)	TokenNameRPAREN	
throw	TokenNamethrow	
e	TokenNameIdentifier	 e
;	TokenNameSEMICOLON	
long	TokenNamelong	
waitms	TokenNameIdentifier	 waitms
=	TokenNameEQUAL	
DatabaseDescriptor	TokenNameIdentifier	 Database Descriptor
.	TokenNameDOT	
getRpcTimeout	TokenNameIdentifier	 get Rpc Timeout
(	TokenNameLPAREN	
)	TokenNameRPAREN	
*	TokenNameMULTIPLY	
(	TokenNameLPAREN	
long	TokenNamelong	
)	TokenNameRPAREN	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
pow	TokenNameIdentifier	 pow
(	TokenNameLPAREN	
2	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
attempts	TokenNameIdentifier	 attempts
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
warn	TokenNameIdentifier	 warn
(	TokenNameLPAREN	
"Failed attempt "	TokenNameStringLiteral	Failed attempt 
+	TokenNamePLUS	
attempts	TokenNameIdentifier	 attempts
+	TokenNamePLUS	
" to connect to "	TokenNameStringLiteral	 to connect to 
+	TokenNamePLUS	
to	TokenNameIdentifier	 to
+	TokenNamePLUS	
" to stream "	TokenNameStringLiteral	 to stream 
+	TokenNamePLUS	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
+	TokenNamePLUS	
". Retrying in "	TokenNameStringLiteral	. Retrying in 
+	TokenNamePLUS	
waitms	TokenNameIdentifier	 waitms
+	TokenNamePLUS	
" ms. ("	TokenNameStringLiteral	 ms. (
+	TokenNamePLUS	
e	TokenNameIdentifier	 e
+	TokenNamePLUS	
")"	TokenNameStringLiteral	)
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
Thread	TokenNameIdentifier	 Thread
.	TokenNameDOT	
sleep	TokenNameIdentifier	 sleep
(	TokenNameLPAREN	
waitms	TokenNameIdentifier	 waitms
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
catch	TokenNamecatch	
(	TokenNameLPAREN	
InterruptedException	TokenNameIdentifier	 Interrupted Exception
wtf	TokenNameIdentifier	 wtf
)	TokenNameRPAREN	
{	TokenNameLBRACE	
throw	TokenNamethrow	
new	TokenNamenew	
RuntimeException	TokenNameIdentifier	 Runtime Exception
(	TokenNameLPAREN	
wtf	TokenNameIdentifier	 wtf
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
protected	TokenNameprotected	
void	TokenNamevoid	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
output	TokenNameIdentifier	 output
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
output	TokenNameIdentifier	 output
.	TokenNameDOT	
close	TokenNameIdentifier	 close
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
public	TokenNamepublic	
String	TokenNameIdentifier	 String
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
return	TokenNamereturn	
String	TokenNameIdentifier	 String
.	TokenNameDOT	
format	TokenNameIdentifier	 format
(	TokenNameLPAREN	
"FileStreamTask(session=%s, to=%s)"	TokenNameStringLiteral	FileStreamTask(session=%s, to=%s)
,	TokenNameCOMMA	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
sessionId	TokenNameIdentifier	 session Id
,	TokenNameCOMMA	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
