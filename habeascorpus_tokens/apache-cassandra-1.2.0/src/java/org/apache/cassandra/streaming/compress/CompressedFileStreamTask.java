/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
streaming	TokenNameIdentifier	 streaming
.	TokenNameDOT	
compress	TokenNameIdentifier	 compress
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
*	TokenNameMULTIPLY	
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
InetAddress	TokenNameIdentifier	 Inet Address
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
ByteBuffer	TokenNameIdentifier	 Byte Buffer
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
FileChannel	TokenNameIdentifier	 File Channel
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
nio	TokenNameIdentifier	 nio
.	TokenNameDOT	
channels	TokenNameIdentifier	 channels
.	TokenNameDOT	
SocketChannel	TokenNameIdentifier	 Socket Channel
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
ArrayList	TokenNameIdentifier	 Array List
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
List	TokenNameIdentifier	 List
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
Logger	TokenNameIdentifier	 Logger
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
slf4j	TokenNameIdentifier	 slf4j
.	TokenNameDOT	
LoggerFactory	TokenNameIdentifier	 Logger Factory
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
compress	TokenNameIdentifier	 compress
.	TokenNameDOT	
CompressionMetadata	TokenNameIdentifier	 Compression Metadata
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
FileUtils	TokenNameIdentifier	 File Utils
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
io	TokenNameIdentifier	 io
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
metrics	TokenNameIdentifier	 metrics
.	TokenNameDOT	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
net	TokenNameIdentifier	 net
.	TokenNameDOT	
MessagingService	TokenNameIdentifier	 Messaging Service
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
streaming	TokenNameIdentifier	 streaming
.	TokenNameDOT	
FileStreamTask	TokenNameIdentifier	 File Stream Task
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
streaming	TokenNameIdentifier	 streaming
.	TokenNameDOT	
StreamHeader	TokenNameIdentifier	 Stream Header
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
cassandra	TokenNameIdentifier	 cassandra
.	TokenNameDOT	
utils	TokenNameIdentifier	 utils
.	TokenNameDOT	
Pair	TokenNameIdentifier	 Pair
;	TokenNameSEMICOLON	
/** * FileStreamTask for compressed SSTable. * * This class sends relevant part of compressed file directly using nio if available. */	TokenNameCOMMENT_JAVADOC	 FileStreamTask for compressed SSTable. * This class sends relevant part of compressed file directly using nio if available. 
public	TokenNamepublic	
class	TokenNameclass	
CompressedFileStreamTask	TokenNameIdentifier	 Compressed File Stream Task
extends	TokenNameextends	
FileStreamTask	TokenNameIdentifier	 File Stream Task
{	TokenNameLBRACE	
private	TokenNameprivate	
static	TokenNamestatic	
final	TokenNamefinal	
Logger	TokenNameIdentifier	 Logger
logger	TokenNameIdentifier	 logger
=	TokenNameEQUAL	
LoggerFactory	TokenNameIdentifier	 Logger Factory
.	TokenNameDOT	
getLogger	TokenNameIdentifier	 get Logger
(	TokenNameLPAREN	
CompressedFileStreamTask	TokenNameIdentifier	 Compressed File Stream Task
.	TokenNameDOT	
class	TokenNameclass	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// 10MB chunks 	TokenNameCOMMENT_LINE	10MB chunks 
public	TokenNamepublic	
static	TokenNamestatic	
final	TokenNamefinal	
int	TokenNameint	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
=	TokenNameEQUAL	
10	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
*	TokenNameMULTIPLY	
1024	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
public	TokenNamepublic	
CompressedFileStreamTask	TokenNameIdentifier	 Compressed File Stream Task
(	TokenNameLPAREN	
StreamHeader	TokenNameIdentifier	 Stream Header
header	TokenNameIdentifier	 header
,	TokenNameCOMMA	
InetAddress	TokenNameIdentifier	 Inet Address
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
,	TokenNameCOMMA	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
protected	TokenNameprotected	
void	TokenNamevoid	
stream	TokenNameIdentifier	 stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
throws	TokenNamethrows	
IOException	TokenNameIdentifier	 IO Exception
{	TokenNameLBRACE	
assert	TokenNameassert	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
compressionInfo	TokenNameIdentifier	 compression Info
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
SocketChannel	TokenNameIdentifier	 Socket Channel
sc	TokenNameIdentifier	 sc
=	TokenNameEQUAL	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getChannel	TokenNameIdentifier	 get Channel
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
transferBuffer	TokenNameIdentifier	 transfer Buffer
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
// write header 	TokenNameCOMMENT_LINE	write header 
ByteBuffer	TokenNameIdentifier	 Byte Buffer
headerBuffer	TokenNameIdentifier	 header Buffer
=	TokenNameEQUAL	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
constructStreamHeader	TokenNameIdentifier	 construct Stream Header
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
,	TokenNameCOMMA	
false	TokenNamefalse	
,	TokenNameCOMMA	
MessagingService	TokenNameIdentifier	 Messaging Service
.	TokenNameDOT	
instance	TokenNameIdentifier	 instance
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getVersion	TokenNameIdentifier	 get Version
(	TokenNameLPAREN	
to	TokenNameIdentifier	 to
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getOutputStream	TokenNameIdentifier	 get Output Stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
ByteBufferUtil	TokenNameIdentifier	 Byte Buffer Util
.	TokenNameDOT	
getArray	TokenNameIdentifier	 get Array
(	TokenNameLPAREN	
headerBuffer	TokenNameIdentifier	 header Buffer
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
file	TokenNameIdentifier	 file
=	TokenNameEQUAL	
RandomAccessReader	TokenNameIdentifier	 Random Access Reader
.	TokenNameDOT	
open	TokenNameIdentifier	 open
(	TokenNameLPAREN	
new	TokenNamenew	
File	TokenNameIdentifier	 File
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
getFilename	TokenNameIdentifier	 get Filename
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
,	TokenNameCOMMA	
true	TokenNametrue	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
FileChannel	TokenNameIdentifier	 File Channel
fc	TokenNameIdentifier	 fc
=	TokenNameEQUAL	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
getChannel	TokenNameIdentifier	 get Channel
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
activeStreamsOutbound	TokenNameIdentifier	 active Streams Outbound
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// calculate chunks to transfer. we want to send continuous chunks altogether. 	TokenNameCOMMENT_LINE	calculate chunks to transfer. we want to send continuous chunks altogether. 
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>>	TokenNameRIGHT_SHIFT	
sections	TokenNameIdentifier	 sections
=	TokenNameEQUAL	
getTransferSections	TokenNameIdentifier	 get Transfer Sections
(	TokenNameLPAREN	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
compressionInfo	TokenNameIdentifier	 compression Info
.	TokenNameDOT	
chunks	TokenNameIdentifier	 chunks
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
try	TokenNametry	
{	TokenNameLBRACE	
long	TokenNamelong	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
// stream each of the required sections of the file 	TokenNameCOMMENT_LINE	stream each of the required sections of the file 
for	TokenNamefor	
(	TokenNameLPAREN	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>	TokenNameGREATER	
section	TokenNameIdentifier	 section
:	TokenNameCOLON	
sections	TokenNameIdentifier	 sections
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// length of the section to stream 	TokenNameCOMMENT_LINE	length of the section to stream 
long	TokenNamelong	
length	TokenNameIdentifier	 length
=	TokenNameEQUAL	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
right	TokenNameIdentifier	 right
-	TokenNameMINUS	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
left	TokenNameIdentifier	 left
;	TokenNameSEMICOLON	
// tracks write progress 	TokenNameCOMMENT_LINE	tracks write progress 
long	TokenNamelong	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
=	TokenNameEQUAL	
0	TokenNameIntegerLiteral	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
<	TokenNameLESS	
length	TokenNameIdentifier	 length
)	TokenNameRPAREN	
{	TokenNameLBRACE	
int	TokenNameint	
toTransfer	TokenNameIdentifier	 to Transfer
=	TokenNameEQUAL	
(	TokenNameLPAREN	
int	TokenNameint	
)	TokenNameRPAREN	
Math	TokenNameIdentifier	 Math
.	TokenNameDOT	
min	TokenNameIdentifier	 min
(	TokenNameLPAREN	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
,	TokenNameCOMMA	
length	TokenNameIdentifier	 length
-	TokenNameMINUS	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
long	TokenNamelong	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
sc	TokenNameIdentifier	 sc
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
lastWrite	TokenNameIdentifier	 last Write
=	TokenNameEQUAL	
fc	TokenNameIdentifier	 fc
.	TokenNameDOT	
transferTo	TokenNameIdentifier	 transfer To
(	TokenNameLPAREN	
section	TokenNameIdentifier	 section
.	TokenNameDOT	
left	TokenNameIdentifier	 left
+	TokenNamePLUS	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
,	TokenNameCOMMA	
toTransfer	TokenNameIdentifier	 to Transfer
,	TokenNameCOMMA	
sc	TokenNameIdentifier	 sc
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throttle	TokenNameIdentifier	 throttle
.	TokenNameDOT	
throttleDelta	TokenNameIdentifier	 throttle Delta
(	TokenNameLPAREN	
lastWrite	TokenNameIdentifier	 last Write
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
// NIO is not available. Fall back to normal streaming. 	TokenNameCOMMENT_LINE	NIO is not available. Fall back to normal streaming. 
// This happens when inter-node encryption is turned on. 	TokenNameCOMMENT_LINE	This happens when inter-node encryption is turned on. 
if	TokenNameif	
(	TokenNameLPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
=	TokenNameEQUAL	
new	TokenNamenew	
byte	TokenNamebyte	
[	TokenNameLBRACKET	
CHUNK_SIZE	TokenNameIdentifier	 CHUNK  SIZE
]	TokenNameRBRACKET	
;	TokenNameSEMICOLON	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
readFully	TokenNameIdentifier	 read Fully
(	TokenNameLPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
socket	TokenNameIdentifier	 socket
.	TokenNameDOT	
getOutputStream	TokenNameIdentifier	 get Output Stream
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
write	TokenNameIdentifier	 write
(	TokenNameLPAREN	
transferBuffer	TokenNameIdentifier	 transfer Buffer
,	TokenNameCOMMA	
0	TokenNameIntegerLiteral	
,	TokenNameCOMMA	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
throttle	TokenNameIdentifier	 throttle
.	TokenNameDOT	
throttleDelta	TokenNameIdentifier	 throttle Delta
(	TokenNameLPAREN	
toTransfer	TokenNameIdentifier	 to Transfer
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
lastWrite	TokenNameIdentifier	 last Write
=	TokenNameEQUAL	
toTransfer	TokenNameIdentifier	 to Transfer
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
progress	TokenNameIdentifier	 progress
+=	TokenNamePLUS_EQUAL	
lastWrite	TokenNameIdentifier	 last Write
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
logger	TokenNameIdentifier	 logger
.	TokenNameDOT	
debug	TokenNameIdentifier	 debug
(	TokenNameLPAREN	
"Bytes transferred "	TokenNameStringLiteral	Bytes transferred 
+	TokenNamePLUS	
bytesTransferred	TokenNameIdentifier	 bytes Transferred
+	TokenNamePLUS	
"/"	TokenNameStringLiteral	/
+	TokenNamePLUS	
header	TokenNameIdentifier	 header
.	TokenNameDOT	
file	TokenNameIdentifier	 file
.	TokenNameDOT	
size	TokenNameIdentifier	 size
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
totalOutgoingBytes	TokenNameIdentifier	 total Outgoing Bytes
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
metrics	TokenNameIdentifier	 metrics
.	TokenNameDOT	
outgoingBytes	TokenNameIdentifier	 outgoing Bytes
.	TokenNameDOT	
inc	TokenNameIdentifier	 inc
(	TokenNameLPAREN	
totalBytesTransferred	TokenNameIdentifier	 total Bytes Transferred
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// receive reply confirmation 	TokenNameCOMMENT_LINE	receive reply confirmation 
receiveReply	TokenNameIdentifier	 receive Reply
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
finally	TokenNamefinally	
{	TokenNameLBRACE	
StreamingMetrics	TokenNameIdentifier	 Streaming Metrics
.	TokenNameDOT	
activeStreamsOutbound	TokenNameIdentifier	 active Streams Outbound
.	TokenNameDOT	
dec	TokenNameIdentifier	 dec
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// no matter what happens close file 	TokenNameCOMMENT_LINE	no matter what happens close file 
FileUtils	TokenNameIdentifier	 File Utils
.	TokenNameDOT	
closeQuietly	TokenNameIdentifier	 close Quietly
(	TokenNameLPAREN	
file	TokenNameIdentifier	 file
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// chunks are assumed to be sorted by offset 	TokenNameCOMMENT_LINE	chunks are assumed to be sorted by offset 
private	TokenNameprivate	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>>	TokenNameRIGHT_SHIFT	
getTransferSections	TokenNameIdentifier	 get Transfer Sections
(	TokenNameLPAREN	
CompressionMetadata	TokenNameIdentifier	 Compression Metadata
.	TokenNameDOT	
Chunk	TokenNameIdentifier	 Chunk
[	TokenNameLBRACKET	
]	TokenNameRBRACKET	
chunks	TokenNameIdentifier	 chunks
)	TokenNameRPAREN	
{	TokenNameLBRACE	
List	TokenNameIdentifier	 List
<	TokenNameLESS	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>>	TokenNameRIGHT_SHIFT	
transferSections	TokenNameIdentifier	 transfer Sections
=	TokenNameEQUAL	
new	TokenNamenew	
ArrayList	TokenNameIdentifier	 Array List
<	TokenNameLESS	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>>	TokenNameRIGHT_SHIFT	
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
Pair	TokenNameIdentifier	 Pair
<	TokenNameLESS	
Long	TokenNameIdentifier	 Long
,	TokenNameCOMMA	
Long	TokenNameIdentifier	 Long
>	TokenNameGREATER	
lastSection	TokenNameIdentifier	 last Section
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
for	TokenNamefor	
(	TokenNameLPAREN	
CompressionMetadata	TokenNameIdentifier	 Compression Metadata
.	TokenNameDOT	
Chunk	TokenNameIdentifier	 Chunk
chunk	TokenNameIdentifier	 chunk
:	TokenNameCOLON	
chunks	TokenNameIdentifier	 chunks
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
lastSection	TokenNameIdentifier	 last Section
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
==	TokenNameEQUAL_EQUAL	
lastSection	TokenNameIdentifier	 last Section
.	TokenNameDOT	
right	TokenNameIdentifier	 right
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// extend previous section to end of this chunk 	TokenNameCOMMENT_LINE	extend previous section to end of this chunk 
lastSection	TokenNameIdentifier	 last Section
=	TokenNameEQUAL	
Pair	TokenNameIdentifier	 Pair
.	TokenNameDOT	
create	TokenNameIdentifier	 create
(	TokenNameLPAREN	
lastSection	TokenNameIdentifier	 last Section
.	TokenNameDOT	
left	TokenNameIdentifier	 left
,	TokenNameCOMMA	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
+	TokenNamePLUS	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
length	TokenNameIdentifier	 length
+	TokenNamePLUS	
4	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// 4 bytes for CRC 	TokenNameCOMMENT_LINE	4 bytes for CRC 
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
transferSections	TokenNameIdentifier	 transfer Sections
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
lastSection	TokenNameIdentifier	 last Section
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
lastSection	TokenNameIdentifier	 last Section
=	TokenNameEQUAL	
Pair	TokenNameIdentifier	 Pair
.	TokenNameDOT	
create	TokenNameIdentifier	 create
(	TokenNameLPAREN	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
,	TokenNameCOMMA	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
+	TokenNamePLUS	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
length	TokenNameIdentifier	 length
+	TokenNamePLUS	
4	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
lastSection	TokenNameIdentifier	 last Section
=	TokenNameEQUAL	
Pair	TokenNameIdentifier	 Pair
.	TokenNameDOT	
create	TokenNameIdentifier	 create
(	TokenNameLPAREN	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
,	TokenNameCOMMA	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
offset	TokenNameIdentifier	 offset
+	TokenNamePLUS	
chunk	TokenNameIdentifier	 chunk
.	TokenNameDOT	
length	TokenNameIdentifier	 length
+	TokenNamePLUS	
4	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
if	TokenNameif	
(	TokenNameLPAREN	
lastSection	TokenNameIdentifier	 last Section
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
transferSections	TokenNameIdentifier	 transfer Sections
.	TokenNameDOT	
add	TokenNameIdentifier	 add
(	TokenNameLPAREN	
lastSection	TokenNameIdentifier	 last Section
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
transferSections	TokenNameIdentifier	 transfer Sections
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
