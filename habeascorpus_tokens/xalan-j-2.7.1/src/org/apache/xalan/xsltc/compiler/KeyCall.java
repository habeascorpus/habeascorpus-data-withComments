/* * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */	TokenNameCOMMENT_BLOCK	 Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
/* * $Id: KeyCall.java 476471 2006-11-18 08:36:27Z minchau $ */	TokenNameCOMMENT_BLOCK	 $Id: KeyCall.java 476471 2006-11-18 08:36:27Z minchau $ 
package	TokenNamepackage	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
;	TokenNameSEMICOLON	
import	TokenNameimport	
java	TokenNameIdentifier	 java
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Vector	TokenNameIdentifier	 Vector
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
ALOAD	TokenNameIdentifier	 ALOAD
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
ASTORE	TokenNameIdentifier	 ASTORE
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
BranchHandle	TokenNameIdentifier	 Branch Handle
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
ConstantPoolGen	TokenNameIdentifier	 Constant Pool Gen
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
GOTO	TokenNameIdentifier	 GOTO
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
IFGT	TokenNameIdentifier	 IFGT
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
INVOKEINTERFACE	TokenNameIdentifier	 INVOKEINTERFACE
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
INVOKESPECIAL	TokenNameIdentifier	 INVOKESPECIAL
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
INVOKEVIRTUAL	TokenNameIdentifier	 INVOKEVIRTUAL
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
InstructionHandle	TokenNameIdentifier	 Instruction Handle
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
InstructionList	TokenNameIdentifier	 Instruction List
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
LocalVariableGen	TokenNameIdentifier	 Local Variable Gen
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
NEW	TokenNameIdentifier	 NEW
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
bcel	TokenNameIdentifier	 bcel
.	TokenNameDOT	
generic	TokenNameIdentifier	 generic
.	TokenNameDOT	
PUSH	TokenNameIdentifier	 PUSH
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
ClassGenerator	TokenNameIdentifier	 Class Generator
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
MethodGenerator	TokenNameIdentifier	 Method Generator
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
StringType	TokenNameIdentifier	 String Type
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Type	TokenNameIdentifier	 Type
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
TypeCheckError	TokenNameIdentifier	 Type Check Error
;	TokenNameSEMICOLON	
import	TokenNameimport	
org	TokenNameIdentifier	 org
.	TokenNameDOT	
apache	TokenNameIdentifier	 apache
.	TokenNameDOT	
xalan	TokenNameIdentifier	 xalan
.	TokenNameDOT	
xsltc	TokenNameIdentifier	 xsltc
.	TokenNameDOT	
compiler	TokenNameIdentifier	 compiler
.	TokenNameDOT	
util	TokenNameIdentifier	 util
.	TokenNameDOT	
Util	TokenNameIdentifier	 Util
;	TokenNameSEMICOLON	
/** * @author Morten Jorgensen * @author Santiago Pericas-Geertsen */	TokenNameCOMMENT_JAVADOC	 @author Morten Jorgensen @author Santiago Pericas-Geertsen 
final	TokenNamefinal	
class	TokenNameclass	
KeyCall	TokenNameIdentifier	 Key Call
extends	TokenNameextends	
FunctionCall	TokenNameIdentifier	 Function Call
{	TokenNameLBRACE	
/** * The name of the key. */	TokenNameCOMMENT_JAVADOC	 The name of the key. 
private	TokenNameprivate	
Expression	TokenNameIdentifier	 Expression
_name	TokenNameIdentifier	 name
;	TokenNameSEMICOLON	
/** * The value to look up in the key/index. */	TokenNameCOMMENT_JAVADOC	 The value to look up in the key/index. 
private	TokenNameprivate	
Expression	TokenNameIdentifier	 Expression
_value	TokenNameIdentifier	 value
;	TokenNameSEMICOLON	
/** * The value's data type. */	TokenNameCOMMENT_JAVADOC	 The value's data type. 
private	TokenNameprivate	
Type	TokenNameIdentifier	 Type
_valueType	TokenNameIdentifier	 value Type
;	TokenNameSEMICOLON	
// The value's data type 	TokenNameCOMMENT_LINE	The value's data type 
/** * Expanded qname when name is literal. */	TokenNameCOMMENT_JAVADOC	 Expanded qname when name is literal. 
private	TokenNameprivate	
QName	TokenNameIdentifier	 Q Name
_resolvedQName	TokenNameIdentifier	 resolved Q Name
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
/** * Get the parameters passed to function: * key(String name, String value) * key(String name, NodeSet value) * The 'arguments' vector should contain two parameters for key() calls, * one holding the key name and one holding the value(s) to look up. The * vector has only one parameter for id() calls (the key name is always * "##id" for id() calls). * * @param fname The function name (should be 'key' or 'id') * @param arguments A vector containing the arguments the the function */	TokenNameCOMMENT_JAVADOC	 Get the parameters passed to function: key(String name, String value) key(String name, NodeSet value) The 'arguments' vector should contain two parameters for key() calls, one holding the key name and one holding the value(s) to look up. The vector has only one parameter for id() calls (the key name is always "##id" for id() calls). * @param fname The function name (should be 'key' or 'id') @param arguments A vector containing the arguments the the function 
public	TokenNamepublic	
KeyCall	TokenNameIdentifier	 Key Call
(	TokenNameLPAREN	
QName	TokenNameIdentifier	 Q Name
fname	TokenNameIdentifier	 fname
,	TokenNameCOMMA	
Vector	TokenNameIdentifier	 Vector
arguments	TokenNameIdentifier	 arguments
)	TokenNameRPAREN	
{	TokenNameLBRACE	
super	TokenNamesuper	
(	TokenNameLPAREN	
fname	TokenNameIdentifier	 fname
,	TokenNameCOMMA	
arguments	TokenNameIdentifier	 arguments
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
switch	TokenNameswitch	
(	TokenNameLPAREN	
argumentCount	TokenNameIdentifier	 argument Count
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
case	TokenNamecase	
1	TokenNameIntegerLiteral	
:	TokenNameCOLON	
_name	TokenNameIdentifier	 name
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
_value	TokenNameIdentifier	 value
=	TokenNameEQUAL	
argument	TokenNameIdentifier	 argument
(	TokenNameLPAREN	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
case	TokenNamecase	
2	TokenNameIntegerLiteral	
:	TokenNameCOLON	
_name	TokenNameIdentifier	 name
=	TokenNameEQUAL	
argument	TokenNameIdentifier	 argument
(	TokenNameLPAREN	
0	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
_value	TokenNameIdentifier	 value
=	TokenNameEQUAL	
argument	TokenNameIdentifier	 argument
(	TokenNameLPAREN	
1	TokenNameIntegerLiteral	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
default	TokenNamedefault	
:	TokenNameCOLON	
_name	TokenNameIdentifier	 name
=	TokenNameEQUAL	
_value	TokenNameIdentifier	 value
=	TokenNameEQUAL	
null	TokenNamenull	
;	TokenNameSEMICOLON	
break	TokenNamebreak	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * If this call to key() is in a top-level element like another variable * or param, add a dependency between that top-level element and the * referenced key. For example, * * <xsl:key name="x" .../> * <xsl:variable name="y" select="key('x', 1)"/> * * and assuming this class represents "key('x', 1)", add a reference * between variable y and key x. Note that if 'x' is unknown statically * in key('x', 1), there's nothing we can do at this point. */	TokenNameCOMMENT_JAVADOC	 If this call to key() is in a top-level element like another variable or param, add a dependency between that top-level element and the referenced key. For example, * <xsl:key name="x" .../> <xsl:variable name="y" select="key('x', 1)"/> * and assuming this class represents "key('x', 1)", add a reference between variable y and key x. Note that if 'x' is unknown statically in key('x', 1), there's nothing we can do at this point. 
public	TokenNamepublic	
void	TokenNamevoid	
addParentDependency	TokenNameIdentifier	 add Parent Dependency
(	TokenNameLPAREN	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
// If name unknown statically, there's nothing we can do 	TokenNameCOMMENT_LINE	If name unknown statically, there's nothing we can do 
if	TokenNameif	
(	TokenNameLPAREN	
_resolvedQName	TokenNameIdentifier	 resolved Q Name
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
return	TokenNamereturn	
;	TokenNameSEMICOLON	
SyntaxTreeNode	TokenNameIdentifier	 Syntax Tree Node
node	TokenNameIdentifier	 node
=	TokenNameEQUAL	
this	TokenNamethis	
;	TokenNameSEMICOLON	
while	TokenNamewhile	
(	TokenNameLPAREN	
node	TokenNameIdentifier	 node
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
&&	TokenNameAND_AND	
node	TokenNameIdentifier	 node
instanceof	TokenNameinstanceof	
TopLevelElement	TokenNameIdentifier	 Top Level Element
==	TokenNameEQUAL_EQUAL	
false	TokenNamefalse	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
node	TokenNameIdentifier	 node
=	TokenNameEQUAL	
node	TokenNameIdentifier	 node
.	TokenNameDOT	
getParent	TokenNameIdentifier	 get Parent
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
TopLevelElement	TokenNameIdentifier	 Top Level Element
parent	TokenNameIdentifier	 parent
=	TokenNameEQUAL	
(	TokenNameLPAREN	
TopLevelElement	TokenNameIdentifier	 Top Level Element
)	TokenNameRPAREN	
node	TokenNameIdentifier	 node
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
parent	TokenNameIdentifier	 parent
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
parent	TokenNameIdentifier	 parent
.	TokenNameDOT	
addDependency	TokenNameIdentifier	 add Dependency
(	TokenNameLPAREN	
getSymbolTable	TokenNameIdentifier	 get Symbol Table
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getKey	TokenNameIdentifier	 get Key
(	TokenNameLPAREN	
_resolvedQName	TokenNameIdentifier	 resolved Q Name
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
/** * Type check the parameters for the id() or key() function. * The index name (for key() call only) must be a string or convertable * to a string, and the lookup-value must be a string or a node-set. * @param stable The parser's symbol table * @throws TypeCheckError When the parameters have illegal type */	TokenNameCOMMENT_JAVADOC	 Type check the parameters for the id() or key() function. The index name (for key() call only) must be a string or convertable to a string, and the lookup-value must be a string or a node-set. @param stable The parser's symbol table @throws TypeCheckError When the parameters have illegal type 
public	TokenNamepublic	
Type	TokenNameIdentifier	 Type
typeCheck	TokenNameIdentifier	 type Check
(	TokenNameLPAREN	
SymbolTable	TokenNameIdentifier	 Symbol Table
stable	TokenNameIdentifier	 stable
)	TokenNameRPAREN	
throws	TokenNamethrows	
TypeCheckError	TokenNameIdentifier	 Type Check Error
{	TokenNameLBRACE	
final	TokenNamefinal	
Type	TokenNameIdentifier	 Type
returnType	TokenNameIdentifier	 return Type
=	TokenNameEQUAL	
super	TokenNamesuper	
.	TokenNameDOT	
typeCheck	TokenNameIdentifier	 type Check
(	TokenNameLPAREN	
stable	TokenNameIdentifier	 stable
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Run type check on the key name (first argument) - must be a string, 	TokenNameCOMMENT_LINE	Run type check on the key name (first argument) - must be a string, 
// and if it is not it must be converted to one using string() rules. 	TokenNameCOMMENT_LINE	and if it is not it must be converted to one using string() rules. 
if	TokenNameif	
(	TokenNameLPAREN	
_name	TokenNameIdentifier	 name
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
final	TokenNamefinal	
Type	TokenNameIdentifier	 Type
nameType	TokenNameIdentifier	 name Type
=	TokenNameEQUAL	
_name	TokenNameIdentifier	 name
.	TokenNameDOT	
typeCheck	TokenNameIdentifier	 type Check
(	TokenNameLPAREN	
stable	TokenNameIdentifier	 stable
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
_name	TokenNameIdentifier	 name
instanceof	TokenNameinstanceof	
LiteralExpr	TokenNameIdentifier	 Literal Expr
)	TokenNameRPAREN	
{	TokenNameLBRACE	
final	TokenNamefinal	
LiteralExpr	TokenNameIdentifier	 Literal Expr
literal	TokenNameIdentifier	 literal
=	TokenNameEQUAL	
(	TokenNameLPAREN	
LiteralExpr	TokenNameIdentifier	 Literal Expr
)	TokenNameRPAREN	
_name	TokenNameIdentifier	 name
;	TokenNameSEMICOLON	
_resolvedQName	TokenNameIdentifier	 resolved Q Name
=	TokenNameEQUAL	
getParser	TokenNameIdentifier	 get Parser
(	TokenNameLPAREN	
)	TokenNameRPAREN	
.	TokenNameDOT	
getQNameIgnoreDefaultNs	TokenNameIdentifier	 get Q Name Ignore Default Ns
(	TokenNameLPAREN	
literal	TokenNameIdentifier	 literal
.	TokenNameDOT	
getValue	TokenNameIdentifier	 get Value
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
nameType	TokenNameIdentifier	 name Type
instanceof	TokenNameinstanceof	
StringType	TokenNameIdentifier	 String Type
==	TokenNameEQUAL_EQUAL	
false	TokenNamefalse	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
_name	TokenNameIdentifier	 name
=	TokenNameEQUAL	
new	TokenNamenew	
CastExpr	TokenNameIdentifier	 Cast Expr
(	TokenNameLPAREN	
_name	TokenNameIdentifier	 name
,	TokenNameCOMMA	
Type	TokenNameIdentifier	 Type
.	TokenNameDOT	
String	TokenNameIdentifier	 String
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
// Run type check on the value for this key. This value can be of 	TokenNameCOMMENT_LINE	Run type check on the value for this key. This value can be of 
// any data type, so this should never cause any type-check errors. 	TokenNameCOMMENT_LINE	any data type, so this should never cause any type-check errors. 
// If the value is a reference, then we have to defer the decision 	TokenNameCOMMENT_LINE	If the value is a reference, then we have to defer the decision 
// of how to process it until run-time. 	TokenNameCOMMENT_LINE	of how to process it until run-time. 
// If the value is known not to be a node-set, then it should be 	TokenNameCOMMENT_LINE	If the value is known not to be a node-set, then it should be 
// converted to a string before the lookup is done. If the value is 	TokenNameCOMMENT_LINE	converted to a string before the lookup is done. If the value is 
// known to be a node-set then this process (convert to string, then 	TokenNameCOMMENT_LINE	known to be a node-set then this process (convert to string, then 
// do lookup) should be applied to every node in the set, and the 	TokenNameCOMMENT_LINE	do lookup) should be applied to every node in the set, and the 
// result from all lookups should be added to the resulting node-set. 	TokenNameCOMMENT_LINE	result from all lookups should be added to the resulting node-set. 
_valueType	TokenNameIdentifier	 value Type
=	TokenNameEQUAL	
_value	TokenNameIdentifier	 value
.	TokenNameDOT	
typeCheck	TokenNameIdentifier	 type Check
(	TokenNameLPAREN	
stable	TokenNameIdentifier	 stable
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
_valueType	TokenNameIdentifier	 value Type
!=	TokenNameNOT_EQUAL	
Type	TokenNameIdentifier	 Type
.	TokenNameDOT	
NodeSet	TokenNameIdentifier	 Node Set
&&	TokenNameAND_AND	
_valueType	TokenNameIdentifier	 value Type
!=	TokenNameNOT_EQUAL	
Type	TokenNameIdentifier	 Type
.	TokenNameDOT	
Reference	TokenNameIdentifier	 Reference
&&	TokenNameAND_AND	
_valueType	TokenNameIdentifier	 value Type
!=	TokenNameNOT_EQUAL	
Type	TokenNameIdentifier	 Type
.	TokenNameDOT	
String	TokenNameIdentifier	 String
)	TokenNameRPAREN	
{	TokenNameLBRACE	
_value	TokenNameIdentifier	 value
=	TokenNameEQUAL	
new	TokenNamenew	
CastExpr	TokenNameIdentifier	 Cast Expr
(	TokenNameLPAREN	
_value	TokenNameIdentifier	 value
,	TokenNameCOMMA	
Type	TokenNameIdentifier	 Type
.	TokenNameDOT	
String	TokenNameIdentifier	 String
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
_valueType	TokenNameIdentifier	 value Type
=	TokenNameEQUAL	
_value	TokenNameIdentifier	 value
.	TokenNameDOT	
typeCheck	TokenNameIdentifier	 type Check
(	TokenNameLPAREN	
stable	TokenNameIdentifier	 stable
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// If in a top-level element, create dependency to the referenced key 	TokenNameCOMMENT_LINE	If in a top-level element, create dependency to the referenced key 
addParentDependency	TokenNameIdentifier	 add Parent Dependency
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
return	TokenNamereturn	
returnType	TokenNameIdentifier	 return Type
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
/** * This method is called when the constructor is compiled in * Stylesheet.compileConstructor() and not as the syntax tree is traversed. * <p>This method will generate byte code that produces an iterator * for the nodes in the node set for the key or id function call. * @param classGen The Java class generator * @param methodGen The method generator */	TokenNameCOMMENT_JAVADOC	 This method is called when the constructor is compiled in Stylesheet.compileConstructor() and not as the syntax tree is traversed. <p>This method will generate byte code that produces an iterator for the nodes in the node set for the key or id function call. @param classGen The Java class generator @param methodGen The method generator 
public	TokenNamepublic	
void	TokenNamevoid	
translate	TokenNameIdentifier	 translate
(	TokenNameLPAREN	
ClassGenerator	TokenNameIdentifier	 Class Generator
classGen	TokenNameIdentifier	 class Gen
,	TokenNameCOMMA	
MethodGenerator	TokenNameIdentifier	 Method Generator
methodGen	TokenNameIdentifier	 method Gen
)	TokenNameRPAREN	
{	TokenNameLBRACE	
final	TokenNamefinal	
ConstantPoolGen	TokenNameIdentifier	 Constant Pool Gen
cpg	TokenNameIdentifier	 cpg
=	TokenNameEQUAL	
classGen	TokenNameIdentifier	 class Gen
.	TokenNameDOT	
getConstantPool	TokenNameIdentifier	 get Constant Pool
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
final	TokenNamefinal	
InstructionList	TokenNameIdentifier	 Instruction List
il	TokenNameIdentifier	 il
=	TokenNameEQUAL	
methodGen	TokenNameIdentifier	 method Gen
.	TokenNameDOT	
getInstructionList	TokenNameIdentifier	 get Instruction List
(	TokenNameLPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Returns the KeyIndex object of a given name 	TokenNameCOMMENT_LINE	Returns the KeyIndex object of a given name 
final	TokenNamefinal	
int	TokenNameint	
getKeyIndex	TokenNameIdentifier	 get Key Index
=	TokenNameEQUAL	
cpg	TokenNameIdentifier	 cpg
.	TokenNameDOT	
addMethodref	TokenNameIdentifier	 add Methodref
(	TokenNameLPAREN	
TRANSLET_CLASS	TokenNameIdentifier	 TRANSLET  CLASS
,	TokenNameCOMMA	
"getKeyIndex"	TokenNameStringLiteral	getKeyIndex
,	TokenNameCOMMA	
"(Ljava/lang/String;)"	TokenNameStringLiteral	(Ljava/lang/String;)
+	TokenNamePLUS	
KEY_INDEX_SIG	TokenNameIdentifier	 KEY  INDEX  SIG
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// KeyIndex.setDom(Dom) => void 	TokenNameCOMMENT_LINE	KeyIndex.setDom(Dom) => void 
final	TokenNamefinal	
int	TokenNameint	
keyDom	TokenNameIdentifier	 key Dom
=	TokenNameEQUAL	
cpg	TokenNameIdentifier	 cpg
.	TokenNameDOT	
addMethodref	TokenNameIdentifier	 add Methodref
(	TokenNameLPAREN	
KEY_INDEX_CLASS	TokenNameIdentifier	 KEY  INDEX  CLASS
,	TokenNameCOMMA	
"setDom"	TokenNameStringLiteral	setDom
,	TokenNameCOMMA	
"("	TokenNameStringLiteral	(
+	TokenNamePLUS	
DOM_INTF_SIG	TokenNameIdentifier	 DOM  INTF  SIG
+	TokenNamePLUS	
")V"	TokenNameStringLiteral	)V
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Initialises a KeyIndex to return nodes with specific values 	TokenNameCOMMENT_LINE	Initialises a KeyIndex to return nodes with specific values 
final	TokenNamefinal	
int	TokenNameint	
getKeyIterator	TokenNameIdentifier	 get Key Iterator
=	TokenNameEQUAL	
cpg	TokenNameIdentifier	 cpg
.	TokenNameDOT	
addMethodref	TokenNameIdentifier	 add Methodref
(	TokenNameLPAREN	
KEY_INDEX_CLASS	TokenNameIdentifier	 KEY  INDEX  CLASS
,	TokenNameCOMMA	
"getKeyIndexIterator"	TokenNameStringLiteral	getKeyIndexIterator
,	TokenNameCOMMA	
"("	TokenNameStringLiteral	(
+	TokenNamePLUS	
_valueType	TokenNameIdentifier	 value Type
.	TokenNameDOT	
toSignature	TokenNameIdentifier	 to Signature
(	TokenNameLPAREN	
)	TokenNameRPAREN	
+	TokenNamePLUS	
"Z)"	TokenNameStringLiteral	Z)
+	TokenNamePLUS	
KEY_INDEX_ITERATOR_SIG	TokenNameIdentifier	 KEY  INDEX  ITERATOR  SIG
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
// Initialise the index specified in the first parameter of key() 	TokenNameCOMMENT_LINE	Initialise the index specified in the first parameter of key() 
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
classGen	TokenNameIdentifier	 class Gen
.	TokenNameDOT	
loadTranslet	TokenNameIdentifier	 load Translet
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
if	TokenNameif	
(	TokenNameLPAREN	
_name	TokenNameIdentifier	 name
==	TokenNameEQUAL_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
new	TokenNamenew	
PUSH	TokenNameIdentifier	 PUSH
(	TokenNameLPAREN	
cpg	TokenNameIdentifier	 cpg
,	TokenNameCOMMA	
"##id"	TokenNameStringLiteral	##id
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
if	TokenNameif	
(	TokenNameLPAREN	
_resolvedQName	TokenNameIdentifier	 resolved Q Name
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
{	TokenNameLBRACE	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
new	TokenNamenew	
PUSH	TokenNameIdentifier	 PUSH
(	TokenNameLPAREN	
cpg	TokenNameIdentifier	 cpg
,	TokenNameCOMMA	
_resolvedQName	TokenNameIdentifier	 resolved Q Name
.	TokenNameDOT	
toString	TokenNameIdentifier	 to String
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
else	TokenNameelse	
{	TokenNameLBRACE	
_name	TokenNameIdentifier	 name
.	TokenNameDOT	
translate	TokenNameIdentifier	 translate
(	TokenNameLPAREN	
classGen	TokenNameIdentifier	 class Gen
,	TokenNameCOMMA	
methodGen	TokenNameIdentifier	 method Gen
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
// Generate following byte code: 	TokenNameCOMMENT_LINE	Generate following byte code: 
// 	TokenNameCOMMENT_LINE	 
// KeyIndex ki = translet.getKeyIndex(_name) 	TokenNameCOMMENT_LINE	KeyIndex ki = translet.getKeyIndex(_name) 
// ki.setDom(translet.dom); 	TokenNameCOMMENT_LINE	ki.setDom(translet.dom); 
// ki.getKeyIndexIterator(_value, true) - for key() 	TokenNameCOMMENT_LINE	ki.getKeyIndexIterator(_value, true) - for key() 
// OR 	TokenNameCOMMENT_LINE	OR 
// ki.getKeyIndexIterator(_value, false) - for id() 	TokenNameCOMMENT_LINE	ki.getKeyIndexIterator(_value, false) - for id() 
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
new	TokenNamenew	
INVOKEVIRTUAL	TokenNameIdentifier	 INVOKEVIRTUAL
(	TokenNameLPAREN	
getKeyIndex	TokenNameIdentifier	 get Key Index
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
DUP	TokenNameIdentifier	 DUP
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
methodGen	TokenNameIdentifier	 method Gen
.	TokenNameDOT	
loadDOM	TokenNameIdentifier	 load DOM
(	TokenNameLPAREN	
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
new	TokenNamenew	
INVOKEVIRTUAL	TokenNameIdentifier	 INVOKEVIRTUAL
(	TokenNameLPAREN	
keyDom	TokenNameIdentifier	 key Dom
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
_value	TokenNameIdentifier	 value
.	TokenNameDOT	
translate	TokenNameIdentifier	 translate
(	TokenNameLPAREN	
classGen	TokenNameIdentifier	 class Gen
,	TokenNameCOMMA	
methodGen	TokenNameIdentifier	 method Gen
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
(	TokenNameLPAREN	
_name	TokenNameIdentifier	 name
!=	TokenNameNOT_EQUAL	
null	TokenNamenull	
)	TokenNameRPAREN	
?	TokenNameQUESTION	
ICONST_1	TokenNameIdentifier	 ICONST 1
:	TokenNameCOLON	
ICONST_0	TokenNameIdentifier	 ICONST 0
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
il	TokenNameIdentifier	 il
.	TokenNameDOT	
append	TokenNameIdentifier	 append
(	TokenNameLPAREN	
new	TokenNamenew	
INVOKEVIRTUAL	TokenNameIdentifier	 INVOKEVIRTUAL
(	TokenNameLPAREN	
getKeyIterator	TokenNameIdentifier	 get Key Iterator
)	TokenNameRPAREN	
)	TokenNameRPAREN	
;	TokenNameSEMICOLON	
}	TokenNameRBRACE	
}	TokenNameRBRACE	
